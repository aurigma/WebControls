Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.Canvas=function(){Aurigma.GraphicsMill.AjaxControls.VectorObjects.Canvas.initializeBase(this),this._selection=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.SelectionHandler(this),this._layers=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.LayerCollection(this),this._canvasClientSideOptions=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.CanvasClientSideOptions,this._history=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.History(this),this._id=null,this._workspaceWidth=72,this._workspaceHeight=72,this._zoom=1,this._screenXDpi=96,this._screenYDpi=96,this._targetDpi=null,this._hiddenFieldID="",this._parent=null,this._document=document,this._mouseMoveTimeout=100,this._disableSmoothing=!1,this._viewer=null,this._inactiveCanvases=[],this._activeCanvases=[],this._rotationGripSize=8,this._resizeGripSize=8,this._resizeGripColor="rgba(255,255,255,1)",this._rotationGripColor="rgba(0,0,255,0.2)",this._resizeGripLineColor="rgba(255,0,0,1)",this._rotationGripLineColor="rgba(112,112,112,1)",this._rotationGripLineLength=12,this._buttonGroupCssClass=null,this._selectButtonCssClass=null,this._editButtonCssClass=null,this._doneButtonCssClass=null,this._selectButtonTitle="Select image",this._editButtonTitle="Edit",this._doneButtonTitle="Done",this._backgroundImage=null,this._loadingImageUrl=null,this._previewColorManagementEnabled=!1,this._printColorManagementEnabled=!1,this._marginColor="rgba(100,255,100,1)",this._marginWidth=0,this._leftRightMargin=.25*72,this._topBottomMargin=.25*72,this._constrainedMarginEnabled=!1,this._keyEventEnabled=!0,this._needRedraw=!0,this._needCompleteRedraw=!0,this._selectionColor="rgba(0,0,255,0.7)",this._selectionWidth=2,this._handlerUrl=null,this._initialization=!1,this._onSelectedVObjectsDeletingDelegate,this._onSelectedVObjectsChangedDelegate,this._redrawDelegate=null,this._redrawAllCanvasesDelegate=null,this._callbackArgs="",this._exceptionDescription="",this._callback=null,this._status=Aurigma.GraphicsMill.AjaxControls.VectorObjects.UpdateStatus.ready,this._callbackContext=0,this._callbackCount=0,this._callbackCollection=[],this._callbackDelay=100,this._callbackTimeout=null,this._callbackFunctionDelegate=null,this._rgbColorProfileFileId=null,this._cmykColorProfileFileId=null,this._grayscaleColorProfileFileId=null,this._previewTargetColorSpace=null,this._returnValue=null,this._tags={},this._ready=!1,this._mouseMoveRedrawTimeout=null,this._placeholderButtonStyle=null,this._canDeleteVObjectsCallback=null},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Canvas.prototype={alignVObject:function(n,t){var f;if(!n)return;var u=n.get_bounds(),e=this.get_leftRightMargin(),o=this.get_topBottomMargin(),i=n.get_rectangle(),r=n.get_layer().get_region();r?t==="left"?i.CenterX=!n.get_locked()&&n.get_permissions().get_allowMoveHorizontal()?r.Left+u.Width/2:i.CenterX:t==="horizontalCenter"?i.CenterX=!n.get_locked()&&n.get_permissions().get_allowMoveHorizontal()?r.Left+r.Width/2:i.CenterX:t==="right"?i.CenterX=!n.get_locked()&&n.get_permissions().get_allowMoveHorizontal()?r.Left+r.Width-u.Width/2:i.CenterX:t==="top"?i.CenterY=!n.get_locked()&&n.get_permissions().get_allowMoveVertical()?r.Top+u.Height/2:i.CenterY:t==="verticalCenter"?i.CenterY=!n.get_locked()&&n.get_permissions().get_allowMoveVertical()?r.Top+r.Height/2:i.CenterY:t==="bottom"&&(i.CenterY=!n.get_locked()&&n.get_permissions().get_allowMoveVertical()?r.Top+r.Height-u.Height/2:i.CenterY):t==="left"?i.CenterX=!n.get_locked()&&n.get_permissions().get_allowMoveHorizontal()?e+u.Width/2:i.CenterX:t==="horizontalCenter"?i.CenterX=!n.get_locked()&&n.get_permissions().get_allowMoveHorizontal()?this.get_workspaceWidth()/2:i.CenterX:t==="right"?i.CenterX=!n.get_locked()&&n.get_permissions().get_allowMoveHorizontal()?this.get_workspaceWidth()-e-u.Width/2:i.CenterX:t==="top"?i.CenterY=!n.get_locked()&&n.get_permissions().get_allowMoveVertical()?o+u.Height/2:i.CenterY:t==="verticalCenter"?i.CenterY=!n.get_locked()&&n.get_permissions().get_allowMoveVertical()?this.get_workspaceHeight()/2:i.CenterY:t==="bottom"&&(i.CenterY=!n.get_locked()&&n.get_permissions().get_allowMoveVertical()?this.get_workspaceHeight()-o-u.Height/2:i.CenterY),this.get_history().get_trackingEnabled()&&this.get_history().addVObjectChanged(n),n.set_rectangle(i),this._isPlaceholder(n)&&!n.isEmptyContent()&&(f=n.get_content().get_rectangle(),f.CenterX=i.CenterX,f.CenterY=i.CenterY,n.get_content().set_rectangle(f)),this._selection.update(),this.redraw(!0)},alignVObjects:function(n){var r,e,f,i,t,u;if(this.get_selectedVObjects().get_count()>1){for(r=this.get_selectedVObjects().get_item(0).get_rectangle(),e=this.get_history().get_trackingEnabled()&&this.get_selectedVObjects().get_count()>2,e&&this.get_history().startVObjectGroupCommand(),f=1;f<this.get_selectedVObjects().get_count();f++)i=this.get_selectedVObjects().get_item(f),t=i.get_rectangle(),n==="left"?t.CenterX=!i.get_locked()&&i.get_permissions().get_allowMoveHorizontal()?r.get_location().X+t.Width/2:t.CenterX:n==="horizontalCenter"?t.CenterX=!i.get_locked()&&i.get_permissions().get_allowMoveHorizontal()?r.CenterX:t.CenterX:n==="right"?t.CenterX=!i.get_locked()&&i.get_permissions().get_allowMoveHorizontal()?r._getBottomRightCorner().X-t.Width/2:t.CenterX:n==="top"?t.CenterY=!i.get_locked()&&i.get_permissions().get_allowMoveVertical()?r.get_location().Y+t.Height/2:t.CenterY:n==="verticalCenter"?t.CenterY=!i.get_locked()&&i.get_permissions().get_allowMoveVertical()?r.CenterY:t.CenterY:n==="bottom"&&(t.CenterY=!i.get_locked()&&i.get_permissions().get_allowMoveVertical()?r._getBottomRightCorner().Y-t.Height/2:t.CenterY),this.get_history().get_trackingEnabled()&&this.get_history().addVObjectChanged(i),i.set_rectangle(t),this._isPlaceholder(i)&&!i.isEmptyContent()&&(u=i.get_content().get_rectangle(),u.CenterX=t.CenterX,u.CenterY=t.CenterY,i.get_content().set_rectangle(u)),this._selection.update(),this._needRedraw=!0,this.redraw();e&&this.get_history().endVObjectGroupCommand(),this.updateTexts()}},get_handlerUrl:function(){return this._handlerUrl},_deleteSelectedVObjectsWithoutConfirm:function(){var r=!1,u=this.get_history().get_trackingEnabled()&&this.get_selectedVObjects().get_count()>1,i,n,t;for(u&&this.get_history().startVObjectGroupCommand(),i=this.get_selectedVObjects().toArray(),n=0;n<i.length;n++)t=i[n],this._canDeleteVObject(t)&&(t.get_layer().get_vObjects().remove(t),r=!0);u&&this.get_history().endVObjectGroupCommand(),r&&(this.updateTexts(),this.redraw(!0))},_canDeleteVObject:function(n){return n!=null&&n.get_layer()!=null&&!n.get_locked()&&!n.get_layer().get_locked()&&n.get_visible()&&n.get_layer().get_visible()&&n.get_permissions()&&n.get_permissions().get_allowDelete()},"set_\u0441anDeleteVObjectsCallback":function(n){this._canDeleteVObjectsCallback=n},deleteSelectedVObjects:function(n){var e=typeof this._canDeleteVObjectsCallback!="function"||this._canDeleteVObjectsCallback(),r,t,f,i,u;if(!e)return;for(r=!1,t=0;t<this.get_selectedVObjects().get_count();t++){f=this.get_selectedVObjects().get_item(t);if(this._canDeleteVObject(f)){r=!0;break}}if(!r)return;n?(i=this.get_events().getHandler("selectedVObjectsDeleting"),i?i(this,this._onSelectedVObjectsDeletingDelegate):(u=confirm("Selected objects will be deleted. Continue?"),u&&this._deleteSelectedVObjectsWithoutConfirm())):this._deleteSelectedVObjectsWithoutConfirm()},get_ready:function(){return this._ready},get_tags:function(){return this._tags},set_tags:function(n){this._tags=n},get_width:function(){return this._workspaceWidth*this._zoom*this.get_screenXDpi()/72},get_height:function(){return this._workspaceHeight*this._zoom*this.get_screenYDpi()/72},get_keyEventEnabled:function(){return this._keyEventEnabled},set_keyEventEnabled:function(n){this._keyEventEnabled=n},get_marginColor:function(){return this._marginColor},set_marginColor:function(n){this._marginColor=n,this._needCompleteRedraw=!0},get_marginWidth:function(){return this._marginWidth},set_marginWidth:function(n){this._marginWidth=n,this._needCompleteRedraw=!0},get_selectionColor:function(){return this._selectionColor},set_selectionColor:function(n){this._selectionColor=n},get_selectionWidth:function(){return this._selectionWidth},set_selectionWidth:function(n){this._selectionWidth=n},get_margin:function(){return Math.min(this._leftRightMargin,this._topBottomMargin)},set_margin:function(n){this._leftRightMargin=n,this._topBottomMargin=n,this._needCompleteRedraw=!0},get_leftRightMargin:function(){return this._leftRightMargin},set_leftRightMargin:function(n){this._leftRightMargin=n,this._needCompleteRedraw=!0},get_topBottomMargin:function(){return this._topBottomMargin},set_topBottomMargin:function(n){this._topBottomMargin=n,this._needCompleteRedraw=!0},set_constrainedMarginEnabled:function(n){this._constrainedMarginEnabled=n},get_constrainedMarginEnabled:function(){return this._constrainedMarginEnabled},get_targetDpi:function(){return this._targetDpi},set_targetDpi:function(n){this._targetDpi=n},get_previewColorManagementEnabled:function(){return this._previewColorManagementEnabled},set_previewColorManagementEnabled:function(n){this._previewColorManagementEnabled!==n&&(this._previewColorManagementEnabled=n,this.get_isUpdating()||this._initialization||this._updateColors())},get_printColorManagementEnabled:function(){return this._printColorManagementEnabled},set_printColorManagementEnabled:function(n){this._printColorManagementEnabled=n},get_previewTargetColorSpace:function(){return this._previewTargetColorSpace},set_previewTargetColorSpace:function(n){this._previewTargetColorSpace!==n&&(this._previewTargetColorSpace=n,this.get_isUpdating()||this._initialization||this._updateColors())},_updateColors:function(){for(var i,n,r,t=0;t<this.get_layers().get_count();t++)for(i=this.get_layers().get_item(t),n=0;n<i.get_vObjects().get_count();n++)r=i.get_vObjects().get_item(n),r._updateColors();this.redraw(!0)},get_history:function(){return this._history},get_status:function(){return this._status},get_context:function(){var n=this.get_bottomCanvas();return n&&n.getContext?n.getContext("2d"):null},get_bottomCanvasId:function(){return this._id},get_designCanvasId:function(){return this._id!=null?this._id+"_design":null},get_bottomCanvas:function(){var n=this.get_bottomCanvasId();return this._document!=null&&n!=null?this._document.getElementById(n):null},get_designCanvas:function(){var n=this.get_designCanvasId();return this._document!=null&&n!=null?this._document.getElementById(n):null},get_canvasClientSideOptions:function(){return this._canvasClientSideOptions!=null?this._canvasClientSideOptions:this._canvasClientSideOptions=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.CanvasClientSideOptions},get_multipleSelectionEnabled:function(){return this._selection.get_multipleSelectionEnabled()},set_multipleSelectionEnabled:function(n){this._selection.set_multipleSelectionEnabled(n)},get_mouseMoveTimeout:function(){return this._mouseMoveTimeout},set_mouseMoveTimeout:function(n){this._mouseMoveTimeout=n},get_disableSmoothing:function(){return this._disableSmoothing},set_disableSmoothing:function(n){this._disableSmoothing=n},get_allVObjects:function(n,t){for(var s=[],c=this.get_layers(),e,f,r,o,i=0,h=c.get_count();i<h;i++){e=c.get_item(i);if(e.get_visible()||!n)for(f=e.get_vObjects(),r=0,o=f.get_count();r<o;r++){var u=f.get_item(r),a=!n||u.get_visible()&&!u.get_permissions().get_noShow(),l=t==null||t.isInstanceOfType(u);a&&l&&s.push(u)}}return s},updateTexts:function(n){for(var s=Aurigma.GraphicsMill.AjaxControls.VectorObjects,c=s.BoundedTextVObject.isInstanceOfType(n)?n.get_uniqueId():null,o=this.get_layers(),f,u,i,e,t,r=0,h=o.get_count();r<h;r++){f=o.get_item(r);if(f.get_visible())for(u=f.get_vObjects(),i=0,e=u.get_count();i<e;i++)t=u.get_item(i),t.get_uniqueId()!==c&&s.BoundedTextVObject.isInstanceOfType(t)&&t.get_visible()&&!t.get_permissions().get_noShow()&&t._updateWrappingRectangles()}},get_isSquaredBackground:function(){return this._isSquaredBackground},set_isSquaredBackground:function(n){this._isSquaredBackground=n;if(this.get_isInitialized()){var t="url("+this._backgroundImage+") repeat";this._isSquaredBackground||(t="transparent"),this.get_bottomCanvas().style.background=t}},get_loadingImageUrl:function(){return this._loadingImageUrl},set_loadingImageUrl:function(n){typeof n=="string"&&this._loadingImageUrl!==n&&(this._loadingImageUrl=n,this._waitClockImage&&(this._waitClockImage=new Image,this._waitClockImage.src=n))},get_workspaceWidth:function(){return this._workspaceWidth},set_workspaceWidth:function(n){this._workspaceWidth=n,this.set_zoom(this.get_zoom()),this._updateCanvasElementSize(),this._raiseEvent("workspaceSizeChanged")},get_workspaceHeight:function(){return this._workspaceHeight},set_workspaceHeight:function(n){this._workspaceHeight=n,this.set_zoom(this.get_zoom()),this._updateCanvasElementSize(),this._raiseEvent("workspaceSizeChanged")},set_workspaceSize:function(n,t){this._workspaceWidth=n,this._workspaceHeight=t,this.set_zoom(this.get_zoom()),this._raiseEvent("workspaceSizeChanged"),this._updateCanvasElementSize()},begin_initialization:function(){this._initialization=!0,this.get_history().pauseTracking()},end_initialization:function(){this.get_history().resumeTracking(),this._initialization=!1,this._raiseEvent("workspaceSizeChanged")},get_rotationGripColor:function(){return this._rotationGripColor},set_rotationGripColor:function(n){this._rotationGripColor=n,this._needRedraw=!0},get_resizeGripColor:function(){return this._resizeGripColor},set_resizeGripColor:function(n){this._resizeGripColor=n,this._needRedraw=!0},get_rotationGripSize:function(){return this._rotationGripSize},set_rotationGripSize:function(n){this._rotationGripSize=n,this._needRedraw=!0},get_resizeGripSize:function(){return this._resizeGripSize},set_resizeGripSize:function(n){this._resizeGripSize=n,this._needRedraw=!0},get_resizeGripLineColor:function(){return this._resizeGripLineColor},set_resizeGripLineColor:function(n){this._resizeGripLineColor=n,this._needRedraw=!0},get_rotationGripLineColor:function(){return this._rotationGripLineColor},set_rotationGripLineColor:function(n){this._rotationGripLineColor=n,this._needRedraw=!0},get_rotationGripLineLength:function(){return this._rotationGripLineLength},set_rotationGripLineLength:function(n){this._rotationGripLineLength=n,this._needRedraw=!0},get_buttonGroupCssClass:function(){return this._buttonGroupCssClass},set_buttonGroupCssClass:function(n){this._buttonGroupCssClass=n},get_selectButtonCssClass:function(){return this._selectButtonCssClass},set_selectButtonCssClass:function(n){this._selectButtonCssClass=n},get_editButtonCssClass:function(){return this._editButtonCssClass},set_editButtonCssClass:function(n){this._editButtonCssClass=n},get_doneButtonCssClass:function(){return this._doneButtonCssClass},set_doneButtonCssClass:function(n){this._doneButtonCssClass=n},get_selectButtonTitle:function(){return this._selectButtonTitle},set_selectButtonTitle:function(n){n=n!=null?n:"",this.get_selectButtonTitle()!==n&&(this._selectButtonTitle=n,this.updatePlaceholderButtonGroups())},get_editButtonTitle:function(){return this._editButtonTitle},set_editButtonTitle:function(n){n=n!=null?n:"",this.get_editButtonTitle()!==n&&(this._editButtonTitle=n,this.updatePlaceholderButtonGroups())},get_doneButtonTitle:function(){return this._doneButtonTitle},set_doneButtonTitle:function(n){n=n!=null?n:"",this.get_doneButtonTitle()!==n&&(this._doneButtonTitle=n,this.updatePlaceholderButtonGroups())},get_devicePixelRatio:function(){return window.devicePixelRatio||1},get_screenXDpi:function(){return this._screenXDpi=96*this.get_devicePixelRatio()},get_screenYDpi:function(){return this._screenYDpi=96*this.get_devicePixelRatio()},get_zoom:function(){return this._zoom},set_zoom:function(n,t){n=this._calculateZoom(n),(n!==this._zoom||this._zoom>this.get_maxZoom())&&(this._zoom=n,this._initialization||(this._updateCanvasElementSize(),t||this._raiseEvent("ZoomChanged")))},_calculateZoom:function(n){n<0&&(n=0);var t=this.get_maxZoom();return n=n>t?t:n},get_maxZoom:function(){var r=4,i=this,t=function(n){return Math.sqrt(n/(i._workspaceWidth*i._workspaceHeight*Math.pow(i.get_screenXDpi()/72,2)))},n;if(Aurigma.GraphicsMill.Utils.Platform.IsTouchDevice())return t(3e6);if(Sys.Browser.agent===Sys.Browser.InternetExplorer)if(Sys.Browser.version>=9&&Sys.Browser.documentMode>=9)return Math.min(589824/(this._workspaceWidth*this.get_screenXDpi()),589824/(this._workspaceHeight*this.get_screenYDpi()));return Sys.Browser.agent===Sys.Browser.Safari?(n=Math.min(2359224/(this._workspaceWidth*this.get_screenXDpi()),2359224/(this._workspaceHeight*this.get_screenYDpi())),Math.min(n,t(574619648/r))):Sys.Browser.agent===Sys.Browser.Firefox?(n=Math.min(2359224/(this._workspaceWidth*this.get_screenXDpi()),2359224/(this._workspaceHeight*this.get_screenYDpi())),Math.min(n,t(996147200/r))):2147483647},_updateCanvasElementSize:function(){var u=this.get_width(),r=this.get_height(),t,n,f,i;this._canvasElementSize||(this._canvasElementSize={}),t=this._canvasElementSize;if(u!==t.width||r!==t.height){for(t.width=u,t.height=r,f=[this.get_bottomCanvas(),this.get_designCanvas()],i=0;i<f.length;i++)n=f[i],n&&(n.width=Math.round(u),n.style.width=Math.round(u/this.get_devicePixelRatio())+"px",n.height=r,n.style.height=Math.round(r/this.get_devicePixelRatio())+"px");this.updatePlaceholderButtonGroups(),this._needCompleteRedraw=!0}},updateSelection:function(){this._selection.update()},get_selectedVObjects:function(){return this._selection.get_selectedVObjects()},set_selectedVObjects:function(n){this._selection.set_selectedVObjects(n)},isVObjectSelected:function(n){return this._selection.isVObjectSelected(n)},addSelectedVObject:function(n){this._selection.addSelectedVObject(n)},removeSelectedVObject:function(n){this._selection.removeSelectedVObject(n)},clearSelectedVObjects:function(){this._selection.clearSelectedVObjects()},get_currentVObject:function(){return this._selection.get_currentVObject()},_onCurrentVObjectChanged:function(n){n==null&&this._viewer.set_cursor(Aurigma.GraphicsMill.Cursor.defaultCursor),this._raiseEvent("currentVObjectChanged")},get_layers:function(){return this._layers},set_layers:function(n){this._layers=n},get_data:function(n){var t=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.CanvasData(this,n);return JSON.stringify(t)},set_data:function(n){if(n&&n!=""){var t=JSON.parse(n);Aurigma.GraphicsMill.AjaxControls.VectorObjects.CanvasData.applyState(t,this)}},get_returnValue:function(){return this._returnValue},invokeRemoteMethod:function(n,t){this._invokeServer(null,null,n,t)},_invokeServer:function(n,t,i,r){var o=Aurigma.GraphicsMill.AjaxControls.VectorObjects,f=Sys.Serialization.JavaScriptSerializer,v=o.Layer.isInstanceOfType(n),l=o.Canvas.isInstanceOfType(n),a=o.VObject.isInstanceOfType(n),h=-1,e=-1,u="",c=!1,y,s;if(l)u=f.serialize([t,i,"canvas",0,0,null]);else if(v)e=n.get_index(),u=f.serialize([t,i,"layer",e,0,null]);else if(a){if(t=="changed"&&!this.get_canvasClientSideOptions().CallbackOnVObjectChanged){if(!i)return!1;t=null}s=n.get_layer();if(!s)return!1;e=s.get_index(),h=n.get_index(),u=f.serialize([t,i,"object",e,h,r])}else i&&(u=f.serialize([null,i,null,0,0,r]),c=!0);this._callbackCollection.push(u),this._callbackArgs=f.serialize(this._callbackCollection);if(this._status==o.UpdateStatus.busy){if(this._callbackTimeout)return;this._callbackTimeout=setTimeout(this._callbackFunctionDelegate,this._callbackDelay)}else this._callbackTimeout||(this._callbackTimeout=setTimeout(this._callbackFunctionDelegate,this._callbackDelay));return!0},_callbackFunction:function(){this._status==Aurigma.GraphicsMill.AjaxControls.VectorObjects.UpdateStatus.busy?(clearTimeout(this._callbackTimeout),this._callbackTimeout=setTimeout(this._callbackFunctionDelegate,this._callbackDelay)):(clearTimeout(this._callbackTimeout),this._callbackTimeout=null,this._callbackCollection=[],this._status=Aurigma.GraphicsMill.AjaxControls.VectorObjects.UpdateStatus.busy,this._callbackCount==0&&this._raiseEvent("StatusChanged"),this._callbackContext++,this._callbackCount++,this._raiseEvent("invokingCallbackRequest"),this._saveState(),__theFormPostData="",__theFormPostCollection=[],WebForm_InitCallback(),this._callback(),this._onSendingRequest())},_callbackSuccess:function(n,t){this._onRequestComplete(),t==this._callbackContext&&(eval(n),this._callbackComplete())},_callbackError:function(n){this._onRequestComplete(),this._exceptionDescription=n,this._callbackComplete(),this._raiseCallbackException(n)},_callbackComplete:function(){this._callbackCount--,this._callbackCount==0&&(this._status=Aurigma.GraphicsMill.AjaxControls.VectorObjects.UpdateStatus.ready,this.redraw(),this._raiseEvent("StatusChanged"))},_onSendingRequest:function(){var n=this.get_events().getHandler("SendingRequest");n&&n(this)},_onRequestComplete:function(){var n=this.get_events().getHandler("RequestComplete");n&&n(this)},_raiseCallbackException:function(n){var t=this.get_events().getHandler("CallbackException");if(t)t(this,n);else throw n;},_raiseEvent:function(n,t){var i=this.get_events().getHandler(n);i&&(t==undefined&&(t=Sys.EventArgs.Empty),i(this,t))},add_sendingRequest:function(n){this.get_events().addHandler("SendingRequest",n)},remove_sendingRequest:function(n){this.get_events().removeHandler("SendingRequest",n)},add_requestComplete:function(n){this.get_events().addHandler("RequestComplete",n)},remove_requestComplete:function(n){this.get_events().removeHandler("RequestComplete",n)},add_zoomChanged:function(n){this.get_events().addHandler("ZoomChanged",n)},remove_zoomChanged:function(n){this.get_events().removeHandler("ZoomChanged",n)},add_statusChanged:function(n){this.get_events().addHandler("StatusChanged",n)},remove_statusChanged:function(n){this.get_events().removeHandler("StatusChanged",n)},add_callbackException:function(n){this.get_events().addHandler("CallbackException",n)},remove_callbackException:function(n){this.get_events().removeHandler("CallbackException",n)},add_initialized:function(n){this.get_events().addHandler("Initialized",n)},remove_initialized:function(n){this.get_events().removeHandler("Initialized",n)},add_invokingCallbackRequest:function(n){this.get_events().addHandler("invokingCallbackRequest",n)},remove_invokingCallbackRequest:function(n){this.get_events().removeHandler("invokingCallbackRequest",n)},raiseMouseMove:function(n){this._onMouseMove(n)},raiseMouseUp:function(n){this._onMouseUp(n)},raiseMouseDown:function(n){this._onMouseDown(n)},raiseDoubleClick:function(n){this._onDoubleClick(n)},raiseKeyDown:function(n){this._keyEventEnabled&&this._onKeyDown(n)},raiseKeyUp:function(n){this._keyEventEnabled&&this._onKeyUp(n)},add_vObjectCreated:function(n){this.get_events().addHandler("vObjectCreated",n)},remove_vObjectCreated:function(n){this.get_events().removeHandler("vObjectCreated",n)},add_currentVObjectChanged:function(n){this.get_events().addHandler("currentVObjectChanged",n)},remove_currentVObjectChanged:function(n){this.get_events().removeHandler("currentVObjectChanged",n)},add_selectedVObjectsChanged:function(n){this.get_events().addHandler("selectedVObjectsChanged",n)},remove_selectedVObjectsChanged:function(n){this.get_events().removeHandler("selectedVObjectsChanged",n)},add_selectedVObjectsDeleting:function(n){this.get_events().addHandler("selectedVObjectsDeleting",n)},remove_selectedVObjectsDeleting:function(n){this.get_events().removeHandler("selectedVObjectsDeleting",n)},add_ready:function(n){this.get_events().addHandler("ready",n)},remove_ready:function(n){this.get_events().removeHandler("ready",n)},add_workspaceSizeChanged:function(n){this.get_events().addHandler("workspaceSizeChanged",n)},remove_workspaceSizeChanged:function(n){this.get_events().removeHandler("workspaceSizeChanged",n)},_addInactiveCanvas:function(){if(this._id!=null){var t=this._id+"_inactive_"+this._inactiveCanvases.length,n=this._insertCanvas(t);if(n!=null)return this._inactiveCanvases.push(n),n}return null},_clearInactiveCanvases:function(){while(this._inactiveCanvases.length>0){var n=this._inactiveCanvases.pop();n.parentNode!=null&&n.parentNode.removeChild(n)}},_addActiveCanvas:function(){if(this._id!=null){var t=this._id+"_active_"+this._activeCanvases.length,n=this._insertCanvas(t);if(n!=null)return this._activeCanvases.push(n),n}return null},_clearActiveCanvases:function(){while(this._activeCanvases.length>0){var n=this._activeCanvases.pop();n.parentNode!=null&&n.parentNode.removeChild(n)}},_insertCanvas:function(n){var t=this._createCanvasElement(n),r,i;return t!=null?(r=Math.floor(this.get_width()),i=Math.floor(this.get_height()),t.width=r,t.style.width=Math.floor(r/this.get_devicePixelRatio())+"px",t.height=i,t.style.height=Math.floor(i/this.get_devicePixelRatio())+"px",this._parent.insertBefore(t,this.get_designCanvas()),t):null},_createCanvasElement:function(n){if(n!=null&&this._parent!=null){var t=this._document.createElement("canvas");return t.id=n,t.width=Math.round(this.get_width()),t.style.width=Math.round(this.get_width()/this.get_devicePixelRatio())+"px",t.height=Math.round(this.get_height()),t.style.height=Math.round(this.get_height()/this.get_devicePixelRatio())+"px",t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.pointerEvents="none",t}return null},_addElement:function(n){var i,r,u,t;if(this._viewer==null)return;this._removeElement(),this._parent=n,this._document=n.ownerDocument;if(!this._document)return;for(this._addPlaceholderButtonGroups(),i=this._createCanvasElement(this.get_bottomCanvasId()),i!=null&&(this._parent.appendChild(i),i.control=this),r=this._createCanvasElement(this.get_designCanvasId()),r!=null&&this._parent.appendChild(r),this.set_isSquaredBackground(this.get_isSquaredBackground()),u=this.get_allVObjects(),t=0;t<u.length;t++)u[t].update();this._needCompleteRedraw=!0},_removeElement:function(){var t=[this.get_bottomCanvas(),this.get_designCanvas()],r=t[0]!=null?t[0].parentNode:null,n,i;if(r!=null)for(n=t.length-1;n>=0;--n)i=t[n],i!=null&&r.removeChild(i);this._removePlaceholderButtonGroups(),this._document=null},_addPlaceholderButtonStyles:function(){if(this._viewer==null)return;this._placeholderButtonStyle!=null&&this._placeholderButtonStyle.remove();var n=this._viewer._jquery;this._placeholderButtonStyle=n("<style>").prop("type","text/css").html(".placeholderButtonsHidden {display: none;}.placeholderButtonsShown {display: -webkit-inline-flex;display: -ms-inline-flexbox;display: inline-flex;}").appendTo("head")},_isPlaceholder:function(n){return Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlaceholderVObject.isInstanceOfType(n)},_addPlaceholderButtonGroups:function(){var t,n;if(this._viewer==null)return;for(t=this.get_allVObjects(!1,Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlaceholderVObject),n=0;n<t.length;n++)this._addPlaceholderButtonGroup(t[n])},_removePlaceholderButtonGroups:function(){if(this._viewer==null)return;var t=this._viewer._jquery,n=t(this._parent);n.find("div").remove()},_addPlaceholderButtonGroup:function(n){var t,u,i,h,e,r,s;if(this._viewer==null||this._parent==null||n==null)return;if(!n._showEditButton()&&!n._showSelectButton())return;var f=this._viewer._jquery,c=f(this._parent),o=f("<div>");o.css("position","absolute"),t=this.get_buttonGroupCssClass(),u=f("<div>"),t!=null&&t!==""&&u.addClass(t),n._showSelectButton()&&(i=f('<button type="button">'),i.mousedown(function(n){n.stopPropagation()}).dblclick(function(n){n.stopPropagation()}),i.click(n._selectButtonClickHandler),h=this.get_selectButtonCssClass(),h!=null&&h!==""?i.addClass(h):i.text("Select"),n._selectButton=i,u.append(i)),n._showEditButton()&&!n.isStubOrEmpty()&&(n._editButton=this._addEditButton(u),n._editButton.click(n._editButtonClickHandler)),o.append(u),e=f("<div>"),t!=null&&t!==""&&e.addClass(t),n._showEditButton()&&(r=f('<button type="button">'),r.mousedown(function(n){n.stopPropagation()}).dblclick(function(n){n.stopPropagation()}),r.click(n._editButtonClickHandler),s=this.get_doneButtonCssClass(),s!=null&&s!==""?r.addClass(s):r.text("Done"),n._doneButton=r,e.append(r)),o.append(e),c.append(o),n._buttonGroup=o,n._editButtonGroup=u,n._doneButtonGroup=e,this._updatePlaceholderButtonGroup(n)},_addEditButton:function(n){var r,t,i;return this._viewer==null||this._parent==null?null:(r=this._viewer._jquery,t=r('<button type="button">'),t.mousedown(function(n){n.stopPropagation()}).dblclick(function(n){n.stopPropagation()}),i=this.get_editButtonCssClass(),i!=null&&i!==""?t.addClass(i):t.text("Edit"),n.append(t),t)},_removePlaceholderButtonGroup:function(n){var r,i,t;if(n==null||n._buttonGroup==null)return;for(r=[n._selectButton,n._editButton,n._doneButton],i=0;i<r.length;i++){t=r[i];if(t==null)continue;t.unbind("click"),t.unbind("mousedown"),t.unbind("dblclick")}n._buttonGroup.remove(),n._buttonGroup=null,n._editButtonGroup=null,n._doneButtonGroup=null,n._selectButton=null,n._editButton=null,n._doneButton=null},updatePlaceholderButtonGroups:function(){for(var t=this.get_allVObjects(!1,Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlaceholderVObject),n=0;n<t.length;n++)this._updatePlaceholderButtonGroup(t[n])},_updatePlaceholderButtonGroup:function(n){if(n==null||n._buttonGroup==null)return;if(!n.isVisible()||n.isLocked()){n._buttonGroup.css("visibility","hidden");return}n._buttonGroup.css("visibility","visible");var t=this.isVObjectSelected(n)?"auto":"none";n._buttonGroup.css({"pointer-events":t}),n._showEditButton()&&(n.isStubOrEmpty()||n._editButton!=null?n.isStubOrEmpty()&&n._editButton!=null&&(n._editButton.remove(),n._editButton=null):(n._editButton=this._addEditButton(n._editButtonGroup),n._editButton.click(n._editButtonClickHandler))),!n.get_editing()&&(n.isStubOrEmpty()||this.isVObjectSelected(n))&&(n._showSelectButton()||this.isVObjectSelected(n))?n._editButtonGroup.removeClass("placeholderButtonsHidden").addClass("placeholderButtonsShown"):n._editButtonGroup.removeClass("placeholderButtonsShown").addClass("placeholderButtonsHidden"),n.get_editing()?n._doneButtonGroup.removeClass("placeholderButtonsHidden").addClass("placeholderButtonsShown"):n._doneButtonGroup.removeClass("placeholderButtonsShown").addClass("placeholderButtonsHidden"),n._selectButton!=null&&n._selectButton.attr("title",this.get_selectButtonTitle()),n._editButton!=null&&(n._editButton.prop("disabled",n.isStubOrEmpty()||this.isVObjectSelected(n)&&this.get_selectedVObjects().get_count()>1),n._editButton.attr("title",this.get_editButtonTitle())),n._doneButton!=null&&n._doneButton.attr("title",this.get_doneButtonTitle()),this._updatePlaceholderButtonGroupPosition(n)},_updatePlaceholderButtonGroupPosition:function(n){if(this._viewer==null||this._parent==null||n==null||n._buttonGroup==null)return;var e=this._viewer._jquery,r=e(this._parent.parentElement).position(),t=n.get_rectangle(),i=this._viewer.workspaceToControlPoint(new Aurigma.GraphicsMill.PointF(t.CenterX,t.CenterY)),f=i.x-n._buttonGroup.outerWidth()/2-r.left,u=i.y-n._buttonGroup.outerHeight()/2-r.top;n._buttonGroup.css({left:f,top:u,position:"absolute"})},_placeholderButtonGroupHitTest:function(n,t){if(this._viewer==null||this._parent==null||n==null||n._buttonGroup==null)return!1;var i=this._getPlaceholderButtonGroupRect(n._buttonGroup);return i.contains(t)},_getPlaceholderButtonGroupRect:function(n){var o=this._viewer._jquery,r=o(this._parent.parentElement).position(),i=n.position(),e=i.left+r.left,s=i.top+r.top,h=n.outerWidth(),u=n.outerHeight(),f=new Aurigma.GraphicsMill.Rectangle(e,s,h,u),t=this._viewer.controlToWorkspaceRectangle(f);return new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RectangleF(t.x,t.y,t.width,t.height)},_insertPlaceholderButtonGroupAfter:function(n,t){if(this._viewer==null||n==null||n._buttonGroup==null)return!1;var i=this._viewer._jquery;return n._buttonGroup.insertAfter(i(t)),!0},redraw:function(n){if(this.get_isInitialized()&&!this.get_isUpdating()&&!this._initialization)try{this._needCompleteRedraw||n?(this._pendingRedrawTimeout&&(this._pendingRedrawTimeout=null),this._redrawAllCanvases()):this._needRedraw&&this._redrawActiveCanvas()}catch(t){if(t.name==="NS_ERROR_FAILURE")window.console&&typeof window.console.warn=="function"&&console.warn("canvas failure in canvas.redraw %s",t);else throw t;}},_redrawActiveCanvas:function(){var o,u,i,l,s,c,f,e,r,a,t,h,n;if(this._activeCanvases.length===0&&!this._selection._needRedraw)return;o=this.get_designCanvas();if(o==null)return;u=this._getScaledContext(o);if(u==null)return;for(i=[],n=0;n<this._activeCanvases.length;n++)l=this._getScaledContext(this._activeCanvases[n]),i.push(l);for(s=this.get_layers(),n=0,c=s.get_count();n<c;n++){f=s.get_item(n);if(f.get_visible())for(e=f.get_vObjects(),r=0,a=e.get_count();r<a;r++)t=e.get_item(r),t.get_visible()&&!t.get_permissions().get_noShow()&&(h=t._activeCanvasIndex,this.isVObjectSelected(t)&&h!==-1&&t.draw(i[h],!0))}for(this._selection.draw(u),n=0;n<i.length;n++)i[n].restore();u.restore()},_redrawAllCanvases:function(){var u,h,r,o,e,y,c,l,f,p,n;this._needCompleteRedraw=!1,u=this.get_bottomCanvas(),h=this.get_designCanvas();if(u==null||h==null)return;r=this._getScaledContext(u),o=this._getScaledContext(h);if(r==null||o==null)return;this._clearActiveCanvases(),this._clearInactiveCanvases(),this._drawMargins(r);if(this._status!==Aurigma.GraphicsMill.AjaxControls.VectorObjects.UpdateStatus.busy){var i=u,t=r,s=!1,a=-1,v=!1,w=this.get_layers();for(e=0,y=w.get_count();e<y;e++){c=w.get_item(e);if(c.get_visible())for(l=c.get_vObjects(),f=0,p=l.get_count();f<p;f++)n=l.get_item(f),n.get_visible()&&!n.get_permissions().get_noShow()&&(this.isVObjectSelected(n)?(s||(t.restore(),i=this._addActiveCanvas(),t=this._getScaledContext(i),s=!0,a=this._activeCanvases.length-1),n.draw(t,!0),this._isPlaceholder(n)&&this._insertPlaceholderButtonGroupAfter(n,h)):((s||v)&&(t.restore(),i=this._addInactiveCanvas(),t=this._getScaledContext(i),s=!1,a=-1,v=!1),n.draw(t,!1),this._isPlaceholder(n)&&(v=this._insertPlaceholderButtonGroupAfter(n,i))),n._activeCanvasIndex=a)}this._selection.draw(o),t.restore()}r.restore(),o.restore()},_getScaledContext:function(n){var t,r,i;if(n==null)return null;return t=n.getContext("2d"),t==null?null:(Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.clearCanvas(t),t.save(),r=this.get_screenXDpi()*this._zoom/72,i=this.get_screenYDpi()*this._zoom/72,t.scale(r,i),t)},_drawMargins:function(n){var i=this.get_leftRightMargin(),t=this.get_topBottomMargin(),f=this.get_workspaceWidth(),u=this.get_workspaceHeight(),o=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics,s=this._get_mul(),r=this.get_marginWidth()/s,e=this.get_marginColor();i!==0&&t!==0&&f>=i*2&&u>=t*2&&r>0&&(o.drawLine(n,i,t,i,u-t,r,e),o.drawLine(n,i,t,f-i,t,r,e),o.drawLine(n,f-i,u-t,i,u-t,r,e),o.drawLine(n,f-i,u-t,f-i,t,r,e))},_drawWaitClock:function(n,t){var r=this._get_mul(),i={Angle:0};i.CenterX=t.X||0,i.CenterY=t.Y||0,i.Width=this._waitClockImage.width/r,i.Height=this._waitClockImage.height/r,this._waitClockImage.complete&&Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.drawImage(n,this._waitClockImage,i,r,r)},workspaceToControl:function(n){var i=n.clone(),t=this.get_screenXDpi()/72*this.get_zoom();return i.scale(t,t),i.round()},controlToWorkspace:function(n){var i=n.clone(),t=72/(this.get_screenXDpi()*this.get_zoom());return i.scale(t,t),i},_onClick:function(n){n.type="click",n.x&&n.y&&this._processMouseEvent(n)},_onKeyDown:function(n){n.type="keydown",this._processKeyEvent(n)},_onKeyUp:function(n){n.type="keyup",this._processKeyEvent(n)},_isPrimaryPointer:function(n){var t=n.originalEvent;return t instanceof MouseEvent&&(t.button!=null||t.which!=null)?t.button!=null?t.button===0:t.which===1:t instanceof TouchEvent?t.touches.length===1||t.touches.length===0:t instanceof PointerEvent?t.isPrimary:n.which>0&&n.which===1},_onMouseMove:function(n){n.type="mousemove",n.x&&n.y&&this._processMouseEvent(n)},_onMouseUp:function(n){n.type="mouseup",n.x&&n.y&&this._isPrimaryPointer(n)&&this._processMouseEvent(n)},_onMouseDown:function(n){n.type="mousedown",n.x&&n.y&&this._isPrimaryPointer(n)&&this._processMouseEvent(n)},_onDoubleClick:function(n){n.type="dblclick",n.x&&n.y&&this._processMouseEvent(n)},getVObjectByHitTest:function(n){for(var i,r,t,e,f,u=this.get_layers().get_count()-1;u>=0;u--){i=this.get_layers().get_item(u);if(i.get_visible()&&!i.get_locked())for(r=i.get_vObjects().get_count()-1;r>=0;r--){t=i.get_vObjects().get_item(r);if(t.get_visible()&&!t.get_locked()&&!t.get_permissions().get_noShow()){e=this.isVObjectSelected(t),f=t.hitTest(n,e);if(f.body)return t}}}return null},_processKeyEvent:function(n){if(n.type!=="keydown"&&n.type!=="keyup")return;n.type==="keydown"&&n.keyCode===Sys.UI.Key.del?this.deleteSelectedVObjects(!0):(this._selection.processKeyEvent(n),this.redraw())},_processMouseEvent:function(n){var l=Aurigma.GraphicsMill.AjaxControls.VectorObjects,o=new l.Math.PointF(n.x,n.y),t=this.getVObjectByHitTest(o),s=t!=null&&this._isPlaceholder(t)&&this._placeholderButtonGroupHitTest(t,o),r=this._selection.hitTest(o),h,c,f,e,i,a,u;if(n.type==="mousedown"||n.type==="dblclick"){h=(n.ctrlKey||n.metaKey)&&this.get_multipleSelectionEnabled();if(t!=null){if(this.isVObjectSelected(t))h?this.removeSelectedVObject(t):this._selection.set_currentVObject(t);else if(!r.resize&&!r.rotate)if(h)this.addSelectedVObject(t);else{if(s&&Sys.Browser.agent===Sys.Browser.InternetExplorer&&(Sys.Browser.version<11||Sys.Browser.documentMode<11)){t._onSelectButtonClick();return}this.set_selectedVObjects([t])}}else r.body||r.resize||r.rotate||this.clearSelectedVObjects();this._mouseDownTimeStamp=+new Date,n.type==="dblclick"&&this.get_currentVObject()!=null&&this.get_currentVObject()._dispatchDoubleClickEvent(n)}else if(n.type==="mouseup")delete this._mouseDownTimeStamp,delete this._cursor;else if(n.type==="mousemove"){for(c=this.get_allVObjects(!0,l.PlaceholderVObject),f=0;f<c.length;f++)e=c[f],this.isVObjectSelected(e)||e._buttonGroup==null||e._buttonGroup.css({"pointer-events":"none"});s&&t._buttonGroup.css({"pointer-events":"auto"});if(this._mouseDownTimeStamp!=null&&+new Date-this._mouseDownTimeStamp<this.get_mouseMoveTimeout())return}i=this._cursor,a=i!=null,i==null&&(i=r.resize||r.rotate||t==null||this.isVObjectSelected(t)||s?s?Aurigma.GraphicsMill.Cursor.defaultCursor:this._selection.get_cursor(o):Aurigma.GraphicsMill.Cursor.pointer),this._viewer.set_cursor(i,a),n.type!=="mousemove"&&(this._cursor=n.type==="mousedown"?i:null),this._selection.processMouseEvent(n),n.type==="mousemove"&&this._needMouseMoveRedrawTimeout()?(u=this,u._mouseMoveRedrawTimeout==null&&(u._mouseMoveRedrawTimeout=setTimeout(function(){u.redraw(),u._mouseMoveRedrawTimeout=null},15))):this.redraw()},_needMouseMoveRedrawTimeout:function(){var i,n,t;if(Aurigma.GraphicsMill.Utils.Platform.IsGoogleChrome()||Aurigma.GraphicsMill.Utils.Platform.IsSafari())return!1;for(i=this.get_selectedVObjects(),n=0;n<i.get_count();n++){t=i.get_item(n);if(t instanceof Aurigma.GraphicsMill.AjaxControls.VectorObjects.ShapeVObject&&t._isHuge)return!0}return!1},isResizing:function(){return this._selection.isResizing()},initialize:function(){Aurigma.GraphicsMill.Utils.Platform.IsTouchDevice()&&this.set_rotationGripSize(20),this._onSelectedVObjectsChangedDelegate=Function.createDelegate(this,function(){this.updatePlaceholderButtonGroups(),this._selection.update(),this._raiseEvent("selectedVObjectsChanged")}),this.get_selectedVObjects().add_itemAdded(this._onSelectedVObjectsChangedDelegate),this.get_selectedVObjects().add_itemRemoved(this._onSelectedVObjectsChangedDelegate),this._onSelectedVObjectsDeletingDelegate=Function.createDelegate(this,this._deleteSelectedVObjectsWithoutConfirm),this._waitClockImage=new Image,this._waitClockImage.src=this._loadingImageUrl,this._callbackFunctionDelegate=Function.createDelegate(this,this._callbackFunction),this._document=document,this._redrawDelegate||(this._redrawDelegate=Function.createDelegate(this,this._redrawActiveCanvas)),this._redrawAllCanvasesDelegate||(this._redrawAllCanvasesDelegate=Function.createDelegate(this,this._redrawAllCanvases));var n=this.get_bottomCanvas().parentNode;this._addElement(n),Aurigma.GraphicsMill.AjaxControls.VectorObjects.Canvas.callBaseMethod(this,"initialize"),this.redraw(!0),this._saveState(),this._raiseEvent("Initialized",null),this._checkReady()},checkReady:function(){this._ready=!1,this._checkReady()},_checkReady:function(){var e,n,t,i,o,r,s,f,u;if(this._ready)return;for(e=this.get_layers(),n=[],t=0,i=e.get_count();t<i;t++)for(o=e.get_item(t).get_vObjects(),r=0,s=o.get_count();r<s;r++)f=o.get_item(r),f.get_ready()||n.push(f);if(n.length===0)this._ready=!0,this._raiseEvent("ready");else for(u=Function.createDelegate(this,function(t){for(var r=0,f=n.length;r<f;r++)if(n[r]==t){n[r].remove_ready(u),n.splice(r,1);break}n.length===0&&(this._ready=!0,this._raiseEvent("ready"))}),t=0,i=n.length;t<i;t++)n[t].add_ready(u)},dispose:function(){this._callbackFunctionDelegate=null,this.get_selectedVObjects().remove_itemAdded(this._onSelectedVObjectsChangedDelegate),this.get_selectedVObjects().remove_itemRemoved(this._onSelectedVObjectsChangedDelegate),delete this._onSelectedVObjectsChangedDelegate,delete this._onSelectedVObjectsDeletingDelegate,this._redrawDelegate&&(this._redrawDelegate=null),this._redrawAllCanvasesDelegate&&delete this._redrawAllCanvasesDelegate,Aurigma.GraphicsMill.AjaxControls.VectorObjects.Canvas.callBaseMethod(this,"dispose")},_saveState:function(){$get(this._hiddenFieldID).value=this.get_data()},hitTestSelection:function(n,t){var e=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math,f={},h=new e.Matrix,s,a;n.Angle!==0&&h.rotate(-n.Angle),h.translate(-n.CenterX,-n.CenterY),t=h.transformPoint(t,!0);var o=n.Width,u=n.Height,c=this._get_mul();f.body=new e.RectangleF(-o/2,-u/2,o,u).contains(t),f.resize=!1,f.resizeIndex=0;var p=Aurigma.GraphicsMill.Utils.Platform.IsTouchDevice()?33:this.get_resizeGripSize(),i=p/c,r=i/2,y=[null,new e.RectangleF(-o/2-r,-u/2-r,i,i),new e.RectangleF(o/2-r,-u/2-r,i,i),new e.RectangleF(o/2-r,u/2-r,i,i),new e.RectangleF(-o/2-r,u/2-r,i,i),new e.RectangleF(-o/2-r,0-r,i,i),new e.RectangleF(0-r,-u/2-r,i,i),new e.RectangleF(o/2-r,0-r,i,i),new e.RectangleF(0-r,u/2-r,i,i)];for(s=1,a=y.length;s<a;s++)if(y[s].contains(t)){f.resize=!0,f.resizeIndex=s;break}u<0&&(u=-u),f.rotate=!1,f.rotateIndex=0,i=this.get_rotationGripSize()/c;var w=0,b=-u/2-this.get_rotationGripLineLength()/c-i,l=t.X-w,v=t.Y-b;return l*l+v*v<i*i&&(f.rotate=!0,f.rotateIndex=6),f},_get_mul:function(){return this.get_zoom()*Math.max(this.get_screenXDpi()/72,this.get_screenYDpi()/72)/this.get_devicePixelRatio()},drawSelection:function(n,t,i){var f=Aurigma.GraphicsMill.AjaxControls.VectorObjects,u=this._get_mul(),r=f.Graphics;r.rectangle(n,t,this.get_selectionWidth()/u,this.get_selectionColor()),i=i||{rotate:!0,resize:!0,arbitraryResize:!0},(i.rotate||i.resize||i.arbitraryResize)&&r.drawGrips(n,t,{rotate:i.rotate,resize:i.resize,arbitraryResize:i.arbitraryResize,rotationGripColor:this.get_rotationGripColor(),rotationGripSize:this.get_rotationGripSize(),rotationGripLineColor:this.get_rotationGripLineColor(),rotationGripLineLength:this.get_rotationGripLineLength(),resizeGripColor:this.get_resizeGripColor(),resizeGripSize:this.get_resizeGripSize(),resizeGripLineColor:this.get_resizeGripLineColor(),mul:u})},drawRubberband:function(n,t){var o=this._get_mul(),f=1/o,e="rgba(0,0,0,1)",r="rgba(0,0,0,0)",i=2/o,u=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics;u.drawDashedLine(n,t.left,t.top,t.right,t.top,f,e,r,i,i),u.drawDashedLine(n,t.right,t.top,t.right,t.bottom,f,e,r,i,i),u.drawDashedLine(n,t.right,t.bottom,t.left,t.bottom,f,e,r,i,i),u.drawDashedLine(n,t.left,t.bottom,t.left,t.top,f,e,r,i,i)}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Canvas.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.Canvas",Sys.Component),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.CanvasClientSideOptions=function(){},Aurigma.GraphicsMill.AjaxControls.VectorObjects.CanvasClientSideOptions.prototype={CallbackOnVObjectChanged:!1},Aurigma.GraphicsMill.AjaxControls.VectorObjects.CanvasClientSideOptions.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.CanvasClientSideOptions"),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.CanvasData=function(n,t){var r,i;Aurigma.GraphicsMill.AjaxControls.VectorObjects.CanvasData.initializeBase(this);if(n){this.RgbCPId=n._rgbColorProfileFileId,this.CmykCPId=n._cmykColorProfileFileId,this.GrayscaleCPId=n._grayscaleColorProfileFileId,this.PreviewCM=n.get_previewColorManagementEnabled(),this.PrintCM=n.get_printColorManagementEnabled(),this.PTCS=n.get_previewTargetColorSpace(),this.Z=n.get_zoom(),this.TDpi=n.get_targetDpi(),this.XDpi=n.get_screenXDpi(),this.YDpi=n.get_screenYDpi();if(t===!1||t===undefined){for(this.WW=n._workspaceWidth,this.WH=n._workspaceHeight,r=n.get_layers(),this.L=[],this.HD=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.HistoryData(n.get_history()),i=0;i<r.get_count();i++)this.L.push(new Aurigma.GraphicsMill.AjaxControls.VectorObjects.LayerData(r.get_item(i)));this.CSO=n.get_canvasClientSideOptions(),this.ReGC=n.get_resizeGripColor(),this.RoGC=n.get_rotationGripColor(),this.ReGS=n.get_resizeGripSize(),this.RoGS=n.get_rotationGripSize(),this.RV=n.get_returnValue(),this.SB=n.get_isSquaredBackground(),this.MW=n.get_marginWidth(),this.MC=n.get_marginColor(),this.LRM=n.get_leftRightMargin(),this.TBM=n.get_topBottomMargin(),this.CM=n.get_constrainedMarginEnabled(),this.Tags=n.get_tags(),this.LIU=n.get_loadingImageUrl(),this.SC=n.get_selectionColor(),this.SW=n.get_selectionWidth(),this.ReGLC=n.get_resizeGripLineColor(),this.RoGLC=n.get_rotationGripLineColor(),this.RoGLL=n.get_rotationGripLineLength(),this.BGCC=n.get_buttonGroupCssClass(),this.SBCC=n.get_selectButtonCssClass(),this.EBCC=n.get_editButtonCssClass(),this.DBCC=n.get_doneButtonCssClass(),this.SBT=n.get_selectButtonTitle(),this.EBT=n.get_editButtonTitle(),this.DBT=n.get_doneButtonTitle(),this.MSE=n.get_multipleSelectionEnabled(),this.MMT=n.get_mouseMoveTimeout(),this.DS=n.get_disableSmoothing()}}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.CanvasData.applyState=function(n,t){var f,s,i,l,o;if(t&&n){t._initialization=!0,t.get_history().set_locked(!0),t.set_workspaceSize(n.WW,n.WH),t.set_targetDpi(n.TDpi),t._rgbColorProfileFileId=n.RgbCPId,t._cmykColorProfileFileId=n.CmykCPId,t._grayscaleColorProfileFileId=n.GrayscaleCPId,t.set_previewColorManagementEnabled(n.PreviewCM),t.set_printColorManagementEnabled(n.PrintCM),t.set_previewTargetColorSpace(n.PTCS);var i,e,u,r={},c=function(n){n.get_uniqueId&&(r[n.get_uniqueId()]=n)},h=t.get_layers();for(i=0,lscnt=h.get_count();i<lscnt;i++){for(u=h.get_item(i),c(u),f=u.get_vObjects(),e=0,objscnt=f.get_count();e<objscnt;e++)c(f.get_item(e));f.clear()}for(h.clear(),i=0;i<n.L.length;i++)s=n.L[i],u=r[s.ID]||new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Layer,r[s.ID]=null,Aurigma.GraphicsMill.AjaxControls.VectorObjects.LayerData.applyState(n.L[i],u,r),t.get_layers().add(u);for(l in r)o=r[l],o&&o.dispose();delete r,Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.HistoryData.applyState(n.HD,t.get_history()),t.get_history().set_locked(!1),t._returnValue=n.RV,t._canvasClientSideOptions=n.CSO,t.initialization=!0,t.set_resizeGripColor(n.ReGC),t.set_rotationGripColor(n.RoGC),t.set_resizeGripSize(n.ReGS),t.set_rotationGripSize(n.RoGS),t.set_isSquaredBackground(n.SB),t.set_marginColor(n.MC),t.set_marginWidth(n.MW),t.set_leftRightMargin(n.LRM),t.set_topBottomMargin(n.TBM),t.set_constrainedMarginEnabled(n.CM),t.set_tags(n.Tags),t.set_loadingImageUrl(n.LIU),t.set_selectionColor(n.SC),t.set_selectionWidth(n.SW),t.set_resizeGripLineColor(n.ReGLC),t.set_rotationGripLineColor(n.RoGLC),t.set_rotationGripLineLength(n.RoGLL),t.set_buttonGroupCssClass(n.BGCC),t.set_selectButtonCssClass(n.SBCC),t.set_editButtonCssClass(n.EBCC),t.set_doneButtonCssClass(n.DBCC),t.set_selectButtonTitle(n.SBT),t.set_editButtonTitle(n.EBT),t.set_doneButtonTitle(n.DBT),t.set_multipleSelectionEnabled(n.MSE),t.set_mouseMoveTimeout(n.MMT),t.set_disableSmoothing(n.DS),t._initialization=!1}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.CanvasData.prototype={L:[],XDpi:72,YDpi:72,Z:1,RV:null,PreviewCM:!1,PrintCM:!1},Aurigma.GraphicsMill.AjaxControls.VectorObjects.CanvasData.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.CanvasData",null),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.Collection=function(){this._collection=[]},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Collection.prototype={indexOf:function(n){return Array.indexOf(this._collection,n)},contains:function(n){return Array.contains(this._collection,n)},addRange:function(n){for(var t=0;t<n.length;t++)this.add(n[t])},add:function(n){this.insert(this._collection.length,n)},push:function(n){this.add(n)},insert:function(n,t){this._checkIfItemExists(t);if(n<0||n>this._collection.length)throw Error.argumentOutOfRange("index",n);Array.insert(this._collection,n,t),this._onItemAdded(n,t)},remove:function(n){if(!this.contains(n))throw Error.argument("item",Aurigma.GraphicsMill.AjaxControls.VectorObjects.Exceptions.itemNotFoundInCollection);return this.removeAt(this.indexOf(n))},removeAt:function(n){if(n<0||n>this._collection.length-1)throw Error.argumentOutOfRange("index",n);var t=this._collection[n];return this._collection.splice(n,1),this._onItemRemoved(n,t),t},move:function(n,t,i){typeof i=="boolean"||(i=!1);var r=this._collection[n];return r&&n>=0&&t>=0&&n!=t&&(this._collection.splice(n,1),Array.insert(this._collection,t,r),i||this._onItemMoved(n,t)),r},clear:function(){for(var t=this.get_count()-1,n=t;n>=0;n--)this.removeAt(n)},get_count:function(){return this._collection.length},get_item:function(n){return this._collection[n]},toArray:function(){return this._collection.slice()},_checkIfItemExists:function(n){if(Array.contains(this._collection,n))throw Error.argument("item",Aurigma.GraphicsMill.AjaxControls.VectorObjects.Exceptions.itemBelongsCollection);},_onItemAdded:function(n,t){var i=this.get_events().getHandler("ItemAdded");i&&i(this,{item:t,index:n})},add_itemAdded:function(n){this.get_events().addHandler("ItemAdded",n)},remove_itemAdded:function(n){this.get_events().removeHandler("ItemAdded",n)},_onItemRemoved:function(n,t){var i=this.get_events().getHandler("ItemRemoved");i&&i(this,{item:t,index:n})},add_itemRemoved:function(n){this.get_events().addHandler("ItemRemoved",n)},remove_itemRemoved:function(n){this.get_events().removeHandler("ItemRemoved",n)},_onItemMoved:function(n,t){var i=this.get_events().getHandler("ItemMoved");i&&i(this,{oldIndex:n,newIndex:t})},add_itemMoved:function(n){this.get_events().addHandler("ItemMoved",n)},remove_itemMoved:function(n){this.get_events().removeHandler("ItemMoved",n)}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Collection.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.Collection",Sys.Component),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.Color=function(n){this.Preview=typeof n.Preview=="string"&&n.Preview.length>0?n.Preview:null},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Color.createColor=function(n){return Aurigma.GraphicsMill.AjaxControls.VectorObjects.Color.isInstanceOfType(n)?n:typeof n=="object"&&n!=null?Aurigma.GraphicsMill.AjaxControls.VectorObjects.Color._from_data(n):typeof n=="string"&&n.length>0?n.indexOf("device-cmyk")===0?new Aurigma.GraphicsMill.AjaxControls.VectorObjects.CmykColor(n):new Aurigma.GraphicsMill.AjaxControls.VectorObjects.RgbColor(n):(console.warn("Unable to create color from value "+n),new Aurigma.GraphicsMill.AjaxControls.VectorObjects.RgbColor("rgba(0,0,0,1)"))},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Color._from_data=function(n){if(n.__type==="RgbColor")return new Aurigma.GraphicsMill.AjaxControls.VectorObjects.RgbColor(n);if(n.__type==="CmykColor")return new Aurigma.GraphicsMill.AjaxControls.VectorObjects.CmykColor(n);if(n.__type==="GrayscaleColor")return new Aurigma.GraphicsMill.AjaxControls.VectorObjects.GrayscaleColor(n);throw"Unsupported color type "+n.__type;},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Color.prototype={Preview:null,clone:function(){},equals:function(n){return Aurigma.GraphicsMill.AjaxControls.VectorObjects.Color.isInstanceOfType(n)&&this.Preview===n.Preview},toString:function(){},_get_preview:function(){},_get_data:function(){var n=Object.getType(this).getName().split("."),t;return n=n[n.length-1],t=this.clone(),t.__type=n,t}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Color.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.Color"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.RgbColor=function(n){var r,e,t,i,o,u,f;Aurigma.GraphicsMill.AjaxControls.VectorObjects.RgbColor.initializeBase(this,[n]);if(typeof n=="string"){if(n.indexOf("#")!==0&&n.indexOf("rgb")!==0)if(window.getComputedStyle)r=document.createElement("div"),r.style.color=n,document.body.appendChild(r),n=window.getComputedStyle(r).color,document.body.removeChild(r);else{console.warn("Unable to parse rgb color string "+n);return}e=/^\s*rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\,\s*(\d{1,}(\.\d{1,})?)\s*\)\s*;{0,1}\s*$/g,t=e.exec(n);if(t!=null&&t.length===6){i=(+t[4]*255).toFixed(0),i=Math.max(i,0),i=Math.min(i,255),this._init(+t[1],+t[2],+t[3],i);return}o=/^\s*rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)\s*;{0,1}\s*$/g,t=o.exec(n);if(t!=null&&t.length===4){this._init(+t[1],+t[2],+t[3],255);return}u=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,n=n.replace(u,function(n,t,i,r){return t+t+i+i+r+r}),f=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,t=f.exec(n),t!=null&&t.length===4&&this._init(parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),255)}else typeof n.R=="number"&&typeof n.G=="number"&&typeof n.B=="number"?this._init(n.R,n.G,n.B,typeof n.A=="number"?n.A:255):console.warn("Incorrect RgbColor format: "+n)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.RgbColor.prototype={R:0,G:0,B:0,A:255,clone:function(){return new Aurigma.GraphicsMill.AjaxControls.VectorObjects.RgbColor(this)},equals:function(n){var t=Aurigma.GraphicsMill.AjaxControls.VectorObjects.RgbColor.callBaseMethod(this,"equals",[n]);return t&&n instanceof Aurigma.GraphicsMill.AjaxControls.VectorObjects.RgbColor&&this.R===n.R&&this.G===n.G&&this.B===n.B&&this.A===n.A},toString:function(){return this._get_preview()},_get_preview:function(){if(this.A===255)return"rgb("+this.R+","+this.G+","+this.B+")";var n=(this.A/255).toFixed(7);return"rgba("+this.R+","+this.G+","+this.B+","+n+")"},_init:function(n,t,i,r){this.R=n,this.G=t,this.B=i,this.A=r,this.Preview==null&&(this.Preview=this._get_preview())}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.RgbColor.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.RgbColor",Aurigma.GraphicsMill.AjaxControls.VectorObjects.Color),Aurigma.GraphicsMill.AjaxControls.VectorObjects.CmykColor=function(n){var u,t,r;Aurigma.GraphicsMill.AjaxControls.VectorObjects.CmykColor.initializeBase(this,[n]);if(typeof n=="string"){u=/^\s*device-cmyk\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\,\s*(\d{1,3})\s*(\,\s*(\d{1,}(\.\d{1,})?))?\s*(\,\s*(.*)\s*)?\)\s*;{0,1}\s*$/g,t=u.exec(n);if(t!=null&&t.length===10){var o=+t[1],f=+t[2],s=+t[3],e=+t[4],i=255;t[6]!=undefined&&(i=(+t[6]*255).toFixed(0),i=Math.max(i,0),i=Math.min(i,255)),r=undefined,t[9]!=undefined&&(r=t[9]),this._init(o,f,s,e,i,r)}}else typeof n.C=="number"&&typeof n.M=="number"&&typeof n.Y=="number"&&typeof n.K=="number"?this._init(n.C,n.M,n.Y,n.K,typeof n.A=="number"?n.A:255):console.warn("Incorrect CmykColor format: "+n)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.CmykColor.prototype={C:255,M:255,Y:255,K:255,A:255,clone:function(){return new Aurigma.GraphicsMill.AjaxControls.VectorObjects.CmykColor(this)},equals:function(n){var t=Aurigma.GraphicsMill.AjaxControls.VectorObjects.CmykColor.callBaseMethod(this,"equals",[n]);return t&&n instanceof Aurigma.GraphicsMill.AjaxControls.VectorObjects.CmykColor&&this.C===n.C&&this.M===n.M&&this.Y===n.Y&&this.K===n.K&&this.A===n.A},toString:function(){var n=(this.A/255).toFixed(7);return"device-cmyk("+this.C+", "+this.M+", "+this.Y+", "+this.K+", "+n+", "+this.Preview+")"},_get_preview:function(){var i=255-Math.min(255,this.C*(255-this.K)+this.K),t=255-Math.min(255,this.M*(255-this.K)+this.K),n=255-Math.min(255,this.Y*(255-this.K)+this.K);return new Aurigma.GraphicsMill.AjaxControls.VectorObjects.RgbColor({R:i,G:t,B:n,A:this.A}).Preview},_init:function(n,t,i,r,u,f){this.C=n,this.M=t,this.Y=i,this.K=r,this.A=u,this.Preview==null&&(this.Preview=f!=undefined?f:this._get_preview())}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.CmykColor.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.CmykColor",Aurigma.GraphicsMill.AjaxControls.VectorObjects.Color),Aurigma.GraphicsMill.AjaxControls.VectorObjects.GrayscaleColor=function(n){Aurigma.GraphicsMill.AjaxControls.VectorObjects.GrayscaleColor.initializeBase(this,[n]),typeof n.L=="number"?this._init(n.L,typeof n.A=="number"?n.A:255):console.warn("Incorrect GrayscaleColor format: "+n)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.GrayscaleColor.prototype={L:0,A:255,clone:function(){return new Aurigma.GraphicsMill.AjaxControls.VectorObjects.GrayscaleColor(this)},equals:function(n){var t=Aurigma.GraphicsMill.AjaxControls.VectorObjects.GrayscaleColor.callBaseMethod(this,"equals",[n]);return t&&n instanceof Aurigma.GraphicsMill.AjaxControls.VectorObjects.GrayscaleColor&&this.L===n.L&&this.A===n.A},toString:function(){return this._get_preview()},_get_preview:function(){if(this.A===255)return"rgb("+this.L+","+this.L+","+this.L+")";var n=(this.A/255).toFixed(7);return"rgba("+this.L+","+this.L+","+this.L+","+n+")"},_init:function(n,t){this.L=n,this.A=t,this.Preview==null&&(this.Preview=this._get_preview())}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.GrayscaleColor.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.GrayscaleColor",Aurigma.GraphicsMill.AjaxControls.VectorObjects.Color),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.Exceptions={itemBelongsCollection:"The item already belongs to this collection, or to another collection.",itemNotFoundInCollection:"The item was not found in this collection.",setPointOutOfRange:"setPoint: Index out of range.",insertPointOutOfRange:"addPoint: Index out of range.",removePointOutOfRange:"removePoint: Index out of range."},Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.drawLine=function(n,t,i,r,u,f,e,o){!Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.isFullTransparentColor(e)&&f>0&&(o==null||o>0)&&(n.save(),o&&(n.globalAlpha=o),n.lineWidth=f,n.strokeStyle=e,n.beginPath(),n.moveTo(t,i),n.lineTo(r,u),n.closePath(),n.stroke(),n.restore())},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.drawDashedLine=function(n,t,i,r,u,f,e,o,s,h,c){var g;if(f>0&&s>0&&h>0&&(c==null||c>0)){n.save(),c&&(n.globalAlpha=c),n.lineWidth=f,r<t&&(g=t,t=r,r=g,g=i,i=u,u=g);var k=r-t,b=u-i,y=s+h,nt=Math.sqrt(k*k+b*b),d=Math.floor(nt/y);k/=nt/y,b/=nt/y;var p=k*(s/y),tt=k*(h/y),w=b*(s/y),it=b*(h/y),l=t,a=i,v;if(!Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.isFullTransparentColor(e)){for(n.strokeStyle=e,n.beginPath(),n.moveTo(l,a),v=0;v<d;v++)l+=p,a+=w,n.lineTo(l,a),l+=tt,a+=it,v+1<d&&n.moveTo(l,a);l+p<=r&&a+w<=u?(n.moveTo(l,a),n.lineTo(l+p,a+w)):(n.moveTo(l,a),n.lineTo(r,u)),n.closePath(),n.stroke()}l=t+p,a=i+w;if(!Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.isFullTransparentColor(o)){for(n.strokeStyle=o,n.beginPath(),n.moveTo(l,a),v=0;v<d;v++)l+=tt,a+=it,n.lineTo(l,a),l+=p,a+=w,v+1<d&&n.moveTo(l,a);l<r&&a<u&&(n.moveTo(l,a),n.lineTo(r,u)),n.closePath(),n.stroke()}n.restore()}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.drawPolyline=function(n,t,i,r,u){var f,o,e;if(!Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.isFullTransparentColor(r)&&i>0&&(u==null||u>0))if(t&&t.length>1){for(n.save(),u&&(n.globalAlpha=u),n.lineWidth=i,n.strokeStyle=r,n.beginPath(),n.moveTo(t[0].X,t[0].Y),f=1,o=t.length;f<o;++f)e=t[f],n.lineTo(e.X,e.Y);n.stroke(),n.restore()}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.drawPath=function(n,t,i,r,u,f,e){Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.path(n,t,i,r,null,u,f,e)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.fillPath=function(n,t,i,r,u,f){Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.path(n,t,i,r,u,0,null,f)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.path=function(n,t,i,r,u,f,e,o){var l=Aurigma.GraphicsMill.AjaxControls.VectorObjects,c=e!=null&&!l.Graphics.isFullTransparentColor(e)&&f>0,a=u!=null&&!l.Graphics.isFullTransparentColor(u),s,h;(c||a)&&(o==null||o>0)&&(n.save(),o&&(n.globalAlpha=o),s=r.toMatrix(),n.translate(i.X,i.Y),n.transform(s.m00,s.m10,s.m01,s.m11,s.m02,s.m12),n.translate(-i.X,-i.Y),t.draw(n),a&&(n.fillStyle=u,n.fill()),c&&(Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.EqualsOfFloatNumbers(r.get_scaleX(),r.get_scaleY())?f/=r.get_scaleX():(n.restore(),n.save(),o&&(n.globalAlpha=o),h=t.clone(),h.transform(r,i),h.draw(n)),n.lineWidth=f,n.strokeStyle=e,n.stroke()),n.restore())},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.clipPath=function(n,t){t.draw(n),n.clip()},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.drawImage=function(n,t,i,r,u,f,e,o){if(o==null||o>0){n.save(),o&&(n.globalAlpha=o),n.translate(i.CenterX,i.CenterY),n.rotate(Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.ConvertDegreeToRadian(i.Angle));var s=r!=undefined&&r!==0&&u!=undefined&&u!==0&&Math.abs(t.naturalWidth-i.Width*r)<1&&Math.abs(t.naturalHeight-i.Height*u)<1;f||(f=(n.mozImageSmoothingEnabled===!0||n.imageSmoothingEnabled===!0||n.msImageSmoothingEnabled===!0)&&Math.abs(i.Angle)%90<.01&&s),f&&(n.mozImageSmoothingEnabled=!1,n.imageSmoothingEnabled=!1,n.msImageSmoothingEnabled=!1);try{s?(n.scale(1/r,1/u),n.drawImage(t,-i.Width*r/2,-i.Height*u/2,t.naturalWidth,t.naturalHeight),n.scale(r,u)):n.drawImage(t,-i.Width/2,-i.Height/2,i.Width,i.Height),e&&!Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.isFullTransparentColor(e)&&(n.fillStyle=e,n.fillRect(-i.Width/2,-i.Height/2,i.Width,i.Height))}catch(h){}f&&(n.mozImageSmoothingEnabled=!0,n.imageSmoothingEnabled=!0,n.msImageSmoothingEnabled=!0),n.restore()}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.drawRectangle=function(n,t,i,r,u){Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.rectangle(n,t,i,r,null,u)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.fillRectangle=function(n,t,i,r){Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.rectangle(n,t,0,null,i,r)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.rectangle=function(n,t,i,r,u,f){var e=Aurigma.GraphicsMill.AjaxControls.VectorObjects,s=r&&!e.Graphics.isFullTransparentColor(r)&&i>0,o=u&&!e.Graphics.isFullTransparentColor(u);(s||o)&&(f==null||f>0)&&(n.save(),f&&(n.globalAlpha=f),n.translate(t.CenterX,t.CenterY),n.rotate(e.Math.ConvertDegreeToRadian(t.Angle)),o&&(n.fillStyle=u,n.fillRect(-t.Width/2,-t.Height/2,t.Width,t.Height)),s&&(n.lineWidth=i,n.strokeStyle=r,n.strokeRect(-t.Width/2,-t.Height/2,t.Width,t.Height)),n.restore())},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.circle=function(n,t,i,r,u,f,e){var h=Aurigma.GraphicsMill.AjaxControls.VectorObjects,s=f!=null&&!h.Graphics.isFullTransparentColor(f)&&u>0,o=e!=null&&!h.Graphics.isFullTransparentColor(e);(s||o)&&(n.save(),n.beginPath(),n.arc(t,i,r,0,2*Math.PI,!0),n.closePath(),o&&(n.fillStyle=e,n.fill()),s&&(n.lineWidth=u,n.strokeStyle=f,n.stroke()),n.restore())},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.drawGrips=function(n,t,i){n.save();var u=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math,f=i.mul?i.mul:1,e,r,o;if(i.resize){e=[new u.PointF(-t.Width/2,-t.Height/2),new u.PointF(t.Width/2,-t.Height/2),new u.PointF(t.Width/2,t.Height/2),new u.PointF(-t.Width/2,t.Height/2)],o=0;while((r=e[o++])!=null)r.rotate(t.Angle),r.translate(t.CenterX,t.CenterY),this.rectangle(n,new u.RotatedRectangleF(r.X,r.Y,i.resizeGripSize/f,i.resizeGripSize/f,0),1/f,i.resizeGripLineColor,i.resizeGripColor)}if(i.arbitraryResize){e=[new u.PointF(-t.Width/2,0),new u.PointF(0,-t.Height/2),new u.PointF(t.Width/2,0),new u.PointF(0,t.Height/2)],o=0;while((r=e[o++])!=null)r.rotate(t.Angle),r.translate(t.CenterX,t.CenterY),this.rectangle(n,new u.RotatedRectangleF(r.X,r.Y,i.resizeGripSize/f,i.resizeGripSize/f,0),1/f,i.resizeGripLineColor,i.resizeGripColor)}if(i.rotate){t.Height<0&&(t.Height=-t.Height),e=[new u.PointF(0,-t.Height/2),new u.PointF(0,-t.Height/2-i.rotationGripLineLength/f),new u.PointF(0,-t.Height/2-i.rotationGripLineLength/f-i.rotationGripSize/f)],o=0;while((r=e[o++])!=null)r.rotate(t.Angle),r.translate(t.CenterX,t.CenterY);this.drawLine(n,e[0].X,e[0].Y,e[1].X,e[1].Y,.5/f,i.rotationGripLineColor),r=e[2],this.circle(n,r.X,r.Y,i.rotationGripSize/f,.5/f,i.rotationGripLineColor,i.rotationGripColor)}n.restore()},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.drawSelection=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.drawSelection||function(n,t,i){var r=i.mul?i.mul:1;this.drawRectangle(n,t,i.width/r,i.color)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.isFullTransparentColor=function(n){var t,i;if(!n)return!1;t=n.A||n.a;if(t===0)return!0;if(typeof n=="string"){i=/^\s*rgba\(\s*\d{1,3}\s*,\s*\d{1,3}\s*,\s*\d{1,3}\s*\,\s*(\d{1,}(\.\d{1,})?)\s*\)\s*;{0,1}\s*$/i,t=i.exec(n);if(t)return t=parseFloat(t[1]),t===0?!0:!1}else return!1},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.clearCanvas=function(n,t){t&&(n.save(),n.setTransform(1,0,0,1,0,0)),n.clearRect(0,0,n.canvas.width,n.canvas.height),t&&n.restore()},Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.Layer=function(){Aurigma.GraphicsMill.AjaxControls.VectorObjects.Layer.initializeBase(this),this._visible=!0,this._locked=!1,this._vObjects=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.VObjectCollection(this),this._name="",this._region=null,this._canvas=null,this._uniqueId="l"+ +new Date+Math.round(Math.random()*1e3)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Layer.prototype={get_uniqueId:function(){return this._uniqueId},set_uniqueId:function(n){this._uniqueId=n},get_canvas:function(){return this._canvas},get_index:function(){var n=this.get_canvas();return n?n.get_layers().indexOf(this):-1},get_data:function(){var n=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.LayerData(this);return JSON.stringify(n)},set_data:function(n){if(n&&n!=""){var t=JSON.parse(n);Aurigma.GraphicsMill.AjaxControls.VectorObjects.LayerData.applyState(t,this)}},get_region:function(){return this._region},set_region:function(n){this._region=n},get_vObjects:function(){return this._vObjects},get_name:function(){return this._name},set_name:function(n){this._name=n},get_visible:function(){return this._visible},set_visible:function(n){var i,t;if(this._visible!==n){this._visible=n;if(this.get_visible())for(i=0;i<this.get_vObjects().get_count();i++)t=this.get_vObjects().get_item(i),(Aurigma.GraphicsMill.AjaxControls.VectorObjects.ContentVObject.isInstanceOfType(t)||Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlaceholderVObject.isInstanceOfType(t))&&t.update();this._canvas!=null&&(this._canvas._needCompleteRedraw=!0,this._canvas.updatePlaceholderButtonGroups())}},get_locked:function(){return this._locked},set_locked:function(n){this._locked!==n&&(this._locked=n,this._canvas!=null&&(this._canvas._needCompleteRedraw=!0,this._canvas.updatePlaceholderButtonGroups()))},_onRemovedFromCanvas:function(n){for(var i=this.get_vObjects(),r=i.get_count(),t=0;t<r;t++)i.get_item(t)._onRemovedFromCanvas(n)},_onAddedOnCanvas:function(n){for(var i=this.get_vObjects(),r=i.get_count(),t=0;t<r;t++)i.get_item(t)._onAddedOnCanvas(n)}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Layer.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.Layer",Sys.Component),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.LayerCollection=function(n){if(!n)throw Error.argumentNull("canvas");Aurigma.GraphicsMill.AjaxControls.VectorObjects.LayerCollection.initializeBase(this),this._canvas=n},Aurigma.GraphicsMill.AjaxControls.VectorObjects.LayerCollection.prototype={getLayerById:function(n){for(var i,t=0,r=this.get_count();t<r;t++){i=this.get_item(t);if(i.get_uniqueId()==n)return i}return null},getLayersByName:function(n){for(var i=[],t=0;t<this.get_count();t++)this.get_item(t).get_name()==n&&i.push(this.get_item(t));return i},getVObjectsByName:function(n){for(var u=[],r,t,i=0;i<this.get_count();i++)for(r=this.get_item(i),t=0;t<r.get_vObjects().get_count();t++)r.get_vObjects().get_item(t).get_name()==n&&u.push(r.get_vObjects().get_item(t));return u},_onLayerRemoved:function(n,t){var i=this._canvas,f,u,r;if(i){for(f=i.get_history(),f.get_trackingEnabled()&&f.addLayerRemoved(n,t),u=0;u<i.get_selectedVObjects().get_count();u++)r=i.get_selectedVObjects().get_item(u),r!=null&&r.get_layer()!=null&&r.get_layer().get_uniqueId()==n.get_uniqueId()&&i.removeSelectedVObject(r);i._needCompleteRedraw=!0,n._canvas=null,n._onRemovedFromCanvas(i)}},_onLayerAdded:function(n,t){var i=this._canvas,r;i&&(r=i.get_history(),r.get_trackingEnabled()&&r.addLayerAdded(n,t),n._canvas=i,i._needCompleteRedraw=!0,n._onAddedOnCanvas(i))},_onLayerMoved:function(n,t,i){var u=this._canvas,r;u&&(r=u.get_history(),r.get_trackingEnabled()&&r.addLayerMoved(n,t,i),u._needCompleteRedraw=!0)},removeAt:function(n){var t=this.get_item(n);Aurigma.GraphicsMill.AjaxControls.VectorObjects.LayerCollection.callBaseMethod(this,"removeAt",[n]),this._onLayerRemoved(t,n)},insert:function(n,t){if(t._canvas)throw Error.argument("item",Aurigma.GraphicsMill.AjaxControls.VectorObjects.Exceptions.itemBelongsCollection);Aurigma.GraphicsMill.AjaxControls.VectorObjects.LayerCollection.callBaseMethod(this,"insert",[n,t]),this._onLayerAdded(t,n)},move:function(n,t){var i=Aurigma.GraphicsMill.AjaxControls.VectorObjects.LayerCollection.callBaseMethod(this,"move",[n,t]);return i&&this._onLayerMoved(i,n,t),i},clear:function(){for(var t=this.get_count(),n=0;n<t;n++)this.get_item(n)._canvas=null;Aurigma.GraphicsMill.AjaxControls.VectorObjects.LayerCollection.callBaseMethod(this,"clear")}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.LayerCollection.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.LayerCollection",Aurigma.GraphicsMill.AjaxControls.VectorObjects.Collection),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.LayerData=function(n){var u,i,t,r;Aurigma.GraphicsMill.AjaxControls.VectorObjects.LayerData.initializeBase(this);if(n)for(this.N=n.get_name(),this.V=n.get_visible(),this.L=n.get_locked(),this.R=n.get_region(),this.ID=n.get_uniqueId(),this.VO=[],u=n.get_vObjects(),i=0;i<u.get_count();i++)t=u.get_item(i),r=new Aurigma.GraphicsMill.AjaxControls.VectorObjects[t._get_dataType()](t),r.__type=t._get_dataType(),this.VO.push({T:t._get_type(),D:r})},Aurigma.GraphicsMill.AjaxControls.VectorObjects.LayerData.applyState=function(n,t,i){var e=Aurigma.GraphicsMill.AjaxControls.VectorObjects,o,f,u,r;i||(i={});if(t)for(t.set_name(n.N),t.set_visible(n.V),t.set_locked(n.L),t.set_uniqueId(n.ID),n.R&&t.set_region(e.Math.RectangleF.FromObject(n.R)),o=t.get_vObjects(),f=0;f<n.VO.length;f++)u=n.VO[f].D,r=i[u.ID],r?(i[u.ID]=null,r.set_data(u)):(r=e.ObjectFactory.createObjectByType(n.VO[f].T,e),r.set_data(u),r.initialize()),o.add(r)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.LayerData.prototype={N:"",V:!0,L:!1,ID:"l"+ +new Date+Math.round(Math.random()*1e3),VO:[]},Aurigma.GraphicsMill.AjaxControls.VectorObjects.LayerData.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.LayerData",null),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.ObjectFactory=function(){},Aurigma.GraphicsMill.AjaxControls.VectorObjects.ObjectFactory.createObjectByType=function(n,t){t||(t=window),n=n.split(".");for(var r=0,i=t,u=n.length;r<u;r++)i=i[n[r]];return new i},Aurigma.GraphicsMill.AjaxControls.VectorObjects.ObjectFactory.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.ObjectFactory"),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.ParagraphSettings=function(n){n!=null&&(this.FirstLineIndent=typeof n.FirstLineIndent=="number"?n.FirstLineIndent:0,this.SpaceAfter=typeof n.SpaceAfter=="number"?n.SpaceAfter:0,this.SpaceBefore=typeof n.SpaceBefore=="number"?n.SpaceBefore:0)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.ParagraphSettings.prototype={FirstLineIndent:0,SpaceAfter:0,SpaceBefore:0,equals:function(n){return n instanceof Aurigma.GraphicsMill.AjaxControls.VectorObjects.ParagraphSettings&&this.FirstLineIndent===n.FirstLineIndent&&this.SpaceAfter===n.SpaceAfter&&this.SpaceBefore===n.SpaceBefore}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.ParagraphSettings.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.ParagraphSettings"),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.Permission=function(n,t){n==null&&(n={}),t==null&&(t=!0),this._noPrint=n.NoPrint==null?t:!!n.NoPrint,this._noShow=n.NoShow==null?t:!!n.NoShow,this._allowDelete=n.AllowDelete==null?t:!!n.AllowDelete,this._allowMoveHorizontal=n.AllowMoveHorizontal==null?t:!!n.AllowMoveHorizontal,this._allowMoveVertical=n.AllowMoveVertical==null?t:!!n.AllowMoveVertical,this._allowRotate=n.AllowRotate==null?t:!!n.AllowRotate,this._allowProportionalResize=n.AllowProportionalResize==null?t:!!n.AllowProportionalResize,this._allowArbitraryResize=n.AllowArbitraryResize==null?t:!!n.AllowArbitraryResize,this._allowEditContent=n.AllowEditContent==null?t:!!n.AllowEditContent,this._showEditButton=n.ShowEditButton==null?t:!!n.ShowEditButton,this._showSelectButton=n.ShowSelectButton==null?t:!!n.ShowSelectButton},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Permission.prototype={toActions:function(){var t=Aurigma.GraphicsMill.AjaxControls.VectorObjects.VObjectAction,n=t.none;return this._allowArbitraryResize&&(n|=t.arbitraryResize),this._allowProportionalResize&&(n|=t.proportionalResize),this._allowMoveHorizontal&&(n|=t.dragX),this._allowMoveVertical&&(n|=t.dragY),this._allowRotate&&(n|=t.rotate),n},fromActions:function(n){var t=Aurigma.GraphicsMill.AjaxControls.VectorObjects.VObjectAction;this._allowArbitraryResize=(n&t.arbitraryResize)===t.none,this._allowArbitraryResize=(n&t.proportionalResize)===t.none,this._allowMoveHorizontal=(n&t.dragX)===t.none,this._allowMoveVertical=(n&t.dragY)===t.none,this._allowRotate=(n&t.rotate)===t.none},clone:function(){var t=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Permission,n;for(n in this)this.hasOwnProperty(n)&&(t[n]=this[n]);return t},get_allowDelete:function(){return this._allowDelete},set_allowDelete:function(n){this._allowDelete=n},get_noPrint:function(){return this._noPrint},set_noPrint:function(n){this._noPrint=n},get_noShow:function(){return this._noShow},set_noShow:function(n){this._noShow=n},get_allowMoveHorizontal:function(){return this._allowMoveHorizontal},set_allowMoveHorizontal:function(n){this._allowMoveHorizontal=n},get_allowMoveVertical:function(){return this._allowMoveVertical},set_allowMoveVertical:function(n){this._allowMoveVertical=n},get_allowRotate:function(){return this._allowRotate},set_allowRotate:function(n){this._allowRotate=n},get_allowProportionalResize:function(){return this._allowProportionalResize},set_allowProportionalResize:function(n){this._allowProportionalResize=n},get_allowArbitraryResize:function(){return this._allowArbitraryResize},set_allowArbitraryResize:function(n){this._allowArbitraryResize=n},get_allowResize:function(){return this._allowProportionalResize||this._allowArbitraryResize},get_allowFreeMove:function(){return this._allowMoveHorizontal&&this._allowMoveVertical},get_allowMove:function(){return this._allowMoveHorizontal||this._allowMoveVertical},get_allowEditContent:function(){return this._allowEditContent},set_allowEditContent:function(n){this._allowEditContent=n},get_showEditButton:function(){return this._showEditButton},set_showEditButton:function(n){this._showEditButton=n},get_showSelectButton:function(){return this._showSelectButton},set_showSelectButton:function(n){this._showSelectButton=n}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Permission.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.Permission"),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.PermissionData=function(n){n&&(this.AllowDelete=n.get_allowDelete(),this.NoPrint=n.get_noPrint(),this.NoShow=n.get_noShow(),this.AllowMoveHorizontal=n.get_allowMoveHorizontal(),this.AllowMoveVertical=n.get_allowMoveVertical(),this.AllowRotate=n.get_allowRotate(),this.AllowProportionalResize=n.get_allowProportionalResize(),this.AllowArbitraryResize=n.get_allowArbitraryResize(),this.AllowEditContent=n.get_allowEditContent(),this.ShowEditButton=n.get_showEditButton(),this.ShowSelectButton=n.get_showSelectButton())},Aurigma.GraphicsMill.AjaxControls.VectorObjects.PermissionData.applyState=function(n,t){t&&n&&(n.AllowDelete!=null&&(t._allowDelete=!!n.AllowDelete),n.NoPrint!=null&&(t._noPrint=!!n.NoPrint),n.NoShow!=null&&(t._noShow=!!n.NoShow),n.AllowMoveHorizontal!=null&&(t._allowMoveHorizontal=!!n.AllowMoveHorizontal),n.AllowMoveVertical!=null&&(t._allowMoveVertical=!!n.AllowMoveVertical),n.AllowRotate!=null&&(t._allowRotate=!!n.AllowRotate),n.AllowProportionalResize!=null&&(t._allowProportionalResize=!!n.AllowProportionalResize),n.AllowArbitraryResize!=null&&(t._allowArbitraryResize=!!n.AllowArbitraryResize),n.AllowEditContent!=null&&(t._allowEditContent=!!n.AllowEditContent),n.ShowEditButton!=null&&(t._showEditButton=!!n.ShowEditButton),n.ShowSelectButton!=null&&(t._showSelectButton=!!n.ShowSelectButton))},Aurigma.GraphicsMill.AjaxControls.VectorObjects.PermissionData.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.PermissionData"),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.SelectionHandler=function(n){this._canvas=n,this._multipleSelectionEnabled=!1,this._currentVObject=null,this._vObjects=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Collection,this._rectangle=null,this._rubberband=null,this._region=null,this._needRedraw=!1},Aurigma.GraphicsMill.AjaxControls.VectorObjects.SelectionHandler.prototype={get_multipleSelectionEnabled:function(){return this._multipleSelectionEnabled},set_multipleSelectionEnabled:function(n){this._multipleSelectionEnabled=n},get_currentVObject:function(){return this._currentVObject},set_currentVObject:function(n){n!==this.get_currentVObject()&&(this._currentVObject=n,this._canvas._onCurrentVObjectChanged(n))},get_selectedVObjects:function(){return this._vObjects},set_selectedVObjects:function(n){this.clearSelectedVObjects();if(Object.prototype.toString.call(n)==="[object Array]"){this.get_multipleSelectionEnabled()||n.splice(1,n.length-1);for(var t=0;t<n.length;t++)this.addSelectedVObject(n[t])}},isVObjectSelected:function(n){return this._vObjects.contains(n)},addSelectedVObject:function(n){var t,i;for(!this.get_multipleSelectionEnabled()&&this._vObjects.get_count()>0&&this._vObjects.clear(),t=0;t<this._vObjects.get_count();t++)i=this._vObjects.get_item(t),this._canvas._isPlaceholder(i)&&i.set_editing(!1);n!=null&&this._vObjects.push(n),this.set_currentVObject(n),this._canvas._needCompleteRedraw=!0},removeSelectedVObject:function(n){this._vObjects.remove(n),this._canvas._isPlaceholder(n)&&n.set_editing(!1),this._vObjects.get_count()>0?this.set_currentVObject(this._vObjects.get_item(this._vObjects.get_count()-1)):this.set_currentVObject(null),this._canvas._needCompleteRedraw=!0},clearSelectedVObjects:function(){for(var t,n=0;n<this._vObjects.get_count();n++)t=this._vObjects.get_item(n),this._canvas._isPlaceholder(t)&&t.set_editing(!1);this._vObjects.clear(),this.set_currentVObject(null),this._canvas._needCompleteRedraw=!0},get_rectangle:function(){if(this._rectangle==null)return null;var n=this._rectangle.clone();return n.Width=Math.abs(n.Width),n.Height=Math.abs(n.Height),n},hitTest:function(n){var o=this.get_rectangle(),e,t,r,i,u,f;return o==null?(e=this._canvas.getVObjectByHitTest(n)==null,{selection:e}):(t=this._canvas.hitTestSelection(o,n),r=this._get_permissions(),t.rotate=t.rotate&&r.get_allowRotate(),t.resize&&(i=t.resizeIndex,u=r.get_allowArbitraryResize(),u=u&&(i===5||i===6||i===7||i===8),f=r.get_allowProportionalResize(),f=f&&(i===1||i===2||i===3||i===4),t.arbitraryResize=u,t.proportionalResize=f,t.resize=u||f),t.dragX=t.body&&r.get_allowMoveHorizontal(),t.dragY=t.body&&r.get_allowMoveVertical(),t.drag=t.dragX||t.dragY,t)},get_cursor:function(n){var i=this.hitTest(n),t=Aurigma.GraphicsMill.Cursor,f=this._get_permissions(),u,r;if(i.resize){u=this._rectangle.Angle,r=u>=45&&u<135||u>=225&&u<315;if(i.resizeIndex===1)return r?t.sizeNE:t.sizeNW;if(i.resizeIndex===2)return r?t.sizeSE:t.sizeNE;if(i.resizeIndex===3)return r?t.sizeSW:t.sizeSE;if(i.resizeIndex===4)return r?t.sizeNW:t.sizeSW;if(i.resizeIndex===5)return r?t.sizeN:t.sizeW;if(i.resizeIndex===6)return r?t.sizeE:t.sizeN;if(i.resizeIndex===7)return r?t.sizeS:t.sizeE;if(i.resizeIndex===8)return r?t.sizeW:t.sizeS}else{if(i.rotate)return t.cross;if(i.body&&(f.get_allowMoveHorizontal()||f.get_allowMoveVertical()))return t.move}return t.defaultCursor},update:function(){var i,n;if(this._vObjects.get_count()>0){if(this._vObjects.get_count()===1)this._rectangle=this._vObjects.get_item(0).get_selectionRectangle();else if(this._vObjects.get_count()>1){var t=this._vObjects.get_item(0).get_bounds(),r=t.Left,f=t.Top,u=t.Right,e=t.Bottom;for(i=1;i<this._vObjects.get_count();i++)n=this._vObjects.get_item(i).get_bounds(),r=Math.min(r,n.Left),f=Math.min(f,n.Top),u=Math.max(u,n.Right),e=Math.max(e,n.Bottom);this._rectangle=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RotatedRectangleF.FromLTRB(r,f,u,e)}this._region=this._get_region()}else this._rectangle=null,this._region=null},draw:function(n){var u,r,i,t,f;this._rubberband!=null?this._canvas.drawRubberband(n,this._rubberband):this._needRedraw=!1,u=this.get_rectangle();if(u==null||this._vObjects.get_count()===0)return;if(this._vObjects.get_count()===1)r=this._vObjects.get_item(0),this._canvas._isPlaceholder(r)&&r.get_editing()&&this._canvas.drawSelection(n,r.get_rectangle(),{});else for(i=0;i<this._vObjects.get_count();i++)this._canvas.drawSelection(n,this._vObjects.get_item(i).get_selectionRectangle(),{});t=this._get_permissions(),f={rotate:t.get_allowRotate(),resize:t.get_allowProportionalResize()||t.get_allowArbitraryResize(),arbitraryResize:t.get_allowArbitraryResize()},this._canvas.drawSelection(n,u,f)},processKeyEvent:function(n){if(this._rectangle==null)return;var t=this._get_permissions(),i=(n.keyCode===Sys.UI.Key.left||n.keyCode===Sys.UI.Key.right)&&t.get_allowMoveHorizontal()||(n.keyCode===Sys.UI.Key.up||n.keyCode===Sys.UI.Key.down)&&t.get_allowMoveVertical();if(!i)return;n.type==="keydown"?this._keyPushed||n.altKey||n.ctrlKey||n.metaKey?this._keyCode===n.keyCode&&this._move(n.keyCode):(this._keyPushed=!0,this._keyCode=n.keyCode,this._startTransform(),this._move(n.keyCode)):n.type==="keyup"&&this._keyPushed&&this._keyCode===n.keyCode&&(this._keyPushed=!1,this._endTransform())},processMouseEvent:function(n){var r=Aurigma.GraphicsMill.AjaxControls.VectorObjects,t=new r.Math.PointF(n.x,n.y);if(n.type==="mousedown")this._operation=this.hitTest(t),this._startPoint=t,this._startTransform(),this._startRubberbandSelection();else if(n.type==="mouseup")this._endTransform(this._operation&&this._operation.resize),this._endRubberbandSelection(),delete this._startPoint,delete this._operation;else if(n.type==="mousemove")if(this._operation!=null&&this._startPoint!=null)if(this._operation.selection)this._updateRubberband(t);else if(this._operation.resize)this._resize(t);else if(this._operation.rotate)this._rotate(t,!(n.ctrlKey||n.metaKey));else if(this._operation.drag){var i=this._get_permissions(),e=i.get_allowMoveVertical(),o=i.get_allowMoveHorizontal(),u=o?n.x:this._startPoint.X,f=e?n.y:this._startPoint.Y;this._drag(new r.Math.PointF(u,f))}},isResizing:function(){return this._operation&&this._operation.resize},_startTransform:function(){if(this._rectangle==null)return;this._startRectangle=this._rectangle.clone();for(var n=0;n<this._vObjects.get_count();n++)this._vObjects.get_item(n)._startTransform()},_endTransform:function(n){var t,r,i;if(this._rectangle==null)return;for(t=!this._rectangle.isEqual(this._startRectangle),r=this._canvas.get_history().get_trackingEnabled()&&t&&this._vObjects.get_count()>1,r&&this._canvas.get_history().startVObjectGroupCommand(),i=0;i<this._vObjects.get_count();i++)this._vObjects.get_item(i)._endTransform(t),t&&n&&this._vObjects.get_item(i)._onResized();r&&this._canvas.get_history().endVObjectGroupCommand(),t&&this._canvas.updateTexts(),delete this._startRectangle,this._vObjects.get_count()===1&&n&&this.update(),t&&this._canvas.get_history()._raiseChanged()},_startRubberbandSelection:function(){this._canvas._viewer!=null&&this._canvas._viewer.ignoreDocumentClickOnce()},_endRubberbandSelection:function(){var i,r,u,f,t,n;if(this._rubberband==null)return;i=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math,r=i.RectangleF.FromLTRB(this._rubberband.left,this._rubberband.top,this._rubberband.right,this._rubberband.bottom);if(!i.EqualsOfFloatNumbers(r.Width,0)&&!i.EqualsOfFloatNumbers(r.Height,0)){for(u=[],f=this._canvas.get_allVObjects(!0),t=0;t<f.length;t++)n=f[t],!n.isLocked()&&r.contains(n.get_rectangle().get_center())&&u.push(n);this.set_selectedVObjects(u)}this._rubberband=null},_updateRubberband:function(n){if(!this.get_multipleSelectionEnabled()||this._startPoint==null)return;this._rubberband={left:Math.min(this._startPoint.X,n.X),top:Math.min(this._startPoint.Y,n.Y),right:Math.max(this._startPoint.X,n.X),bottom:Math.max(this._startPoint.Y,n.Y)},this._needRedraw=!0},_resize:function(n){var u,t=this._rectangle.clone(),a=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.PointF(n.X-this._startRectangle.CenterX,n.Y-this._startRectangle.CenterY),r;a.rotate(-t.Angle),r=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.PointF(this._startPoint.X-this._startRectangle.CenterX,this._startPoint.Y-this._startRectangle.CenterY),r.rotate(-t.Angle);var i=a.translate(-r.X,-r.Y),o=[0,-1,1,1,-1,-1,0,1,0],f=[0,-1,-1,1,1,0,-1,0,1],l={left:6,top:5},e=1;if(this._operation.arbitraryResize)t.Width=this._startRectangle.Width+i.X*o[this._operation.resizeIndex],t.Height=this._startRectangle.Height+i.Y*f[this._operation.resizeIndex],(this._operation.resizeIndex===l.left||this._operation.resizeIndex===l.top)&&(e=-1);else{var c=i.X*o[this._operation.resizeIndex]/this._startRectangle.Width,s=i.Y*f[this._operation.resizeIndex]/this._startRectangle.Height,h=c<s?c:s;i.X=this._startRectangle.Width*h,i.Y=this._startRectangle.Height*h,t.Width=this._startRectangle.Width+i.X,t.Height=this._startRectangle.Height+i.Y}this._get_allowNegativeResize()||t.Width>0&&t.Height>0?(u=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.PointF(i.X/2*o[this._operation.resizeIndex],i.Y/2*f[this._operation.resizeIndex]),u.rotate(t.Angle),t.CenterX=this._startRectangle.CenterX+u.X*e,t.CenterY=this._startRectangle.CenterY+u.Y*e):(t.Width=Math.max(t.Width,1),t.Height=Math.max(t.Height,1)),this._updateRectangle(t)},_drag:function(n){var r=Aurigma.GraphicsMill.AjaxControls.VectorObjects,t=new r.Math.PointF(n.X-this._startPoint.X,n.Y-this._startPoint.Y),i;t=this._constrainDiffToRegion(this._startRectangle.get_bounds(),t),i=this._rectangle.clone(),i.CenterX=this._startRectangle.CenterX+t.X,i.CenterY=this._startRectangle.CenterY+t.Y,this._updateRectangle(i)},_rotate:function(n,t){var f=Aurigma.GraphicsMill.AjaxControls.VectorObjects,s=n.clone(),o=this._startPoint,u=this._rectangle.clone(),h=new f.Math.PointF(u.CenterX,u.CenterY),i=f.Math.getTriangleAngle(s,o,h),r=t?90:-1,e;i=f.Math.normalizeAngle(this._startRectangle.Angle+i),e=i%r,e<5?i=r*Math.floor(i/r):e>r-5&&(i=r*Math.floor(i/r+1)),i=f.Math.normalizeAngle(i),u.Angle=i,this._updateRectangle(u)},_move:function(n){var r=1/this._canvas._get_mul(),t=null,i;switch(n){case Sys.UI.Key.up:t={X:0,Y:-r};break;case Sys.UI.Key.down:t={X:0,Y:r};break;case Sys.UI.Key.left:t={X:-r,Y:0};break;case Sys.UI.Key.right:t={X:r,Y:0}}t!=null&&(t=this._constrainDiffToRegion(this._rectangle.get_bounds(),t),i=this._rectangle.clone(),i.CenterX+=t.X,i.CenterY+=t.Y,this._updateRectangle(i))},_get_permissions:function(){var n,i,r,t;if(this._rectangle==null||this._vObjects.get_count()===0)return new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Permission({},!1);for(n=this._vObjects.get_item(0).get_permissions().clone(),this._vObjects.get_count()>1&&(this._rectangle.Angle-this._vObjects.get_item(0).get_angle())%90!=0&&n.set_allowArbitraryResize(!1),i=1;i<this._vObjects.get_count();i++)r=this._vObjects.get_item(i),t=r.get_permissions(),t.get_allowMoveHorizontal()||n.set_allowMoveHorizontal(!1),t.get_allowMoveVertical()||n.set_allowMoveVertical(!1),t.get_allowRotate()||n.set_allowRotate(!1),t.get_allowProportionalResize()||n.set_allowProportionalResize(!1),t.get_allowArbitraryResize()&&(this._rectangle.Angle-r.get_angle())%90==0||n.set_allowArbitraryResize(!1);return n},_get_allowNegativeResize:function(){if(this._rectangle==null||this._vObjects.get_count()===0)return!1;for(var n=0;n<this._vObjects.get_count();n++)if(!this._vObjects.get_item(n)._allowNegativeResize)return!1;return!0},_get_region:function(){var i=null,r,n,f,t,u,e;for(this._canvas.get_constrainedMarginEnabled()&&this._canvas.get_margin()>0&&(r=this._canvas.get_margin(),i=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RectangleF(r,r,this._canvas.get_workspaceWidth()-r,this._canvas.get_workspaceHeight()-r)),n=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Collection,f=0;f<this._vObjects.get_count();f++)t=this._vObjects.get_item(f).get_layer(),t==null||t.get_region()==null||n.contains(t)||n.add(t);for(u=0;u<n.get_count();u++)e=n.get_item(u).get_region(),i=i!=null?Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RectangleF.intersect(i,e):e;return i},_updateRectangle:function(n){if(this._region!=null&&!this._region.containsRectangle(n.get_bounds()))return;this._rectangle=n;for(var t=0;t<this._vObjects.get_count();t++)this._vObjects.get_item(t)._transformRectangle(this._startRectangle,this._rectangle)},_constrainDiffToRegion:function(n,t){return this._region!=null&&(n.Left+t.X<this._region.Left&&(t.X=this._region.Left-n.Left),n.Top+t.Y<this._region.Top&&(t.Y=this._region.Top-n.Top),n.Right+t.X>this._region.Left+this._region.Width&&(t.X=this._region.Left+this._region.Width-n.Right),n.Bottom+t.Y>this._region.Top+this._region.Height&&(t.Y=this._region.Top+this._region.Height-n.Bottom)),t},_set_angle:function(n){this._startTransform();var t=this._rectangle.clone();t.Angle=n,this._updateRectangle(t),this._endTransform(),this._canvas.redraw()}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.SelectionHandler.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.SelectionHandler"),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.Transform=function(n,t,i,r,u){Aurigma.GraphicsMill.AjaxControls.VectorObjects.Transform.initializeBase(this),this._angle=u?u:0,this._scaleX=n||n===0?n:1,this._scaleY=t||n===0?t:1,this._translateX=i?i:0,this._translateY=r?r:0},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Transform.prototype={add_transformChanged:function(n){this.get_events().addHandler("transformChanged",n)},remove_transformChanged:function(n){this.get_events().removeHandler("transformChanged",n)},_onTransformChanged:function(){var n=this.get_events().getHandler("transformChanged");n&&n(this)},_setProperty:function(n,t,i){var r="_"+n;this[r]!==t&&(this[r]=t,i||this._onTransformChanged())},get_angle:function(){return this._angle},set_angle:function(n,t){this._setProperty("angle",n,t)},get_scaleX:function(){return this._scaleX},set_scaleX:function(n,t){this._setProperty("scaleX",n,t)},get_scaleY:function(){return this._scaleY},set_scaleY:function(n,t){this._setProperty("scaleY",n,t)},get_translateX:function(){return this._translateX},set_translateX:function(n,t){this._setProperty("translateX",n,t)},get_translateY:function(){return this._translateY},set_translateY:function(n,t){this._setProperty("translateY",n,t)},move:function(n,t){var i=this.clone();n!=null&&this.set_translateX(this.get_translateX()+n,!0),t!=null&&this.set_translateY(this.get_translateY()+t,!0),i.isEqual(this)||this._onTransformChanged()},rotate:function(n){if(n==null||Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.EqualsOfFloatNumbers(n,0))return;this._angle+=n,this._onTransformChanged()},clone:function(){return new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Transform(this._scaleX,this._scaleY,this._translateX,this._translateY,this._angle)},isEqual:function(n,t){var i=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math;return n!=null&&i.EqualsOfFloatNumbers(this._scaleX,n._scaleX,t)&&i.EqualsOfFloatNumbers(this._scaleY,n._scaleY,t)&&i.EqualsOfFloatNumbers(this._translateX,n._translateX,t)&&i.EqualsOfFloatNumbers(this._translateY,n._translateY,t)&&i.EqualsOfFloatNumbers(this._angle,n._angle,t)},toMatrix:function(){var n=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math,r=this.get_angle(),i=Math.sin(n.ConvertDegreeToRadian(r)),t=Math.cos(n.ConvertDegreeToRadian(r));return new n.Matrix(t*this.get_scaleX(),i*this.get_scaleX(),-i*this.get_scaleY(),t*this.get_scaleY(),this.get_translateX(),this.get_translateY())}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Transform.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.Transform",Sys.Component),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.UpdateStatus=function(){throw Error.notImplemented();},Aurigma.GraphicsMill.AjaxControls.VectorObjects.UpdateStatus.prototype={ready:0,refresh:1,busy:2},Aurigma.GraphicsMill.AjaxControls.VectorObjects.UpdateStatus.registerEnum("Aurigma.GraphicsMill.AjaxControls.VectorObjects.UpdateStatus"),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.Command=function(){},Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.Command.prototype={get_events:function(){return this._events||(this._events=new Sys.EventHandlerList),this._events},add_executed:function(n){this.get_events().addHandler("executed",n)},remove_executed:function(n){this.get_events().removeHandler("executed",n)},execute:function(){var i=this.get_events().getHandler("executed");typeof i=="function"&&i(this,{rollBack:!1})},unExecute:function(){var i=this.get_events().getHandler("executed");typeof i=="function"&&i(this,{rollBack:!0})}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.Command.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.Command",null),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.History=function(n){this._canvas=n,this._maxUndoStepCount=10,this._current=-1,this._enable=!1,this._locked=!1,this._trackingEnabled=!0,this._commands=[],this._events=null,this._overflowMaxUndoStepCount=!1,this._vObjectGroupCommand=null},Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.History.prototype={get_events:function(){return this._events||(this._events=new Sys.EventHandlerList),this._events},get_enable:function(){return this._enable},set_enable:function(n){n||this.clear(),this._enable=n},get_locked:function(){return this._locked},set_locked:function(n){this._locked=n},get_trackingEnabled:function(){return this._trackingEnabled},set_trackingEnabled:function(n){this._trackingEnabled=n},pauseTracking:function(){this._prevTrackingState=this.get_trackingEnabled(),this._prevTrackingState&&this.set_trackingEnabled(!1)},resumeTracking:function(){this._prevTrackingState===!0&&this.set_trackingEnabled(!0)},get_maxUndoStepCount:function(){return this._maxUndoStepCount},set_maxUndoStepCount:function(n){this._maxUndoStepCount=n},set_current:function(n){this._current=n},get_current:function(){return this._current},get_commands:function(){return this._commands},set_commands:function(n){this._commands=n},get_canvas:function(){return this._canvas},get_canRedo:function(){return this._current<this._commands.length-1},get_canUndo:function(){return this._current>=0},_clearRedo:function(){this._commands.splice(this._current+1,this._commands.length-(this._current+1))},clearRedo:function(){this.get_canRedo()&&(this._clearRedo(),this._raiseChanged())},_clearUndo:function(){this._commands.splice(0,this._current+1),this._current=-1,this._overflowMaxUndoStepCount=!1},clearUndo:function(){this.get_canUndo()&&(this._clearUndo(),this._raiseChanged())},clear:function(n){var r=this.get_canRedo(),t,i;r&&this._clearRedo(),t=this.get_canUndo(),t&&this._clearUndo(),i=this.get_overflowMaxUndoStepCount(),i&&(this._overflowMaxUndoStepCount=!1),!n&&(r||t||i)&&this._raiseChanged()},get_overflowMaxUndoStepCount:function(){return this._overflowMaxUndoStepCount},startVObjectGroupCommand:function(){this._vObjectGroupCommand=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectGroupCommand},endVObjectGroupCommand:function(){if(this._vObjectGroupCommand==null||this._vObjectGroupCommand.isEmpty())this._vObjectGroupCommand=null;else{var n=this._vObjectGroupCommand;this._vObjectGroupCommand=null,this.addCommand(n)}},addCommand:function(n){if(n&&n.execute&&n.unExecute)this._addCommand(n);else throw new Error("Not a command");},_addCommand:function(n){if(!n)throw"Command can not be null";this.get_enable()&&!this.get_locked()&&n&&(this._vObjectGroupCommand!=null?this._vObjectGroupCommand.addCommand(n):(this.get_canRedo()&&this._clearRedo(),this._commands.push(n),this._current++,this._current+1>this._maxUndoStepCount&&(this._commands.splice(0,1),this._current--,this._overflowMaxUndoStepCount=!0),this._raiseChanged()))},redo:function(){if(this.get_enable()&&this.get_canRedo()){this._locked=!0,this._current+=1;var n=this._commands[this._current];n.execute(this._canvas),this._locked=!1,this._raiseChanged(),n.ClassName!="Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlaceholderVObject"&&this.get_canvas().redraw(!0)}},undo:function(){if(this.get_enable()&&this.get_canUndo()){this._locked=!0;var n=this._commands[this._current];n.unExecute(this._canvas),this._current-=1,this._locked=!1,this._raiseChanged(),n.ClassName!="Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlaceholderVObject"&&this.get_canvas().redraw(!0)}},_defaultVObjectChangedFactMethod:function(n,t,i){return new Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectChangedCommand(n,t,i)},_get_VObjectChangedFactMethod:function(){return typeof this.vObjectChangedFactMethod=="function"?this.vObjectChangedFactMethod:this._defaultVObjectChangedFactMethod},vObjectChangedFactMethod:null,addVObjectChanged:function(n,t,i){if(this.get_enable()&&!this.get_locked()){t||t==0||(t=n.get_index()),i||i==0||(i=n.get_layer().get_index());var r=this._get_VObjectChangedFactMethod()(n,t,i);r.LayerIndex>-1&&r.VObjectIndex>-1&&this._addCommand(r)}},_defaultVObjectRemovedFactMethod:function(n,t,i){return new Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectRemovedCommand(n,t,i)},_get_VObjectRemovedFactMethod:function(){return typeof this.vObjectRemovedFactMethod=="function"?this.vObjectRemovedFactMethod:this._defaultVObjectRemovedFactMethod},vObjectRemovedFactMethod:null,addVObjectRemoved:function(n,t,i){if(this.get_enable()&&!this.get_locked()){t||t==0||(t=n.get_index()),!i&&i!=0&&n.get_layer()&&(i=n.get_layer().get_index());var r=this._get_VObjectRemovedFactMethod()(n,t,i);r.LayerIndex>-1&&r.VObjectIndex>-1&&this._addCommand(r)}},_defaultVObjectAddedFactMethod:function(n,t,i){return new Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectAddedCommand(n,t,i)},_get_VObjectAddedFactMethod:function(){return typeof this.vObjectAddedFactMethod=="function"?this.vObjectAddedFactMethod:this._defaultVObjectAddedFactMethod},vObjectAddedFactMethod:null,addVObjectAdded:function(n,t,i){if(this.get_enable()&&!this.get_locked()){t||t==0||(t=n.get_index()),i||i==0||(i=n.get_layer().get_index());var r=this._get_VObjectAddedFactMethod()(n,t,i);r.LayerIndex>-1&&r.VObjectIndex>-1&&this._addCommand(r)}},_defaultVObjectMovedFactMethod:function(n,t,i,r){return new Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectMovedCommand(n,t,i,r)},_get_VObjectMovedFactMethod:function(){return typeof this.vObjectMovedFactMethod=="function"?this.vObjectMovedFactMethod:this._defaultVObjectMovedFactMethod},vObjectMovedFactMethod:null,addVObjectMoved:function(n,t,i,r){if(this.get_enable()&&!this.get_locked()){var u=this._get_VObjectMovedFactMethod()(n,t,i,r);u.LayerIndex>-1&&u.NewVObjectIndex>-1&&u.OldVObjectIndex>-1&&this._addCommand(u)}},addLayerRemoved:function(n,t){if(this.get_enable()&&!this.get_locked()){t||t==0||(t=n.get_index());var i=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.LayerRemovedCommand(n,t);i.LayerIndex>-1&&this._addCommand(i)}},addLayerAdded:function(n,t){if(this.get_enable()&&!this.get_locked()){t||t==0||(t=n.get_index());var i=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.LayerAddedCommand(n,t);i.LayerIndex>-1&&this._addCommand(i)}},addLayerMoved:function(n,t,i){if(this.get_enable()&&!this.get_locked()){var r=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.LayerMovedCommand(n,t,i);r.NewLayerIndex>-1&&r.OldLayerIndex>-1&&this._addCommand(r)}},_raiseChanged:function(n){var t=this.get_events().getHandler("changed");t&&(n==undefined&&(n=Sys.EventArgs.Empty),t(this,n))},add_changed:function(n){this.get_events().addHandler("changed",n)},remove_changed:function(n){this.get_events().removeHandler("changed",n)},lockHistory:function(n){var t=this._locked;return this._locked=n,t}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.History.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.History",null),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.HistoryData=function(n){var u,t,r,i;this.Cur=-1,this.E=!1,this.L=!1,this.US=10,this.T=!0,this.C=[];if(n)for(this.Cur=n.get_current(),this.E=n.get_enable(),this.L=n.get_locked(),this.US=n.get_maxUndoStepCount(),this.T=n.get_trackingEnabled(),this.C=[],u=n.get_commands(),t=0;t<u.length;t++){var f=u[t],s=Object.getType(f).getName(),e="";if(s!="Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectGroupCommand"||f.isEmpty())e=JSON.stringify(u[t]);else{for(r={},r._commands=[],i=0;i<f.get_commands().length;i++){var o=f.get_commands()[i],c=Object.getType(o).getName(),h=JSON.stringify(o);r._commands.push({D:h,T:c})}e=JSON.stringify(r)}this.C.push({D:e,T:s})}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.HistoryData.applyState=function(n,t){var r,u;if(!n)return;for(t.set_current(n.Cur),t.set_enable(n.E),t.set_locked(n.L),t.set_maxUndoStepCount(n.US),t.set_trackingEnabled(n.T),t.set_commands([]),r=0;r<n.C.length;r++)if(n.C[r].D){var s=n.C[r].T,i=JSON.parse(n.C[r].D),f=Aurigma.GraphicsMill.AjaxControls.VectorObjects.ObjectFactory.createObjectByType(s);if(s=="Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectGroupCommand"&&i._commands.length>0)for(u=0;u<i._commands.length;u++){var h=i._commands[u].T,e=JSON.parse(i._commands[u].D),o=Aurigma.GraphicsMill.AjaxControls.VectorObjects.ObjectFactory.createObjectByType(h);for(memberName in e)o[memberName]=e[memberName];f.addCommand(o)}else for(memberName in i)f[memberName]=i[memberName];t.get_commands().push(f)}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.HistoryData.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.HistoryData",null),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.LayerAddedCommand=function(n,t){this.LayerIndex=-1,this.LayerData=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.LayerData,n&&(this.LayerData=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.LayerData(n)),t&&(this.LayerIndex=t)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.LayerAddedCommand.prototype={execute:function(n){var t=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Layer(n);Aurigma.GraphicsMill.AjaxControls.VectorObjects.LayerData.applyState(this.LayerData,t),n.get_layers().insert(this.LayerIndex,t),Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.LayerAddedCommand.callBaseMethod(this,"execute")},unExecute:function(n){this.LayerData=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.LayerData(n.get_layers().get_item(this.LayerIndex)),n.get_layers().removeAt(this.LayerIndex),Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.LayerAddedCommand.callBaseMethod(this,"unExecute")}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.LayerAddedCommand.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.LayerAddedCommand",Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.Command),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.LayerMovedCommand=function(n,t,i){this.OldLayerIndex=new Number(t),isNaN(this.OldLayerIndex)&&(this.OldLayerIndex=-1),this.NewLayerIndex=new Number(i),isNaN(this.NewLayerIndex)&&(this.NewLayerIndex=-1)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.LayerMovedCommand.prototype={execute:function(n){n.get_layers().move(this.OldLayerIndex,this.NewLayerIndex),Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.LayerMovedCommand.callBaseMethod(this,"execute")},unExecute:function(n){n.get_layers().move(this.NewLayerIndex,this.OldLayerIndex),Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.LayerMovedCommand.callBaseMethod(this,"unExecute")}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.LayerMovedCommand.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.LayerMovedCommand",Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.Command),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.LayerRemovedCommand=function(n,t){Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.LayerRemovedCommand.initializeBase(this,[n,t])},Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.LayerRemovedCommand.prototype={execute:function(n){Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.LayerRemovedCommand.callBaseMethod(this,"unExecute",[n])},unExecute:function(n){Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.LayerRemovedCommand.callBaseMethod(this,"execute",[n])}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.LayerRemovedCommand.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.LayerRemovedCommand",Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.LayerAddedCommand),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectAddedCommand=function(n,t,i){Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectAddedCommand.initializeBase(this),this.VObjectIndex=-1,this.LayerIndex=-1,this.Data="",this.ClassName="",this.VObjectBoundData=null,this.VObjectId="",n&&(this.Data=n.get_data(),this.ClassName=Object.getType(n).getName(),this.VObjectId=n.get_uniqueId()),(t||t==0)&&(this.VObjectIndex=t),(i||i==0)&&(this.LayerIndex=i)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectAddedCommand.prototype={add_vObjectRestored:function(n){this.get_events().addHandler("vObjectRestored",n)},remove_vObjectRestored:function(n){this.get_events().removeHandler("vObjectRestored",n)},add_vObjectDelete:function(n){this.get_events().addHandler("vObjectDeleted",n)},remove_vObjectDelete:function(n){this.get_events().removeHandler("vObjectDeleted",n)},execute:function(n,t){var i=Aurigma.GraphicsMill.AjaxControls.VectorObjects.ObjectFactory.createObjectByType(this.ClassName),r;i.set_data(this.Data),i.initialize(),n.get_layers().get_item(this.LayerIndex).get_vObjects().insert(this.VObjectIndex,i),r=this.get_events().getHandler("vObjectRestored"),typeof r=="function"&&r(this,i),t||n.updateTexts(),Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectAddedCommand.callBaseMethod(this,"execute")},unExecute:function(n,t){var u=n.get_layers().get_item(this.LayerIndex).get_vObjects(),i=u.getVObjectById(this.VObjectId),r=this.get_events().getHandler("vObjectDeleted");typeof r=="function"&&r(this,i),this.Data=i.get_data(),u.remove(i),t||n.updateTexts(),Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectAddedCommand.callBaseMethod(this,"unExecute")}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectAddedCommand.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectAddedCommand",Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.Command),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectChangedCommand=function(n,t,i){Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectChangedCommand.initializeBase(this,[n,t,i])},Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectChangedCommand.prototype={execute:function(n,t){var i=n.get_layers().get_item(this.LayerIndex).get_vObjects().getVObjectById(this.VObjectId),u=i.get_data(),r;i.set_data(this.Data),this.Data=u,t||n.updateTexts(i),i.update(),n.isVObjectSelected(i)&&n.updateSelection(),r=this.get_events().getHandler("executed"),typeof r=="function"&&r(this,{rollBack:!1})},unExecute:function(n,t){this.execute(n,t);var i=this.get_events().getHandler("executed");typeof i=="function"&&i(this,{rollBack:!0})}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectChangedCommand.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectChangedCommand",Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectAddedCommand),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectGroupCommand=function(){Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectGroupCommand.initializeBase(this),this._commands=[]},Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectGroupCommand.prototype={execute:function(n){for(var r=Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo,t,i=0;i<this._commands.length;i++)t=this._commands[i],t&&t.execute&&t.unExecute&&t.execute(n,!0);n.updateTexts(),Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectGroupCommand.callBaseMethod(this,"execute")},unExecute:function(n){for(var r=Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo,t,i=this._commands.length-1;i>=0;i--)t=this._commands[i],t&&t.execute&&t.unExecute&&t.unExecute(n,!0);n.updateTexts(),Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectGroupCommand.callBaseMethod(this,"unExecute")},addCommand:function(n){this._commands.push(n)},isEmpty:function(){return this._commands.length==0},get_commands:function(){return this._commands}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectGroupCommand.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectGroupCommand",Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.Command),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectMovedCommand=function(n,t,i,r){Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectMovedCommand.initializeBase(this),this.OldVObjectIndex=new Number(t),isNaN(this.OldVObjectIndex)&&(this.OldVObjectIndex=-1),this.NewVObjectIndex=new Number(i),isNaN(this.NewVObjectIndex)&&(this.NewVObjectIndex=-1),this.LayerIndex=new Number(r),isNaN(this.LayerIndex)&&(this.LayerIndex=-1)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectMovedCommand.prototype={execute:function(n,t){n.get_layers().get_item(this.LayerIndex).get_vObjects().move(this.OldVObjectIndex,this.NewVObjectIndex),t||n.updateTexts(),Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectMovedCommand.callBaseMethod(this,"execute")},unExecute:function(n,t){n.get_layers().get_item(this.LayerIndex).get_vObjects().move(this.NewVObjectIndex,this.OldVObjectIndex),t||n.updateTexts(),Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectMovedCommand.callBaseMethod(this,"unExecute")}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectMovedCommand.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectMovedCommand",Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.Command),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectRemovedCommand=function(n,t,i){Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectRemovedCommand.initializeBase(this,[n,t,i])},Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectRemovedCommand.prototype={execute:function(n,t){Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectRemovedCommand.callBaseMethod(this,"unExecute",[n,t])},unExecute:function(n,t){Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectRemovedCommand.callBaseMethod(this,"execute",[n,t])}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectRemovedCommand.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectRemovedCommand",Aurigma.GraphicsMill.AjaxControls.VectorObjects.RedoUndo.VObjectAddedCommand),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.getOrientedSquare=function(n,t,i){return n.X*t.Y+n.Y*i.X+t.X*i.Y-(i.X*t.Y+t.X*n.Y+i.Y*n.X)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.getBounds=function(n){var r,o;if(n.length==0)return new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RectangleF(0,0,0,0);var t=n[0],u=t.X,e=t.X,i=t.Y,f=t.Y;for(r=1,o=n.length;r<o;++r)t=n[r],u=Math.min(u,t.X),e=Math.max(e,t.X),i=Math.min(i,t.Y),f=Math.max(f,t.Y);return new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RectangleF(u,i,e-u,f-i)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.getTriangleAngle=function(n,t,i){var s=Math.pow(n.X-t.X,2)+Math.pow(n.Y-t.Y,2),f=Math.pow(n.X-i.X,2)+Math.pow(n.Y-i.Y,2),u=Math.pow(t.X-i.X,2)+Math.pow(t.Y-i.Y,2),o=0,e,r;return u*f!=0&&(o=(-s+u+f)/(2*Math.sqrt(u)*Math.sqrt(f))),e=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.getOrientedSquare(n,t,i),r=Math.acos(o),e>0&&(r=-r),Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.ConvertRadianToDegree(r)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.normalizeAngle=function(n){return n=n%360,n<0&&(n+=360),n},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.getScalarProduct=function(n,t){return n.X*t.X+n.Y*t.Y},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.getSquareDistanceToSegment=function(p,p1,p2){var c2,b,ph;with(Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math){var v=new PointF(p2.X-p1.X,p2.Y-p1.Y),w=new PointF(p.X-p1.X,p.Y-p1.Y),c1=getScalarProduct(w,v);if(c1<=0)return getSquareDistanceToPoint(p,p1);return c2=getScalarProduct(v,v),c2<c1?getSquareDistanceToPoint(p,p2):(b=c1/c2,ph=new PointF(p1.X+v.X*b,p1.Y+v.Y*b),getSquareDistanceToPoint(p,ph))}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.getSquareDistanceToPoint=function(n,t){return(t.X-n.X)*(t.X-n.X)+(t.Y-n.Y)*(t.Y-n.Y)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.getLineWidth=function(n,t,i,r,u){function f(n,t,i,r){var f=Math.pow(t-r,2),u=Math.pow(n-i,2);return Math.sqrt(f*u/(u+f))}if(n.X==t.X)return i*r;if(n.Y==t.Y)return i*u;var o=f(n.X,n.Y,t.X,t.Y),e=f(n.X*r,n.Y*u,t.X*r,t.Y*u);return i*e/o},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.ConvertDegreeToRadian=function(n){return Math.PI*n/180},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.ConvertRadianToDegree=function(n){return 180*n/Math.PI},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.Clamp=function(n,t,i){return Math.max(n,Math.min(i,t))},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.EqualsOfFloatNumbers=function(n,t,i){return typeof n!="number"||typeof t!="number"?!1:(typeof i!="number"&&(i=.0001),i!=0?Math.abs(n-t)<=i:n==t)},function(){Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math");var n=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math;n.Matrix=function(n,t,i,r,u,f){if(arguments.length==6)this.set_transform(n,t,i,r,u,f);else if(arguments.length==0)this.set_transform(1,0,0,1,0,0);else throw new Error("Arguments error");},n.Matrix.prototype={set_transform:function(n,t,i,r,u,f){this.m00=n,this.m10=t,this.m01=i,this.m11=r,this.m02=u,this.m12=f},transformPoint:function(t,i){var r=i?new n.PointF:t,f=t.X,u=t.Y;return r.X=f*this.m00+u*this.m01+this.m02,r.Y=f*this.m10+u*this.m11+this.m12,r},transformPoints:function(t,i){for(var s=i?[]:t,r=0,h=t.length;r<h;++r){var u=t[r],f=i?new n.PointF:u,o=u.X,e=u.Y;f.X=o*this.m00+e*this.m01+this.m02,f.Y=o*this.m10+e*this.m11+this.m12,s[r]=f}return s},concatenate:function(n){var i=this.m00,t=this.m01;return this.m00=n.m00*i+n.m10*t,this.m01=n.m01*i+n.m11*t,this.m02+=n.m02*i+n.m12*t,i=this.m10,t=this.m11,this.m10=n.m00*i+n.m10*t,this.m11=n.m01*i+n.m11*t,this.m12+=n.m02*i+n.m12*t,this},rotate:function(n){return this.rotateAt(n,0,0)},rotateAt:function(t,i,r){t=n.ConvertDegreeToRadian(t);var f=Math.cos(t),u=Math.sin(t),e=new n.Matrix(f,u,-u,f,i-i*f+r*u,r-i*u-r*f);return this.concatenate(e)},scale:function(n,t){return this.m00*=n,this.m10*=n,this.m01*=t,this.m11*=t,this},translate:function(n,t){return this.m02+=n*this.m00+t*this.m01,this.m12+=n*this.m10+t*this.m11,this},preTranslate:function(n,t){return this.m02+=n,this.m12+=t,this},toString:function(){return"matrix("+[this.m00,this.m10,this.m01,this.m11,this.m02,this.m12].join(", ")+")"}},n.Matrix.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.Matrix")}(),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.PathSegment=function(n,t){Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.PathSegment.initializeBase(this),this._name=n?n.toUpperCase():"",this._points=t?t:[]},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.PathSegment.prototype={get_name:function(){return this._name},get_point:function(n){return this._points[n]},get_length:function(){return this._points.length},_transform:function(n,t){for(var i=0;i<this.get_length();i++)this.get_point(i).transform(n,t)},_draw:function(n){switch(this.get_name()){case"Z":n.closePath();break;case"M":n.moveTo(this.get_point(0).X,this.get_point(0).Y);break;case"L":n.lineTo(this.get_point(0).X,this.get_point(0).Y);break;case"Q":n.quadraticCurveTo(this.get_point(0).X,this.get_point(0).Y,this.get_point(1).X,this.get_point(1).Y);break;case"C":n.bezierCurveTo(this.get_point(0).X,this.get_point(0).Y,this.get_point(1).X,this.get_point(1).Y,this.get_point(2).X,this.get_point(2).Y)}},_toString:function(){for(var t=this.get_name(),n=0;n<this.get_length();n++)t+=" "+this.get_point(n).X+" "+this.get_point(n).Y;return t}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.PathSegment.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.PathSegment"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.Path=function(n){Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.Path.initializeBase(this),this._segments=[],n&&this._fromString(n)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.Path.prototype={get_length:function(){return this._segments.length},add_pathChanged:function(n){this.get_events().addHandler("pathChanged",n)},remove_pathChanged:function(n){this.get_events().removeHandler("pathChanged",n)},_onChanged:function(){var n=this.get_events().getHandler("pathChanged");n&&n(this)},moveTo:function(n,t){var i=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math;this._segments.push(new i.PathSegment("M",[new i.PointF(n,t)])),this._onChanged()},lineTo:function(n,t){var i=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math;this._segments.push(new i.PathSegment("L",[new i.PointF(n,t)])),this._onChanged()},quadraticTo:function(n,t,i,r){var u=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math;this._segments.push(new u.PathSegment("Q",[new u.PointF(n,t),new u.PointF(i,r)])),this._onChanged()},cubicTo:function(n,t,i,r,u,f){var e=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math;this._segments.push(new e.PathSegment("C",[new e.PointF(n,t),new e.PointF(i,r),new e.PointF(u,f)])),this._onChanged()},close:function(){var n=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math;this._segments.push(new n.PathSegment("Z")),this._onChanged()},transform:function(n,t){for(var i=0;i<this.get_length();i++)this._segments[i]._transform(n,t)},draw:function(n){if(!n)return;n.beginPath();for(var t=0;t<this.get_length();t++)this._segments[t]._draw(n)},toString:function(){for(var t="",n=0;n<this.get_length();n++)t+=this._segments[n]._toString(),n<this._segments.length-1&&(t+=" ");return t},clone:function(){return new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.Path(this.toString())},isEqual:function(n){return this.toString()===n.toString()},_fromString:function(n){var s=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math,e=n.split(" "),f=0,u,t,o,h;while(f<e.length){var c=e[f],i=f+1,r=[];while(i<e.length){u=parseFloat(e[i]);if(!isNaN(u)&&isFinite(u))r.push(u),i++;else break}t=0,o=[];while(t<r.length)o.push(new s.PointF(r[t],r[t+1])),t+=2;h=new s.PathSegment(c,o),this._segments.push(h),f=i}}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.Path.rectangle=function(n,t,i,r){var u=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.Path;return u.moveTo(n,t),u.lineTo(n+i,t),u.lineTo(n+i,t+r),u.lineTo(n,t+r),u.lineTo(n,t),u.close(),u},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.Path.ellipse=function(n,t,i,r){var e=.5517,f=i/2,u=r/2,o=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.Path;return o.moveTo(n,t+u),o.cubicTo(n,t+u-u*e,n+f-f*e,t,n+f,t),o.cubicTo(n+f+f*e,t,n+i,t+u*e,n+i,t+u),o.cubicTo(n+i,t+u+u*e,n+f+f*e,t+r,n+f,t+r),o.cubicTo(n+f-f*e,t+r,n,t+u+u*e,n,t+u),o.close(),o},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.Path.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.Path",Sys.Component),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.PointF=function(n,t){this.X=n?n:0,this.Y=t?t:0},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.PointF.prototype={rotate:function(n){return this.rotateAt(n,{X:0,Y:0})},rotateAt:function(n,t){t||(t={X:0,Y:0});var i=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.ConvertDegreeToRadian(n),u=Math.cos(i)*(this.X-t.X)-Math.sin(i)*(this.Y-t.Y)+t.X,r=Math.sin(i)*(this.X-t.X)+Math.cos(i)*(this.Y-t.Y)+t.Y;return this.X=u,this.Y=r,this},translate:function(n,t){return this.X=this.X+n,this.Y=this.Y+t,this},scale:function(n,t){return this.X=this.X*n,this.Y=this.Y*t,this},clone:function(){return new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.PointF(this.X,this.Y)},isEqual:function(n,t){var i=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math;return n!=null&&i.EqualsOfFloatNumbers(this.X,n.X,t)&&i.EqualsOfFloatNumbers(this.Y,n.Y,t)},distance:function(n){return Math.sqrt((this.X-n.X)*(this.X-n.X)+(this.Y-n.Y)*(this.Y-n.Y))},transform:function(n,t){return t==null&&(t=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.PointF),this.translate(-t.X,-t.Y),this.scale(n.get_scaleX(),n.get_scaleY()),this.rotate(n.get_angle()),this.translate(n.get_translateX(),n.get_translateY()),this.translate(t.X,t.Y),this},toString:function(){var n=[this.X,this.Y];return n.join(",")},round:function(){return this.X=Math.round(this.X),this.Y=Math.round(this.Y),this},X:0,Y:0},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.PointF.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.PointF"),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RectangleF=function(n,t,i,r){Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RectangleF.initializeBase(this),this.Left=typeof n=="number"?n:0,this.Top=typeof t=="number"?t:0,this.Width=typeof i=="number"?i:2,this.Height=typeof r=="number"?r:2},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RectangleF.FromLTRB=function(n,t,i,r){var f=i-n,u=r-t;return new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RectangleF(n,t,f,u)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RectangleF.FromObject=function(n){return new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RectangleF(n.Left,n.Top,n.Width,n.Height)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RectangleF.intersect=function(n,t){var f=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RectangleF,r=Math.max(n.Left,t.Left),e=Math.min(n.Right,t.Right),i=Math.max(n.Top,t.Top),u=Math.min(n.Bottom,t.Bottom);return e>=r&&u>=i?new f(r,i,e-r,u-i):f.empty},Object.defineProperty(Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RectangleF,"empty",{get:function(){return new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RectangleF(0,0,-1,-1)},enumerable:!0,configurable:!0}),Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RectangleF.prototype={contains:function(n,t,i){if(t){typeof i!="number"&&(i=.0001);var r=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math,e=this.Left,o=this.Top,u=this.Left+this.Width,f=this.Top+this.Height;return(n.X>e||r.EqualsOfFloatNumbers(n.X,e,i))&&(n.Y>o||r.EqualsOfFloatNumbers(n.Y,o,i))&&(n.X<u||r.EqualsOfFloatNumbers(n.X,u,i))&&(n.Y<f||r.EqualsOfFloatNumbers(n.Y,f,i))}return n.X>this.Left&&n.Y>this.Top&&n.X<this.Left+this.Width&&n.Y<this.Top+this.Height},containsRectangle:function(n){var i=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.PointF(n.Left,n.Top),t=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.PointF(n.Right,n.Bottom);return this.contains(i,!0)&&this.contains(t,!0)},isEmpty:function(){return this.Width<=0||this.Height<=0},intersectsWith:function(n){return n.Left<this.Right&&this.Left<n.Right&&n.Top<this.Bottom&&this.Top<n.Bottom},Left:0,Top:0,Width:2,Height:2},Object.defineProperties(Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RectangleF.prototype,{Right:{get:function(){return this.Left+this.Width},enumerable:!0,configurable:!0},Bottom:{get:function(){return this.Top+this.Height},enumerable:!0,configurable:!0}}),Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RectangleF.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RectangleF"),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RotatedRectangleF=function(n,t,i,r,u){Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RotatedRectangleF.initializeBase(this),this.CenterX=n?n:0,this.CenterY=t?t:0,this.Width=i||i===0?i:2,this.Height=r||r===0?r:2,this.Angle=u?u:0},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RotatedRectangleF.prototype={clone:function(){return new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RotatedRectangleF(this.CenterX,this.CenterY,this.Width,this.Height,this.Angle)},get_bounds:function(){for(var i=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math,h=new i.PointF(this.CenterX,this.CenterY),u=this.Width,e=this.Height,t=[new i.PointF(-u/2,-e/2),new i.PointF(-u/2,e/2),new i.PointF(u/2,-e/2),new i.PointF(u/2,e/2)],f=0,r=0,s=0,o=0,n=0;n<4;n++)t[n].rotate(this.Angle),(t[n].X<f||n===0)&&(f=t[n].X),(t[n].Y<r||n===0)&&(r=t[n].Y),(t[n].X>s||n===0)&&(s=t[n].X),(t[n].Y>o||n===0)&&(o=t[n].Y);return new i.RectangleF(f+h.X,r+h.Y,s-f,o-r)},isEqual:function(n,t){var i=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math;return n!=null&&i.EqualsOfFloatNumbers(this.CenterX,n.CenterX,t)&&i.EqualsOfFloatNumbers(this.CenterY,n.CenterY,t)&&i.EqualsOfFloatNumbers(this.Width,n.Width,t)&&i.EqualsOfFloatNumbers(this.Height,n.Height,t)&&i.EqualsOfFloatNumbers(this.Angle,n.Angle,t)},_getUpperLeftCorner:function(){var n=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.PointF(-this.Width/2,-this.Height/2);return n=n.rotate(this.Angle),n=n.translate(this.CenterX,this.CenterY)},_getUpperRightCorner:function(){var n=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.PointF(this.Width/2,-this.Height/2);return n=n.rotate(this.Angle),n=n.translate(this.CenterX,this.CenterY)},_getBottomRightCorner:function(){var n=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.PointF(this.Width/2,this.Height/2);return n=n.rotate(this.Angle),n=n.translate(this.CenterX,this.CenterY)},_getBottomLeftCorner:function(){var n=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.PointF(-this.Width/2,this.Height/2);return n=n.rotate(this.Angle),n=n.translate(this.CenterX,this.CenterY)},_checkProjectionIntersection:function(n,t){var r=this._getProjections(n),i=this._getProjections(t);return r.left<=i.right&&r.right>=i.left&&r.top<=i.bottom&&r.bottom>=i.top},_getProjections:function(n){for(var i=x1=n[0].X,r=y1=n[0].Y,t=1;t<n.length;t++)i=Math.min(i,n[t].X),x1=Math.max(x1,n[t].X),r=Math.min(r,n[t].Y),y1=Math.max(y1,n[t].Y);return{left:i,right:x1,top:r,bottom:y1}},intersectsWith:function(n){var i=this.clone(),t=n.clone(),u,r;this.Angle!=0&&(u=i.Angle,i.Angle=0,r=t.get_center(),r.rotateAt(-u,i.get_center()),t.set_center(r),t.Angle-=u);var e=[i._getUpperLeftCorner(),i._getUpperRightCorner(),i._getBottomRightCorner(),i._getBottomLeftCorner()],f=[t._getUpperLeftCorner(),t._getUpperRightCorner(),t._getBottomRightCorner(),t._getBottomLeftCorner()],s=this._checkProjectionIntersection(e,f),o=!0;return s&&this.Angle!=n.Angle&&(i=this.clone(),t=n.clone(),u=t.Angle,t.Angle=0,r=i.get_center(),r.rotateAt(-u,t.get_center()),i.set_center(r),i.Angle-=u,e=[i._getUpperLeftCorner(),i._getUpperRightCorner(),i._getBottomRightCorner(),i._getBottomLeftCorner()],f=[t._getUpperLeftCorner(),t._getUpperRightCorner(),t._getBottomRightCorner(),t._getBottomLeftCorner()],o=this._checkProjectionIntersection(e,f)),s&&o},get_location:function(){return this._getUpperLeftCorner()},set_location:function(n){var t=this._getUpperLeftCorner();this.CenterX=this.CenterX+(n.X-t.X),this.CenterY=this.CenterY+(n.Y-t.Y)},get_center:function(){return new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.PointF(this.CenterX,this.CenterY)},set_center:function(n){this.CenterX=n.X,this.CenterY=n.Y},rotateAt:function(n,t){var i=this.get_center();i.rotateAt(n,t),this.set_center(i),this.Angle+=n},set_transform:function(n){if(n==null||n.isEqual(new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Transform))return;this.Width*=n.get_scaleX(),this.Height*=n.get_scaleY(),this.Angle+=n.get_angle(),this.CenterX+=n.get_translateX(),this.CenterY+=n.get_translateY()},get_transform:function(n){if(n==null||this.isEqual(n))return new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Transform;var u=n.Width===0?0:this.Width/n.Width,f=n.Height===0?0:this.Height/n.Height,e=this.Angle-n.Angle,t=n.get_center(),r=this.CenterX-t.X,i=this.CenterY-t.Y;return new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Transform(u,f,r,i,e)},toString:function(){var n=[this.CenterX,this.CenterY,this.Width,this.Height,this.Angle];return n.join(",")},toRectangleF:function(){return new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RectangleF(this.CenterX-this.Width/2,this.CenterY-this.Height/2,this.Width,this.Height)},CenterX:0,CenterY:0,Width:2,Height:2,Angle:0},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RotatedRectangleF.fromRectangleF=function(n){return new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RotatedRectangleF(n.Left+n.Width/2,n.Top+n.Height/2,n.Width,n.Height,0)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RotatedRectangleF.FromLTRB=function(n,t,i,r){return Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RotatedRectangleF.fromRectangleF(Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RectangleF.FromLTRB(n,t,i,r))},Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RotatedRectangleF.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RotatedRectangleF"),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.TextAlignment=function(){throw Error.notImplemented();},Aurigma.GraphicsMill.AjaxControls.VectorObjects.TextAlignment.prototype={Left:0,Center:1,Right:2},Aurigma.GraphicsMill.AjaxControls.VectorObjects.TextAlignment.registerEnum("Aurigma.GraphicsMill.AjaxControls.VectorObjects.TextAlignment",!1),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.TextVerticalAlignment=function(){throw Error.notImplemented();},Aurigma.GraphicsMill.AjaxControls.VectorObjects.TextVerticalAlignment.prototype={Top:0,Center:1,Bottom:2},Aurigma.GraphicsMill.AjaxControls.VectorObjects.TextVerticalAlignment.registerEnum("Aurigma.GraphicsMill.AjaxControls.VectorObjects.TextVerticalAlignment",!1),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.WrappingMode=function(){throw Error.notImplemented();},Aurigma.GraphicsMill.AjaxControls.VectorObjects.WrappingMode.prototype={None:0,Square:1,Tight:2},Aurigma.GraphicsMill.AjaxControls.VectorObjects.WrappingMode.registerEnum("Aurigma.GraphicsMill.AjaxControls.VectorObjects.WrappingMode",!1),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.VObjectAction=function(){throw Error.notImplemented();},Aurigma.GraphicsMill.AjaxControls.VectorObjects.VObjectAction.prototype={none:0,dragX:1,arbitraryResize:2,proportionalResize:4,rotate:8,dragY:16,all:31,resize:6,drag:17},Aurigma.GraphicsMill.AjaxControls.VectorObjects.VObjectAction.registerEnum("Aurigma.GraphicsMill.AjaxControls.VectorObjects.VObjectAction",!0),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.VObjectCollection=function(n){if(!n)throw Error.argumentNull("layer");Aurigma.GraphicsMill.AjaxControls.VectorObjects.VObjectCollection.initializeBase(this),this._layer=n},Aurigma.GraphicsMill.AjaxControls.VectorObjects.VObjectCollection.prototype={getVObjectById:function(n){for(var i,t=0;t<this.get_count();t++){i=this.get_item(t);if(i.get_uniqueId()==n)return i}return null},getVObjectsByName:function(n){for(var i=[],t=0;t<this.get_count();t++)this.get_item(t).get_name()==n&&i.push(this.get_item(t));return i},_onVObjectRemoved:function(n,t,i){var r=this._layer.get_canvas(),u;r&&(u=r.get_history(),u.get_trackingEnabled()&&u.addVObjectRemoved(n,t,i),r.isVObjectSelected(n)&&r.removeSelectedVObject(n),r._needCompleteRedraw=!0),n._layer=null,r&&n._onRemovedFromCanvas(r)},_onVObjectAdded:function(n,t,i){var r,u;n._layer=this._layer,r=this._layer.get_canvas(),r&&(u=r.get_history(),u.get_trackingEnabled()&&u.addVObjectAdded(n,t,i),this._layer._canvas&&n._onAddedOnCanvas(this._layer._canvas),r._needCompleteRedraw=!0)},_onVObjectMoved:function(n,t,i){var u=this._layer.get_canvas(),f,r;u&&(f=this._layer.get_index(),r=u.get_history(),r.get_trackingEnabled()&&r.addVObjectMoved(n,t,i,f),u._needCompleteRedraw=!0)},insert:function(n,t){if(t._layer)throw Error.argument("item",Aurigma.GraphicsMill.AjaxControls.VectorObjects.Exceptions.itemBelongsCollection);Aurigma.GraphicsMill.AjaxControls.VectorObjects.VObjectCollection.callBaseMethod(this,"insert",[n,t]),this._onVObjectAdded(t,n,this._layer.get_index())},removeAt:function(n){var i=this._layer.get_index(),t=this.get_item(n);t&&(Aurigma.GraphicsMill.AjaxControls.VectorObjects.VObjectCollection.callBaseMethod(this,"removeAt",[n]),this._onVObjectRemoved(t,n,i))},move:function(n,t){var i=Aurigma.GraphicsMill.AjaxControls.VectorObjects.VObjectCollection.callBaseMethod(this,"move",[n,t]);return i&&this._onVObjectMoved(i,n,t),i},clear:function(){for(var t=this.get_count(),n=0;n<t;n++)this.get_item(n)._layer=null;Aurigma.GraphicsMill.AjaxControls.VectorObjects.VObjectCollection.callBaseMethod(this,"clear")}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.VObjectCollection.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.VObjectCollection",Aurigma.GraphicsMill.AjaxControls.VectorObjects.Collection),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.VObject=function(){Aurigma.GraphicsMill.AjaxControls.VectorObjects.VObject.initializeBase(this),this.ns=Aurigma.GraphicsMill.AjaxControls.VectorObjects,this._visible=!0,this._locked=!1,this._name="",this._controlPoints=[],this._transformChangedDelegate=null,this._layer=null,this._tag=null,this._permissions=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Permission({NoPrint:!1,NoShow:!1},!0),this._uniqueId=this._createUniqueID(),this._initTransform(),this._callbacks=[],this._activeCanvasIndex=-1,this._isCallingService=!1},Aurigma.GraphicsMill.AjaxControls.VectorObjects.VObject.prototype={_createUniqueID:function(){return"vo"+ +new Date+Math.round(Math.random()*1e3)},clone:function(){var n=new this.constructor,t=n.get_uniqueId();return n.set_data(this.get_data()),n.set_uniqueId(t),n},get_ready:function(){return!0},isLoadingImage:function(){return!1},get_uniqueId:function(){return this._uniqueId},set_uniqueId:function(n){this._uniqueId=n},get_controlPoints:function(){return this._controlPoints},set_controlPoints:function(n){this._controlPoints=n,this.raiseChanged()},get_permissions:function(){return this._permissions},set_permissions:function(n){this._permissions=n,this.raiseChanged()},get_transform:function(){return this._transform},set_transform:function(n,t){this._transform.isEqual(n)||(this._transform.remove_transformChanged(this._transformChangedDelegate),this._transform=n,this._transform.add_transformChanged(this._transformChangedDelegate),t||this._transformChanged())},_transformChanged:function(){this.raiseChanged()},get_tag:function(){return this._tag},set_tag:function(n){this._tag=n,this.raiseChanged()},get_supportedActions:function(){return this._permissions.toActions()},set_supportedActions:function(n){this._permissions.fromActions(n),this.raiseChanged()},get_canvas:function(){return this._layer?this._layer.get_canvas():null},get_layer:function(){return this._layer},get_index:function(){return this._layer?this._layer.get_vObjects().indexOf(this):-1},get_bounds:function(){return new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RectangleF(0,0,0,0)},get_name:function(){return this._name},set_name:function(n){this._name=n,this.raiseChanged()},_get_type:function(){var n=Object.getType(this).getName().split(".");return n=n[n.length-1]},_get_dataType:function(){return"VObjectData"},get_data:function(){var n=new Aurigma.GraphicsMill.AjaxControls.VectorObjects[this._get_dataType()](this);return JSON.stringify(n)},set_data:function(n){if(n&&n!=""){var t;t=typeof n=="string"?JSON.parse(n):n,Aurigma.GraphicsMill.AjaxControls.VectorObjects[this._get_dataType()].applyState(t,this)}},_setNeedRedrawCanvasFlag:function(n){var t=this.get_canvas();t&&(n?t._needCompleteRedraw=!0:t._needRedraw=!0)},get_visible:function(){return this._visible},set_visible:function(n){this._visible!==n&&(this._visible=n,this.raiseChanged())},isVisible:function(){return this.get_visible()&&!this.get_permissions().get_noShow()&&this.get_layer()!=null&&this.get_layer().get_visible()},get_locked:function(){return this._locked},set_locked:function(n){this._locked!==n&&(this._locked=n,this.raiseChanged())},isLocked:function(){return this.get_locked()||this.get_layer()!=null&&this.get_layer().get_locked()},_onAddedOnCanvas:function(){},_onRemovedFromCanvas:function(){},processEvent:function(){},hitTest:function(){},draw:function(){},_updateColors:function(){},_updateColor:function(n,t){var u=Function.createDelegate(this,function(n){if(typeof t=="function"){var i=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Color._from_data(JSON.parse(n));t(i)}}),r=function(n){window.console&&(console.log("Fail updateColorByService"),console.log(n))},i=JSON.stringify(n._get_data());this._callService("UpdateByColorData",i,u,r)},quickUpdate:function(){},update:function(){},_validateBeforeCallService:function(){return!0},_update:function(n,t,i){var f=Function.createDelegate(this,function(n){this.set_data(n),this.quickUpdate(),typeof i=="function"&&(i(),this.raiseChanged())}),e=function(n){window.console&&(console.log("Fail updateByService"),console.log(n))},u,r;if(this.get_isUpdating()){this._callbacks.push(t);return}typeof t=="function"&&t(),u=new this.ns[this._get_dataType()](this),u.__type=this._get_dataType(),r=[JSON.stringify(u)],n!=null&&(r=r.concat(n)),this._validateBeforeCallService()?this._callService("UpdateBy"+this._get_dataType(),r,f,e):this.raiseChanged()},_callService:function(n,t,i,r){var f=Function.createDelegate(this,function(n){this._isCallingService=!1,typeof i=="function"&&i(n)}),e=function(n){this._isCallingService=!1;var f=new XMLHttpRequest;n._statusCode==500&&n._errorObject==undefined?(f.onreadystatechange=function(){f.readyState==4&&(f.status==200?u():window.console&&console.log("Fail retrieve XML data"))},f.open("GET",document.location.href,!1),f.setRequestHeader("If-Modified-Since","0"),f.send()):typeof r=="function"&&r(n)},u=Function.createDelegate(this,function(){var u=this.get_canvas(),i,r;u!=null&&u.get_isInitialized()&&(i=[u.get_data(!0)],t!=null&&(i=i.concat(t)),i=i.concat(f,e),this._isCallingService=!0,r=this.ns.Service,r[n].apply(r,i))});u()},endUpdate:function(){var t,n;Aurigma.GraphicsMill.AjaxControls.VectorObjects.VObject.callBaseMethod(this,"endUpdate"),t=!1;while(this._callbacks.length>0)n=this._callbacks.shift(),typeof n=="function"&&(n(),t=!0);t&&this.update()},updated:function(){this.raiseChanged()},raiseChanging:function(n){var t=this.get_events().getHandler("changing");t&&t(this,n)},raiseChanged:function(n){var i,t;this.get_isUpdating()||(i=this.get_events().getHandler("changed"),i&&i(this,n),t=this.get_canvas(),t&&t._invokeServer(this,"changed"))},add_ready:function(n){this.get_events().addHandler("ready",n)},remove_ready:function(n){this.get_events().removeHandler("ready",n)},_dispatchReadyEvent:function(){var n=this.get_events().getHandler("ready");n&&n(this,Sys.EventArgs.Empty)},add_changing:function(n){this.get_events().addHandler("changing",n)},remove_changing:function(n){this.get_events().removeHandler("changing",n)},add_changed:function(n){this.get_events().addHandler("changed",n)},remove_changed:function(n){this.get_events().removeHandler("changed",n)},add_beforeCreate:function(n){this.get_events().addHandler("beforeCreate",n)},remove_beforeCreate:function(n){this.get_events().removeHandler("beforeCreate",n)},initialize:function(){},_initTransform:function(){this._transform=$create(Aurigma.GraphicsMill.AjaxControls.VectorObjects.Transform),this._transformChangedDelegate||(this._transformChangedDelegate=Function.createDelegate(this,this._transformChanged)),this._transform.add_transformChanged(this._transformChangedDelegate)},dispose:function(){this._transformChangedDelegate&&(this._transform.remove_transformChanged(this._transformChangedDelegate),delete this._transformChangedDelegate)}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.VObject.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.VObject",Sys.Component),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.VObjectData=function(n){Aurigma.GraphicsMill.AjaxControls.VectorObjects.VObjectData.initializeBase(this);if(n){this.N=n.get_name(),this.V=n.get_visible(),this.L=n.get_locked(),this.P=n.get_controlPoints(),this.Tg=n.get_tag(),this.ID=n.get_uniqueId();var t=n.get_transform();this.T={ScaleX:t.get_scaleX(),ScaleY:t.get_scaleY(),TranslateX:t.get_translateX(),TranslateY:t.get_translateY(),Angle:t.get_angle()},this.Prm=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.PermissionData(n.get_permissions())}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.VObjectData.applyState=function(n,t){if(t){t.beginUpdate(),t.set_name(n.N),t.set_visible(n.V),t.set_locked(n.L),t.set_controlPoints(n.P);var i=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Transform(n.T.ScaleX,n.T.ScaleY,n.T.TranslateX,n.T.TranslateY,n.T.Angle);t.set_transform(i,!0),t.set_tag(n.Tg),t.set_uniqueId(n.ID),t.set_permissions(new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Permission(n.Prm)),t.endUpdate()}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.VObjectData.prototype={N:"",V:!0,L:!0,P:[],Tg:null,ID:"vo"+ +new Date+Math.round(Math.random()*1e3),Prm:{}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.VObjectData.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.VObjectData",null),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseRectangleVObject=function(n,t,i,r){Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseRectangleVObject.initializeBase(this);var e=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math,f=n?n:0,u=t?t:0,s=i?i:0,o=r?r:0;this._controlPoints=[new e.PointF(f,u),new e.PointF(f+s,u+o)],this._textWrappingMode=Aurigma.GraphicsMill.AjaxControls.VectorObjects.WrappingMode.None,this._opacity=1,this._allowNegativeResize=!0},Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseRectangleVObject.prototype={_get_boundsMargin:function(){return 0},_get_controlBounds:function(){var f=Math.max(this._controlPoints[0].X,this._controlPoints[1].X),u=Math.max(this._controlPoints[0].Y,this._controlPoints[1].Y),t=Math.min(this._controlPoints[0].X,this._controlPoints[1].X),n=Math.min(this._controlPoints[0].Y,this._controlPoints[1].Y),r=f-t,i=u-n;return new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RectangleF(t,n,r,i)},_get_controlCenter:function(){var n=this._get_controlBounds(),i=n.Left+n.Width/2,t=n.Top+n.Height/2;return new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.PointF(i,t)},get_rectangle:function(){var n=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RotatedRectangleF.fromRectangleF(this._get_controlBounds());return n.set_transform(this.get_transform()),n},set_rectangle:function(n,t){var r=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RotatedRectangleF.fromRectangleF(this._get_controlBounds()),i=n.get_transform(r);this.set_transform(i,t)},get_bounds:function(){var n=this.get_rectangle(),t=this._get_boundsMargin();return n.Width+=n.Width>0?t:-t,n.Height+=n.Height>0?t:-t,n.get_bounds()},get_angle:function(){return this._transform.get_angle()},set_angle:function(n){this._transform.set_angle(n),this._setNeedRedrawCanvasFlag()},get_height:function(){return this.get_rectangle().Height},set_height:function(n){var t=this.get_rectangle();t.Height=n,this.set_rectangle(t)},get_width:function(){return this.get_rectangle().Width},set_width:function(n){var t=this.get_rectangle();t.Width=n,this.set_rectangle(t)},get_location:function(){return this.get_rectangle().get_location()},set_location:function(n){var t=this.get_rectangle();t.set_location(n),this.set_rectangle(t)},get_opacity:function(){return this._opacity},set_opacity:function(n){n=Math.max(0,Math.min(1,n)),Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.EqualsOfFloatNumbers(n,this._opacity)||(this._opacity=n,this._setNeedRedrawCanvasFlag(!1))},get_textWrappingMode:function(){return this._textWrappingMode},set_textWrappingMode:function(n){this._textWrappingMode!==n&&(this._textWrappingMode=n)},hitTest:function(n){return this.get_canvas().hitTestSelection(this.get_selectionRectangle(),n)},_onResized:function(){},_transformRectangle:function(n,t){var s,o;if(n==null||t==null||this._startRectangle==null)return;if(this._startRectangle.isEqual(n)){this.set_rectangle(t,!0);return}var r=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math,i=this._startRectangle.clone(),u=t.get_transform(n),h=u.get_angle(),f=u.get_scaleX(),e=u.get_scaleY();r.EqualsOfFloatNumbers(t.Angle,0)||i.rotateAt(-t.Angle,n.get_center()),r.EqualsOfFloatNumbers(f,1)&&r.EqualsOfFloatNumbers(e,1)?(i.CenterX+=u.get_translateX(),i.CenterY+=u.get_translateY()):(s=r.EqualsOfFloatNumbers(Math.sin(r.ConvertDegreeToRadian(i.Angle),1)),i.Width=i.Width*(s?e:f),i.Height=i.Height*(s?f:e),i.CenterX=t.CenterX+(i.CenterX-n.CenterX)*f,i.CenterY=t.CenterY+(i.CenterY-n.CenterY)*e),r.EqualsOfFloatNumbers(t.Angle,0)||i.rotateAt(t.Angle,t.get_center()),r.EqualsOfFloatNumbers(h,0)||(o=i.get_center(),o.rotateAt(h,n.get_center()),i.Angle=i.Angle+h,i.set_center(o)),this.set_rectangle(i,!0)},_startTransform:function(){this._startRectangle=this.get_rectangle()},_endTransform:function(n){if(n&&this.get_canvas().get_history().get_trackingEnabled()&&this._startRectangle!=null){var t=this.get_rectangle();this.set_rectangle(this._startRectangle,!0),this.get_canvas().get_history().addVObjectChanged(this,this.get_index(),this.get_layer().get_index()),this.set_rectangle(t)}delete this._startRectangle},_dispatchDoubleClickEvent:function(n){var t=this.get_events().getHandler("dblclick");t&&t(this,n)},add_doubleClick:function(n){this.get_events().addHandler("dblclick",n)},remove_doubleClick:function(n){this.get_events().removeHandler("dblclick",n)},get_selectionRectangle:function(){var n=this.get_rectangle(),t=parseInt(this._get_boundsMargin());return n.Width+=n.Width>0?t:-t,n.Height+=n.Height>0?t:-t,n}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseRectangleVObject.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseRectangleVObject",Aurigma.GraphicsMill.AjaxControls.VectorObjects.VObject),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseRectangleVObjectData=function(n){Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseRectangleVObjectData.initializeBase(this,[n]),n&&(this.TWM=n.get_textWrappingMode(),this.O=n.get_opacity())},Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseRectangleVObjectData.applyState=function(n,t){t&&(t.beginUpdate(),t.set_textWrappingMode(n.TWM),t.set_opacity(n.O)),Aurigma.GraphicsMill.AjaxControls.VectorObjects.VObjectData.applyState(n,t)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseRectangleVObjectData.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseRectangleVObjectData",Aurigma.GraphicsMill.AjaxControls.VectorObjects.VObjectData),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.ShapeVObject=function(n){var t=Aurigma.GraphicsMill.AjaxControls.VectorObjects;t.ShapeVObject.initializeBase(this),this._path=n!=null?n:new t.Math.Path(""),this._transformedPath=null,this._pathChangedDelegate=Function.createDelegate(this,this._pathChanged),this._borderColor=new t.RgbColor("rgba(0,0,0,1)"),this._borderWidth=1,this._fillColor=new t.RgbColor("rgba(112,112,112,1)"),this._fixedBorderWidth=!1,this._allowNegativeResize=!1,this._isHuge=!1,this._hugePathMinLength=1e4},Aurigma.GraphicsMill.AjaxControls.VectorObjects.ShapeVObject.prototype={update:function(n,t){if(typeof n!="function")return;this.isVisible()?Aurigma.GraphicsMill.AjaxControls.VectorObjects.ShapeVObject.callBaseMethod(this,"_update",[null,n,t]):n()},set_visible:function(n){Aurigma.GraphicsMill.AjaxControls.VectorObjects.ShapeVObject.callBaseMethod(this,"set_visible",[n]),this.isVisible()?this.update():this._setNeedRedrawCanvasFlag()},get_path:function(){return this._transformedPath&&this._transformedPath.remove_pathChanged(this._pathChangedDelegate),this._transformedPath=this._get_transformedPath(),this._transformedPath.add_pathChanged(this._pathChangedDelegate),this._transformedPath},set_path:function(n){if(!this._get_transformedPath().isEqual(n)){var t=Function.createDelegate(this,function(){this._path=n,this._isHuge=this._path.get_length()>this._hugePathMinLength,this.set_transform(new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Transform)});this.update(t)}},get_borderWidth:function(){return this._borderWidth},set_borderWidth:function(n){if(this._borderWidth!==n){this._borderWidth=n;var t=this.get_canvas();t!=null&&t.updateSelection(),this._setNeedRedrawCanvasFlag()}},get_borderColor:function(){return this._borderColor},set_borderColor:function(n){var t=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Color.createColor(n);this._borderColor.equals(t)||(this._borderColor=t,this._setNeedRedrawCanvasFlag())},get_fillColor:function(){return this._fillColor},set_fillColor:function(n){var t=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Color.createColor(n);this._fillColor.equals(t)||(this._fillColor=t,this._setNeedRedrawCanvasFlag())},get_fixedBorderWidth:function(){return this._fixedBorderWidth},set_fixedBorderWidth:function(n){this._fixedBorderWidth!==n&&(this._fixedBorderWidth=n,this._setNeedRedrawCanvasFlag())},get_originalPath:function(){return this._path},set_originalPath:function(n){this._path=n,this._isHuge=this._path.get_length()>this._hugePathMinLength},_get_boundsMargin:function(){return this._borderWidth},_get_transformedPath:function(){var t=this._get_controlCenter(),n=this._path.clone();return n.transform(this.get_transform(),t),n},_pathChanged:function(){this.set_path(this._transformedPath.clone())},_get_dataType:function(){return"ShapeVObjectData"},draw:function(n){if(!n)return;var t=this.get_borderWidth();this.get_fixedBorderWidth()&&(t/=this.get_canvas().get_zoom()),Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.path(n,this._path,this._get_controlCenter(),this.get_transform(),this.get_fillColor().Preview,t,this.get_borderColor().Preview,this.get_opacity())},_updateColors:function(){Aurigma.GraphicsMill.AjaxControls.VectorObjects.ShapeVObject.callBaseMethod(this,"_updateColors");var n=this,i=Function.createDelegate(this,function(t){n.set_fillColor(t)}),t=Function.createDelegate(this,function(t){n.set_borderColor(t)});this._updateColor(this.get_fillColor(),i),this._updateColor(this.get_borderColor(),t)},_onAddedOnCanvas:function(n,t){Aurigma.GraphicsMill.AjaxControls.VectorObjects.ShapeVObject.callBaseMethod(this,"_onAddedOnCanvas",[n]),t!==!0&&this.update()}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.ShapeVObject.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.ShapeVObject",Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseRectangleVObject),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.ShapeVObjectData=function(n){Aurigma.GraphicsMill.AjaxControls.VectorObjects.ShapeVObjectData.initializeBase(this,[n]),n&&(this.Pth=n.get_originalPath().toString(),this.BW=n.get_borderWidth(),this.BC=n.get_borderColor()._get_data(),this.FC=n.get_fillColor()._get_data(),this.FBW=n.get_fixedBorderWidth())},Aurigma.GraphicsMill.AjaxControls.VectorObjects.ShapeVObjectData.applyState=function(n,t){t&&(t.beginUpdate(),t.set_originalPath(new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.Path(n.Pth)),t.set_borderWidth(n.BW),t.set_borderColor(Aurigma.GraphicsMill.AjaxControls.VectorObjects.Color._from_data(n.BC)),t.set_fillColor(Aurigma.GraphicsMill.AjaxControls.VectorObjects.Color._from_data(n.FC)),t.set_fixedBorderWidth(n.FBW)),Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseRectangleVObjectData.applyState(n,t)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.ShapeVObjectData.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.ShapeVObjectData",Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseRectangleVObjectData),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.RectangleVObject=function(n,t,i,r){var u=Aurigma.GraphicsMill.AjaxControls.VectorObjects;n!=null&&t!=null&&i!=null&&r!=null?(u.RectangleVObject.initializeBase(this,[u.Math.Path.rectangle(n,t,i,r)]),this._controlPoints=[new u.Math.PointF(n,t),new u.Math.PointF(n+i,t+r)]):u.RectangleVObject.initializeBase(this),this._allowNegativeResize=!0},Aurigma.GraphicsMill.AjaxControls.VectorObjects.RectangleVObject.prototype={get_rectangle:function(){var n=Aurigma.GraphicsMill.AjaxControls.VectorObjects.RectangleVObject.callBaseMethod(this,"get_rectangle");return n.Width<0&&(n.Width=-n.Width),n.Height<0&&(n.Height=-n.Height),n}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.RectangleVObject.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.RectangleVObject",Aurigma.GraphicsMill.AjaxControls.VectorObjects.ShapeVObject),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.EllipseVObject=function(n,t,i,r){var u=Aurigma.GraphicsMill.AjaxControls.VectorObjects;n!=null&&t!=null&&i!=null&&r!=null?(u.EllipseVObject.initializeBase(this,[u.Math.Path.ellipse(n,t,i,r)]),this._controlPoints=[new u.Math.PointF(n,t),new u.Math.PointF(n+i,t+r)]):u.EllipseVObject.initializeBase(this),this._allowNegativeResize=!0},Aurigma.GraphicsMill.AjaxControls.VectorObjects.EllipseVObject.prototype={hitTest:function(n,t){var e=Aurigma.GraphicsMill.AjaxControls.VectorObjects.EllipseVObject.callBaseMethod(this,"hitTest",[n.clone()]),r=this.get_rectangle(),i=n.clone(),f,u;return i.translate(-r.CenterX,-r.CenterY),i.rotate(-r.Angle),i.scale(2/r.Width,2/r.Height),f=i.X*i.X+i.Y*i.Y<1,u=t?r.toRectangleF().contains(n):!1,e.body=f||u,e}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.EllipseVObject.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.EllipseVObject",Aurigma.GraphicsMill.AjaxControls.VectorObjects.ShapeVObject),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.LineVObject=function(n,t,i,r){Aurigma.GraphicsMill.AjaxControls.VectorObjects.LineVObject.initializeBase(this,[]),this._width=4,this._color=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.RgbColor("rgba(0,0,0,1)"),this._fixedWidth=!1;var u=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math;this._controlPoints=[new u.PointF(n?n:0,t?t:0),new u.PointF(i?i:0,r?r:0)],this.set_textWrappingMode(Aurigma.GraphicsMill.AjaxControls.VectorObjects.WrappingMode.None)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.LineVObject.prototype={get_width:function(){return this._width},set_width:function(n){this._width=n,this._setNeedRedrawCanvasFlag()},get_color:function(){return this._color},set_color:function(n){var t=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Color.createColor(n);this._color.equals(t)||(this._color=t,this._setNeedRedrawCanvasFlag())},get_fixedWidth:function(){return this._fixedWidth},set_fixedWidth:function(n){this._fixedWidth=n,this._setNeedRedrawCanvasFlag()},get_point0:function(){return this._getActualPoint(this._controlPoints[0])},set_point0:function(n){var r=Aurigma.GraphicsMill.AjaxControls.VectorObjects,t=this._get_controlBounds(),i;t.Width===0||t.Height===0?(i=this._getActualPoint(this._controlPoints[1]),this._controlPoints=[n.clone(),i],this.set_transform(new r.Transform)):this._setTransformByPoints(this._controlPoints[0],n,this._controlPoints[1])},get_point1:function(){return this._getActualPoint(this._controlPoints[1])},set_point1:function(n){var r=Aurigma.GraphicsMill.AjaxControls.VectorObjects,t=this._get_controlBounds(),i;t.Width===0||t.Height===0?(i=this._getActualPoint(this._controlPoints[0]),this._controlPoints=[i,n.clone()],this.set_transform(new r.Transform)):this._setTransformByPoints(this._controlPoints[1],n,this._controlPoints[0])},_getActualPoint:function(n){var u=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math,i=new u.PointF(n.X,n.Y),r=this._get_controlCenter(),t;return i.translate(-r.X,-r.Y),t=this.get_transform(),i.scale(t.get_scaleX(),t.get_scaleY()),i.rotate(t.get_angle()),i.translate(t.get_translateX(),t.get_translateY()),i.translate(r.X,r.Y),i},get_bounds:function(){var i=this.get_point0(),r=this.get_point1(),o=Math.min(i.X,r.X),t=Math.max(i.X,r.X)-o,s=Math.min(i.Y,r.Y),n=Math.max(i.Y,r.Y)-s,e=Math.sqrt(t*t+n*n),f=this.get_width()*n/e,u=this.get_width()*t/e;return new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RectangleF(o-f/2,s-u/2,t+f,n+u)},_get_boundsMargin:function(){return this._width},_setTransformByPoints:function(n,t,i){var f=Aurigma.GraphicsMill.AjaxControls.VectorObjects,e=this._get_controlCenter(),h=this._getActualPoint(i),c=new f.Math.PointF((h.X+t.X)/2,(h.Y+t.Y)/2),l=c.X-e.X,a=c.Y-e.Y,u=new f.Math.PointF(n.X,n.Y).translate(-e.X,-e.Y),r=new f.Math.PointF(t.X,t.Y).translate(-l,-a).translate(-e.X,-e.Y),o=(u.X*r.X+u.Y*r.Y)/Math.sqrt((u.X*u.X+u.Y*u.Y)*(r.X*r.X+r.Y*r.Y)),s;o=f.Math.Clamp(-1,o,1),s=f.Math.ConvertRadianToDegree(Math.acos(o)),r=r.rotate(-s),this.set_transform(new f.Transform(r.X/u.X,r.Y/u.Y,l,a,s))},_get_dataType:function(){return"LineVObjectData"},draw:function(n){var r,i,t;if(!n)return;r=this.get_point0(),i=this.get_point1(),this.get_width()>0&&(t=this.get_width(),this.get_fixedWidth()&&(t/=this.get_canvas().get_zoom()),Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.drawLine(n,r.X,r.Y,i.X,i.Y,t,this.get_color().Preview,this.get_opacity()))},_belongToPiece:function(n,t,i,r,u){var e=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.getSquareDistanceToSegment(i,n,t),f=r/2+u;return e<=f*f?!0:!1},hitTest:function(n,t){var r=Aurigma.GraphicsMill.AjaxControls.VectorObjects.LineVObject.callBaseMethod(this,"hitTest",[n.clone()]),o=n.clone(),i=this.get_canvas(),s=i.get_zoom()*i.get_screenXDpi()/72,e=this.get_rectangle(),u=t?e.toRectangleF().contains(n):!1,f=this._belongToPiece(this.get_point0(),this.get_point1(),o,this.get_width(),2/s);return r.body=u||f?!0:!1,r},_updateColors:function(){Aurigma.GraphicsMill.AjaxControls.VectorObjects.LineVObject.callBaseMethod(this,"_updateColors");var t=this,n=Function.createDelegate(this,function(n){t.set_color(n)});this._updateColor(this.get_color(),n)}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.LineVObject.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.LineVObject",Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseRectangleVObject),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.LineVObjectData=function(n){Aurigma.GraphicsMill.AjaxControls.VectorObjects.LineVObjectData.initializeBase(this,[n]),n&&(this.W=n.get_width(),this.C=n.get_color()._get_data(),this.FW=n.get_fixedWidth())},Aurigma.GraphicsMill.AjaxControls.VectorObjects.LineVObjectData.applyState=function(n,t){t&&(t.beginUpdate(),t.set_width(n.W),t.set_color(Aurigma.GraphicsMill.AjaxControls.VectorObjects.Color._from_data(n.C)),t.set_fixedWidth(n.FW)),Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseRectangleVObjectData.applyState(n,t)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.LineVObjectData.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.LineVObjectData",Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseRectangleVObjectData),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.PolylineVObject=function(n){Aurigma.GraphicsMill.AjaxControls.VectorObjects.PolylineVObject.initializeBase(this,[]),this._width=20,this._color=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.RgbColor("rgba(255,255,61,1)"),this._controlPoints=[];if(n&&n.length&&n.length>0)for(var t=0;t<n.length;t++)Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.PointF.isInstanceOfType(n[t])&&this._controlPoints.push(n[t]);this.set_textWrappingMode(Aurigma.GraphicsMill.AjaxControls.VectorObjects.WrappingMode.None)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.PolylineVObject.prototype={_get_boundsMargin:function(){return this._width},get_width:function(){return this._width},set_width:function(n){this._width=n,this._setNeedRedrawCanvasFlag()},get_color:function(){return this._color},set_color:function(n){var t=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Color.createColor(n);this._color.equals(t)||(this._color=t,this._setNeedRedrawCanvasFlag())},_get_dataType:function(){return"PolylineVObjectData"},_addPoint:function(n){var r=this.get_canvas(),i=-1,f,t,u;r&&(i=r.get_screenXDpi()/72*r.get_zoom()),f=30,t=this.get_controlPoints(),t.length>0?(u=t[t.length-1].distance(n),(i===-1||u*i>f)&&t.push(n)):t.push(n)},addPoint:function(n){this.insertPoint(n,this._controlPoints.length)},insertPoint:function(n,t){if(t<0||t>this._controlPoints.length)throw Error.argumentOutOfRange("index",t,ns.Exceptions.insertPointOutOfRange);var i=this.getPoints();Array.insert(i,t,n),this._controlPoints=i,this.set_transform(new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Transform)},setPoint:function(n,t){var r=Aurigma.GraphicsMill.AjaxControls.VectorObjects,i;if(t<0||t>=this._controlPoints.length)throw Error.argumentOutOfRange("index",t,r.Exceptions.setPointOutOfRange);i=this.getPoints(),i[t]=n,this._controlPoints=i,this.set_transform(new r.Transform),this.raiseChanged()},getPoints:function(){for(var t=[],i=this._get_controlCenter(),n=0;n<this._controlPoints.length;n++)t.push(this._getActualPointFromControlPoint(this._controlPoints[n],i));return t},getPointsCount:function(){return this._controlPoints.length},getPoint:function(n){if(n<0||n>=this._controlPoints.length)throw Error.argumentOutOfRange("index",n,ns.Exceptions.setPointOutOfRange);return this._getActualPointFromControlPoint(this._controlPoints[n],this._get_controlCenter())},removePoint:function(n){if(n<0||n>=this._controlPoints.length)throw Error.argumentOutOfRange("index",n,ns.Exceptions.removePointOutOfRange);Array.removeAt(this._controlPoints,n)},_getActualPointFromControlPoint:function(n,t){var r=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.PointF(n.X,n.Y),i;return r.translate(-t.X,-t.Y),i=this.get_transform(),r.scale(i.get_scaleX(),i.get_scaleY()),r.rotate(i.get_angle()),r.translate(i.get_translateX(),i.get_translateY()),r.translate(t.X,t.Y),r},get_actualPoints:function(){for(var t=[],i=this._controlPoints.length,r=this._get_controlCenter(),n=0;n<i;n++)t.push(this._getActualPointFromControlPoint(this._controlPoints[n],r));return delete this._center,t},_get_controlBounds:function(){var i=0,r=0,f=0,u=0,n=this.get_controlPoints(),s=n.length,t,o,e;for(s>0&&(i=n[0].X,f=n[0].X,r=n[0].Y,u=n[0].Y),t=1;t<s;t++)i=Math.min(n[t].X,i),f=Math.max(n[t].X,f),r=Math.min(n[t].Y,r),u=Math.max(n[t].Y,u);return o=f-i,e=u-r,new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RectangleF(i,r,o,e)},draw:function(n){if(!n)return;if(this.get_width()>0){var t=this.get_actualPoints();Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.drawPolyline(n,t,this.get_width(),this.get_color().Preview,this.get_opacity())}},_belongToLine:function(n,t){for(var r=this.get_actualPoints(),f=!1,e=this._width/2+t,o=e*e,u,i=1;i<r.length;i++){u=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.getSquareDistanceToSegment(n,r[i-1],r[i]);if(u<=o){f=!0;break}}return f},hitTest:function(n,t){var r=Aurigma.GraphicsMill.AjaxControls.VectorObjects.PolylineVObject.callBaseMethod(this,"hitTest",[n.clone()]),i=this.get_canvas(),e=i.get_zoom()*i.get_screenXDpi()/72,o=this.get_rectangle(),u=t?o.toRectangleF().contains(n):!1,f=this._belongToLine(n,2/e);return r.body=u||f,r},_updateColors:function(){Aurigma.GraphicsMill.AjaxControls.VectorObjects.PolylineVObject.callBaseMethod(this,"_updateColors");var t=this,n=Function.createDelegate(this,function(n){t.set_color(n)});this._updateColor(this.get_color(),n)}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.PolylineVObject.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.PolylineVObject",Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseRectangleVObject),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.PolylineVObjectData=function(n){Aurigma.GraphicsMill.AjaxControls.VectorObjects.PolylineVObjectData.initializeBase(this,[n]),n&&(this.W=n.get_width(),this.C=n.get_color()._get_data())},Aurigma.GraphicsMill.AjaxControls.VectorObjects.PolylineVObjectData.applyState=function(n,t){t&&(t.beginUpdate(),t.set_width(n.W),t.set_color(Aurigma.GraphicsMill.AjaxControls.VectorObjects.Color._from_data(n.C))),Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseRectangleVObjectData.applyState(n,t)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.PolylineVObjectData.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.PolylineVObjectData",Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseRectangleVObjectData),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlaceholderVObject=function(n){var t=Aurigma.GraphicsMill.AjaxControls.VectorObjects;n instanceof Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RectangleF?(Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlaceholderVObject.initializeBase(this,[t.Math.Path.rectangle(n.Left,n.Top,n.Width,n.Height)]),this._controlPoints=[new t.Math.PointF(n.Left,n.Top),new t.Math.PointF(n.Right,n.Bottom)]):Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlaceholderVObject.initializeBase(this),this.set_borderWidth(0),this.set_fillColor("rgba(0,0,0,0)"),this._content=null,this._editing=!1,this._showMaskedContent=!0,this._isStubContent=!1,this._buttonGroup=null,this._editButtonGroup=null,this._doneButtonGroup=null,this._selectButton=null,this._editButton=null,this._doneButton=null,this._selectButtonClickHandler=Function.createDelegate(this,this._onSelectButtonClick),this._editButtonClickHandler=Function.createDelegate(this,this._onEditButtonClick)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlaceholderVObject.prototype={set_visible:function(n){if(this._visible!==n){Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlaceholderVObject.callBaseMethod(this,"set_visible",[n]),this._content!=null&&this._content.set_visible(n);var t=this.get_canvas();t!=null&&t._updatePlaceholderButtonGroup(this)}},set_locked:function(n){if(this._locked!==n){Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlaceholderVObject.callBaseMethod(this,"set_locked",[n]);var t=this.get_canvas();t!=null&&t._updatePlaceholderButtonGroup(this)}},get_content:function(){return this._content},set_content:function(n){this._content=n,this._content!=null&&(this._content._layer=this.get_layer(),this._content._parentPlaceholder=this);var t=this.get_canvas();t!=null&&t._updatePlaceholderButtonGroup(this)},isEmptyContent:function(){return this.get_content()==null},get_isStubContent:function(){return this._isStubContent},set_isStubContent:function(n){typeof n=="boolean"||(n=!1),this._isStubContent!==n&&(this._isStubContent=n)},isStubOrEmpty:function(){return this.get_isStubContent()||this.isEmptyContent()},get_editing:function(){return!this.isStubOrEmpty()&&this._editing&&this._permissions.get_allowEditContent()},set_editing:function(n){if(this._editing!==n){if(n&&!this._permissions.get_allowEditContent()&&this.isStubOrEmpty())return;this._editing=n,this._setNeedRedrawCanvasFlag(),this.raiseChanged();var t=this.get_canvas();t!=null&&(t.updateSelection(),t._updatePlaceholderButtonGroup(this),t.redraw())}},get_permissions:function(){return this.get_editing()?this.isEmptyContent()?new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Permission({},!1):this.get_content().get_permissions():this._permissions},set_permissions:function(n){this.get_editing()||(this._permissions=n,this.raiseChanged())},get_showMaskedContent:function(){return this._showMaskedContent},set_showMaskedContent:function(n){this._showMaskedContent=n,this._setNeedRedrawCanvasFlag()},clone:function(){var n=Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlaceholderVObject.callBaseMethod(this,"clone",[]);return this.isEmptyContent()||n.set_content(this.get_content().clone()),n},set_rectangle:function(n,t){this.get_editing()?this.get_content().set_rectangle(n,t):Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlaceholderVObject.callBaseMethod(this,"set_rectangle",[n,t])},_get_dataType:function(){return"PlaceholderVObjectData"},draw:function(n,t){if(!n)return;if(this.isEmptyContent()){Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlaceholderVObject.callBaseMethod(this,"draw",[n,t]);return}this.get_editing()&&this.get_showMaskedContent()&&t&&this.get_content()._drawMaskedContent(n);var i=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics,f=this.get_originalPath(),u=this._get_controlCenter(),r=this.get_transform();n.save(),i.clipPath(n,this._get_transformedPath()),i.fillPath(n,f,u,r,this.get_fillColor().Preview,this.get_opacity()),this.get_content().draw(n,t),n.restore(),i.drawPath(n,f,u,r,this.get_borderWidth(),this.get_borderColor().Preview,this.get_opacity())},get_selectionRectangle:function(){return this.get_editing()?this.get_content().get_selectionRectangle():Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlaceholderVObject.callBaseMethod(this,"get_selectionRectangle")},update:function(){this.isEmptyContent()||this.get_content().update();var n=this.get_canvas();n!=null&&n._updatePlaceholderButtonGroup(this)},add_selectButtonClick:function(n){this.get_events().addHandler("selectButtonClick",n)},remove_selectButtonClick:function(n){this.get_events().removeHandler("selectButtonClick",n)},_onAddedOnCanvas:function(n){Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlaceholderVObject.callBaseMethod(this,"_onAddedOnCanvas",[n]),this.isEmptyContent()||(this.get_content()._layer=this.get_layer(),this.get_content()._parentPlaceholder=this,this.get_content()._onAddedOnCanvas(n)),n!=null&&n._addPlaceholderButtonGroup(this)},_onRemovedFromCanvas:function(n){Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlaceholderVObject.callBaseMethod(this,"_onRemovedFromCanvas",[n]),n!=null&&n._removePlaceholderButtonGroup(this)},_transformRectangle:function(n,t){Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlaceholderVObject.callBaseMethod(this,"_transformRectangle",[n,t]),this.isEmptyContent()||this.get_content()._startRectangle==null||this.get_content()._transformRectangle(n,t);var i=this.get_canvas();i!=null&&i._updatePlaceholderButtonGroupPosition(this)},_startTransform:function(){Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlaceholderVObject.callBaseMethod(this,"_startTransform"),this.isEmptyContent()||(this.get_content()._startRectangle=this.get_content().get_rectangle())},_endTransform:function(n){var i,t;n&&this.get_canvas().get_history().get_trackingEnabled()&&this._startRectangle!=null&&(i=this.get_rectangle(),this.get_editing()||this.set_rectangle(this._startRectangle,!0),t=this.isEmptyContent()?null:this.get_content().get_rectangle(),t!=null&&this.get_content()._startRectangle!=null&&this.get_content().set_rectangle(this.get_content()._startRectangle,!0),this.get_canvas().get_history().addVObjectChanged(this,this.get_index(),this.get_layer().get_index()),t!=null&&this.get_content().set_rectangle(t),this.get_editing()||this.set_rectangle(i)),delete this._startRectangle,this.isEmptyContent()||delete this.get_content()._startRectangle},_transformChanged:function(){Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlaceholderVObject.callBaseMethod(this,"_transformChanged");var n=this.get_canvas();n!=null&&n._updatePlaceholderButtonGroupPosition(this)},_onResized:function(){Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlaceholderVObject.callBaseMethod(this,"_onResized"),this.isEmptyContent()||this.get_content()._onResized()},_updateColors:function(){Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlaceholderVObject.callBaseMethod(this,"_updateColors"),this.isEmptyContent()||this.get_content()._updateColors()},_onSelectButtonClick:function(){var n=this.get_events().getHandler("selectButtonClick");n!=null&&n(this)},_onEditButtonClick:function(){var t=this.get_editing(),n;t||(n=this.get_canvas(),n!=null&&(!n.isVObjectSelected(this),n.set_selectedVObjects([this]))),this.set_editing(!t)},_showEditButton:function(){return this._permissions.get_showEditButton()&&this._permissions.get_allowEditContent()},_showSelectButton:function(){return this._permissions.get_showSelectButton()}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlaceholderVObject.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlaceholderVObject",Aurigma.GraphicsMill.AjaxControls.VectorObjects.ShapeVObject),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlaceholderVObjectData=function(n){var i=n._editing,t;i&&(n._editing=!1),Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlaceholderVObjectData.initializeBase(this,[n]),n._editing=i,n&&(n.isEmptyContent()?(this.CD=null,this.CT=null):(t=new Aurigma.GraphicsMill.AjaxControls.VectorObjects[n.get_content()._get_dataType()](n.get_content()),t.__type=n.get_content()._get_dataType(),this.CD=JSON.stringify(t),this.CT=n.get_content()._get_type()),this.SMC=n.get_showMaskedContent(),this.ISC=n.get_isStubContent())},Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlaceholderVObjectData.applyState=function(n,t){if(t){t.beginUpdate();if(n.CT!=null&&n.CD!=null){var r=Aurigma.GraphicsMill.AjaxControls.VectorObjects,i=r.ObjectFactory.createObjectByType(n.CT,r);i.set_data(n.CD),t.set_content(i)}else t.set_content(null);t.set_showMaskedContent(n.SMC),t.set_isStubContent(n.ISC)}Aurigma.GraphicsMill.AjaxControls.VectorObjects.ShapeVObjectData.applyState(n,t)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlaceholderVObjectData.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlaceholderVObjectData",Aurigma.GraphicsMill.AjaxControls.VectorObjects.ShapeVObjectData),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.ContentVObject=function(n){n?Aurigma.GraphicsMill.AjaxControls.VectorObjects.ContentVObject.initializeBase(this,[n.Left,n.Top,n.Width,n.Height]):Aurigma.GraphicsMill.AjaxControls.VectorObjects.ContentVObject.initializeBase(this),this.set_borderWidth(0),this.set_fillColor("rgba(0,0,0,0)"),this._maskColor="rgba(0,0,0,0.8)",this._isWebkit="WebkitTransform"in document.documentElement.style,this._onImageLoadedDelegate=Function.createDelegate(this,function(n){if(!n.target)throw new Error('"e.target" is null.');this._onImageLoaded(n,n.target)}),this._isImageLoaded=!1,this._isLoadingImage=!1,this._isUpdatingAfterResize=!1,this._width=0,this._height=0,this._pixelWidth=0,this._pixelHeight=0,this._image=this._createImageObject(this._onImageLoadedDelegate),this._tmpImage=this._createImageObject(this._onImageLoadedDelegate),this._lastSetImgUrl=null,this._onCanvasChangedDelegate=null,this._parentPlaceholder=null},Aurigma.GraphicsMill.AjaxControls.VectorObjects.ContentVObject.prototype={set_visible:function(n){Aurigma.GraphicsMill.AjaxControls.VectorObjects.ContentVObject.callBaseMethod(this,"set_visible",[n]),this.isVisible()?this.update():this._setNeedRedrawCanvasFlag()},isVisible:function(){return this._parentPlaceholder!=null?this._parentPlaceholder.isVisible():Aurigma.GraphicsMill.AjaxControls.VectorObjects.ContentVObject.callBaseMethod(this,"isVisible")},get_maskColor:function(){return this._maskColor},set_maskColor:function(n){this._maskColor=n,this._setNeedRedrawCanvasFlag()},get_ready:function(){return this._isImageLoaded},isLoadingImage:function(){return this._isLoadingImage},_get_src:function(){return typeof this._lastSetImgUrl=="string"?this._lastSetImgUrl:this._createImageUrl()},_set_src:function(n){if(this._image.src===n)return;this._isImageLoaded=!1,this._image.src=n,this._lastSetImgUrl=n},_createImageObject:function(n){var t=new Image;return this._fix0015740(t),typeof n=="function"&&Sys.UI.DomEvent.addHandler(t,"load",n),t},_onImageLoaded:function(n,t){t===this._tmpImage&&(this._tmpImage=this._image,this._image=t);var i=this.get_canvas();i!=null&&(i._pendingRedrawTimeout||(i._pendingRedrawTimeout=setTimeout(function(){i.redraw(!0),i._pendingRedrawTimeout=null},100))),this._isImageLoaded=!0,this._isLoadingImage=!1,this._isUpdatingAfterResize=!1,this._dispatchReadyEvent(),this._height=this.get_rectangle().Height},_createImageUrl:function(){return null},_updateImageUrl:function(){var t,n;if(!this.isVisible())return;t=this.get_canvas();if(t==null||!t.get_isInitialized())return;n=this._createImageUrl();if(n===null){this._isImageLoaded=!1,this._image.src="",t.redraw(!0);return}this._lastSetImgUrl!==n&&(this._lastSetImgUrl=n,this._isLoadingImage=!0,this._width=this._pixelWidth,this._height=this._pixelHeight,this._isWebkit&&(this._tmpImage=this._createImageObject(this._onImageLoadedDelegate)),this._tmpImage.src=n)},_onCanvasChanged:function(){this._isChanging||this._updateImageUrl()},quickUpdate:function(){this._updateImageUrl()},draw:function(n){if(!n)return;var r=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics,u=this._parentPlaceholder!=null?this._parentPlaceholder.get_rectangle():this.get_rectangle(),i=this.get_rectangle();r.fillRectangle(n,i,this.get_fillColor().Preview,this.get_opacity()),this._isImageLoaded?this._drawImage(n,this.get_canvas().get_disableSmoothing()):(this._isLoadingImage||this._isUpdatingByService)&&this.get_canvas()._drawWaitClock(n,{X:u.CenterX,Y:u.CenterY}),this.get_borderWidth()>0&&(i.Width+=this.get_borderWidth(),i.Height+=this.get_borderWidth(),r.drawRectangle(n,i,this.get_borderWidth(),this.get_borderColor().Preview,this.get_opacity()))},_drawMaskedContent:function(n){this._drawImage(n,this.get_canvas().get_disableSmoothing(),this.get_maskColor());if(this._parentPlaceholder==null)return;n.globalCompositeOperation="destination-out";var t=this._parentPlaceholder;Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.fillPath(n,t.get_originalPath(),t._get_controlCenter(),t.get_transform(),"#fff"),n.globalCompositeOperation="source-over"},_drawImage:function(n,t,i){var s=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics,o=this.get_rectangle(),u;if(Sys.Browser.agent!==Sys.Browser.Firefox||this._image.complete){var r=this.get_canvas(),l=Aurigma.GraphicsMill.AjaxControls.VectorObjects.BoundedTextVObject.isInstanceOfType(this),h=r.isVObjectSelected(this)&&r.isResizing(),c=this._isLoadingImage||this._isUpdatingAfterResize,f=r.get_screenXDpi()*r.get_zoom()/72,e=r.get_screenYDpi()*r.get_zoom()/72;l?c||(u=h&&this._startRectangle?this._startRectangle:o,s.drawImage(n,this._image,u,f,e,t,i,this.get_opacity())):s.drawImage(n,this._image,o,f,e,t,i,this.get_opacity())}},_get_boundsMargin:function(){return this.get_borderWidth()*2},_onResized:function(){this._isUpdatingAfterResize=!0,this.update()},_onAddedOnCanvas:function(n,t){Aurigma.GraphicsMill.AjaxControls.VectorObjects.ContentVObject.callBaseMethod(this,"_onAddedOnCanvas",[n,t]),this._updateImageUrl();if(!this._onCanvasChangedDelegate){var i=this.get_canvas();i&&(this._onCanvasChangedDelegate=Function.createDelegate(this,this._onCanvasChanged),i.add_zoomChanged(this._onCanvasChangedDelegate),this._needToDownloadImage&&this.update())}},_onRemovedFromCanvas:function(n){Aurigma.GraphicsMill.AjaxControls.VectorObjects.ContentVObject.callBaseMethod(this,"_onRemovedFromCanvas",[n]),n&&(n.remove_zoomChanged(this._onCanvasChangedDelegate),delete this._onCanvasChangedDelegate)},dispose:function(){Sys.UI.DomEvent.clearHandlers(this._tmpImage),Sys.UI.DomEvent.clearHandlers(this._image),delete this._onImageLoadedDelegate;if(this._onCanvasChangedDelegate){var n=this.get_canvas();n&&n.remove_zoomChanged(this._onCanvasChangedDelegate),delete this._onCanvasChangedDelegate}Aurigma.GraphicsMill.AjaxControls.VectorObjects.ContentVObject.callBaseMethod(this,"dispose")},_fix0015740:function(n){this._doc=n.document}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.ContentVObject.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.ContentVObject",Aurigma.GraphicsMill.AjaxControls.VectorObjects.RectangleVObject),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.ContentVObjectData=function(n){Aurigma.GraphicsMill.AjaxControls.VectorObjects.ContentVObjectData.initializeBase(this,[n]),n&&(this.MC=n.get_maskColor())},Aurigma.GraphicsMill.AjaxControls.VectorObjects.ContentVObjectData.applyState=function(n,t){t&&(t.beginUpdate(),t.set_maskColor(n.MC)),Aurigma.GraphicsMill.AjaxControls.VectorObjects.ShapeVObjectData.applyState(n,t)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.ContentVObjectData.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.ContentVObjectData",Aurigma.GraphicsMill.AjaxControls.VectorObjects.ShapeVObjectData),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.ImageVObject=function(n,t,i){Aurigma.GraphicsMill.AjaxControls.VectorObjects.ImageVObject.initializeBase(this,[t]),this._sourceImageWidth=null,this._sourceImageHeight=null,i||(i={}),this._takeIntoAccountImageDpi=i.takeIntoAccountImageDpi===!1?!1:!0,this._needToDownloadImage=i.downloadToCache===!0?!0:!1,this._saveAspectRatio=i.preserveAspectRatio===!1?!1:!0,this._actualSize=i.actualSize===!0?!0:!1,n&&!this._needToDownloadImage?this._image.src=n:this._sourceUrl=n},Aurigma.GraphicsMill.AjaxControls.VectorObjects.ImageVObject.getImageUrl=function(n,t,i,r,u){var f=n.get_handlerUrl()+"/img?f="+encodeURIComponent(t)+"&w="+encodeURIComponent(i)+"&h="+encodeURIComponent(r);return n.get_previewColorManagementEnabled()&&(f+="&cmyk="+encodeURIComponent(n._cmykColorProfileFileId)+"&rgb="+encodeURIComponent(n._rgbColorProfileFileId)+"&grayscale="+encodeURIComponent(n._grayscaleColorProfileFileId),n.get_previewTargetColorSpace()!==null&&(f+="&target="+encodeURIComponent(n.get_previewTargetColorSpace()))),u&&(f+="&sq=true"),f},Aurigma.GraphicsMill.AjaxControls.VectorObjects.ImageVObject.prototype={maxImageSize:4e6,loadImage:function(n,t){typeof n!="string"&&console.error("Invalid sourceUrl: "+n),t=t||{},t.downloadToServerCache===!0?(this._needToDownloadImage=!0,this._actualSize=t.actualSize===!0?!0:!1,this._saveAspectRatio=t.saveAspectRatio===!1?!1:!0,this._sourceUrl=n,this.update()):(this._needToDownloadImage=!1,this.set_src(n))},get_saveAspectRatio:function(){return this._saveAspectRatio},set_saveAscpectRatio:function(n){this._saveAspectRatio=n},get_scaleToActualSize:function(){return this._takeIntoAccountImageDpi},get_src:function(){return this._get_src()},set_src:function(n){this._set_src(n)},get_sourceFileId:function(){return this._sourceFileId},set_sourceFileId:function(n){if(this._sourceFileId===n)return;this._sourceFileId=n,this._isImageLoaded=!1,this._sourceImageWidth=null,this._sourceImageHeight=null},get_sourceImageWidth:function(){return this._sourceImageWidth},set_sourceImageWidth:function(n){this._sourceImageWidth=n},get_sourceImageHeight:function(){return this._sourceImageHeight},set_sourceImageHeight:function(n){this._sourceImageHeight=n},_updateColors:function(){Aurigma.GraphicsMill.AjaxControls.VectorObjects.ImageVObject.callBaseMethod(this,"_updateColors"),this.update()},update:function(n,t){this._sourceUrl!=undefined&&this._sourceUrl!=null?this._update([this._actualSize,this._saveAspectRatio,this._sourceUrl],n,t):this.quickUpdate()},_get_dataType:function(){return"ImageVObjectData"},_updateImageUrl:function(){var n,i,t;if(this.isVisible()){this._lastSetImgUrl=null,n=Function.createDelegate(this,function(){Aurigma.GraphicsMill.AjaxControls.VectorObjects.ImageVObject.callBaseMethod(this,"_updateImageUrl")});if(this.get_sourceFileId()==null||this._sourceImageWidth!=null&&this._sourceImageHeight!=null){n();return}i=Function.createDelegate(this,function(t){this._sourceImageWidth=t.Width,this._sourceImageHeight=t.Height;if(this._saveAspectRatio){var i=this._sourceImageWidth/this._sourceImageHeight;this.get_width()<this.get_height()?this.set_height(this.get_width()/i):this.set_width(this.get_height()*i)}n()}),t=Function.createDelegate(this,function(n){window.console&&(console.error("Unable GetimageSize of image with id "+this.get_sourceFileId()),console.error(n))}),this.ns.Service.GetImageSize(this.get_sourceFileId(),i,t)}},_createImageUrl:function(){var f=this.get_sourceFileId(),r,t,n,i;if(f==null)return null;r=this.get_canvas();if(r==null)return null;if(this._isImageLoaded&&this._width>=this._sourceImageWidth&&this._height>=this._sourceImageHeight)t=this._sourceImageWidth,n=this._sourceImageHeight;else{var e=r.get_zoom(),o=r.get_screenXDpi(),h=r.get_screenYDpi(),c=e*o/72,s=e*h/72,u=this.get_rectangle();t=u.Width*c,n=u.Height*s}return t=Math.min(t,this._sourceImageWidth),n=Math.min(n,this._sourceImageHeight),i=this.maxImageSize/t/n,i<1&&(i=Math.sqrt(i),t=t*i,n=n*i),t=Math.round(t),n=Math.round(n),this._pixelWidth=t,this._pixelHeight=n,Aurigma.GraphicsMill.AjaxControls.VectorObjects.ImageVObject.getImageUrl(r,f,t,n)},add_imageResized:function(n){this.get_events().addHandler("ImageResized",n)},remove_imageResized:function(n){this.get_events().removeHandler("ImageResized",n)},_onResized:function(){var t=this.get_events().getHandler("ImageResized"),n;t&&(n=this.get_rectangle(),t(this,{Width:n.Width,Height:n.Height})),Aurigma.GraphicsMill.AjaxControls.VectorObjects.ImageVObject.callBaseMethod(this,"_onResized")}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.ImageVObject.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.ImageVObject",Aurigma.GraphicsMill.AjaxControls.VectorObjects.ContentVObject),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.ImageVObjectData=function(n){Aurigma.GraphicsMill.AjaxControls.VectorObjects.ImageVObjectData.initializeBase(this,[n]),n&&(this.SrcId=n._sourceFileId,this.SrcW=n._sourceImageWidth,this.SrcH=n._sourceImageHeight,this.DI=n._needToDownloadImage,this.SAS=n._takeIntoAccountImageDpi,this.HR=n._privateCacheImageHorizontalResolution,this.VR=n._privateCacheImageVerticalResolution)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.ImageVObjectData.applyState=function(n,t){t&&(t.beginUpdate(),t._sourceFileId=n.SrcId,t._sourceImageWidth=n.SrcW,t._sourceImageHeight=n.SrcH,t._privateCacheImageHorizontalResolution=n.HR,t._privateCacheImageVerticalResolution=n.VR,t._needToDownloadImage=n.DI,t._takeIntoAccountImageDpi=n.SAS,Aurigma.GraphicsMill.AjaxControls.VectorObjects.ContentVObjectData.applyState(n,t))},Aurigma.GraphicsMill.AjaxControls.VectorObjects.ImageVObjectData.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.ImageVObjectData",Aurigma.GraphicsMill.AjaxControls.VectorObjects.ContentVObjectData),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseTextVObject=function(n,t,i,r){var u=Aurigma.GraphicsMill.AjaxControls.VectorObjects;u.BaseTextVObject.initializeBase(this,[t]),this._text=typeof n=="string"?n:"",this._font=new u.BaseTextVObject.ProtectedFontSettings(this,i!=null?i:"ArialMT",r!=null?r:20,!1,!1),this._textColor=new u.RgbColor("rgb(0,0,0)"),this._underline=!1,this._alignment=0,this._tracking=0,this._leading=0,this._isRichText=!1,this._verticalScale=1,this._horizontalScale=1,this._currentFileId=null,this.get_permissions().set_allowArbitraryResize(!1),this.get_permissions().set_allowProportionalResize(!1),this._allowNegativeResize=!1},Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseTextVObject.prototype={update:function(n,t){if(this.isVisible()){var i=Function.createDelegate(this,function(){this._afterUpdate(t)});Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseTextVObject.callBaseMethod(this,"_update",[null,n,i])}else typeof n=="function"&&n()},_afterUpdate:function(n){typeof n=="function"&&n()},_validateBeforeCallService:function(){return this.get_text().trim()!==""},get_alignment:function(){return this._alignment},set_alignment:function(n){if(n!==this._alignment){var t=Function.createDelegate(this,function(){this._alignment=n});this.update(t)}},get_font:function(){return this._font},get_textColor:function(){return this._textColor},set_textColor:function(n){var i=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Color.createColor(n),t;this._textColor.equals(i)||(t=Function.createDelegate(this,function(){this._textColor=i}),this.update(t))},get_underline:function(){return this._underline},set_underline:function(n){if(n!==this._underline){var t=Function.createDelegate(this,function(){this._underline=n});this.update(t)}},get_text:function(){return this._text},set_text:function(n){if(n!==this._text){var t=Function.createDelegate(this,function(){this._text=n});this.update(t)}},get_tracking:function(){return this._tracking},set_tracking:function(n){if(this._tracking!==n){var t=Function.createDelegate(this,function(){this._tracking=n});this.update(t)}},get_verticalScale:function(){return this._verticalScale},set_verticalScale:function(n){n=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.EqualsOfFloatNumbers(n,0)?1:n;if(this._verticalScale!==n){var t=Function.createDelegate(this,function(){this._verticalScale=n});this.update(t)}},get_horizontalScale:function(){return this._horizontalScale},set_horizontalScale:function(n){n=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.EqualsOfFloatNumbers(n,0)?1:n;if(this._horizontalScale!==n){var t=Function.createDelegate(this,function(){this._horizontalScale=n});this.update(t)}},get_isRichText:function(){return this._isRichText},set_isRichText:function(n){this._isRichText!==n&&(this._isRichText=n)},get_leading:function(){return this._leading},set_leading:function(n){if(this._leading!==n){var t=Function.createDelegate(this,function(){this._leading=n});this.update(t)}},_updateColors:function(){Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseTextVObject.callBaseMethod(this,"_updateColors"),this.update()},_transformChanged:function(){Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseTextVObject.callBaseMethod(this,"_transformChanged");if(this.get_isUpdating()&&this._callbacks){var t=this.get_transform().clone(),n=Function.createDelegate(this,function(){this.set_transform(t,!0)});this._callbacks.push(n)}},_createImageUrl:function(){var n=this.get_canvas();return n==null||this._currentFileId==null||this._currentFileId.length===0?null:n.get_handlerUrl()+"/txt?f="+encodeURIComponent(this._currentFileId)},_updateImageUrl:function(){if(this.get_text().trim()==="")return;Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseTextVObject.callBaseMethod(this,"_updateImageUrl")},_drawImage:function(n,t,i){if(this.get_text().trim()==="")return;Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseTextVObject.callBaseMethod(this,"_drawImage",[n,t,i])},_get_dataType:function(){return"BaseTextVObjectData"},_onCanvasChanged:function(){this._isChanging||this.update()}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseTextVObject.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseTextVObject",Aurigma.GraphicsMill.AjaxControls.VectorObjects.ContentVObject),Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseTextVObject.ProtectedFontSettings=function(n,t,i,r,u){this._baseTextVObject=n,this._postScriptName=t,this._size=i,this._fauxBold=r,this._fauxItalic=u},Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseTextVObject.ProtectedFontSettings.prototype={get_postScriptName:function(){return this._postScriptName},set_postScriptName:function(n){if(this._postScriptName===n)return;this._baseTextVObject.update(function(){this._postScriptName=n}.bind(this))},get_size:function(){return this._size},set_size:function(n){var t=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math;if(t.EqualsOfFloatNumbers(this._size,n))return;this._baseTextVObject.update(function(){this._size=n}.bind(this))},get_fauxBold:function(){return this._fauxBold},set_fauxBold:function(n){if(this._fauxBold===n)return;this._baseTextVObject.update(function(){this._fauxBold=n}.bind(this))},get_fauxItalic:function(){return this._fauxItalic},set_fauxItalic:function(n){if(this._fauxItalic===n)return;this._baseTextVObject.update(function(){this._fauxItalic=n}.bind(this))}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseTextVObject.ProtectedFontSettings.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseTextVObject.ProtectedFontSettings"),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseTextVObjectData=function(n){Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseTextVObjectData.initializeBase(this,[n]),n&&(this.Txt=n.get_text().replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),this.F_FB=n.get_font().get_fauxBold(),this.F_FI=n.get_font().get_fauxItalic(),this.F_N=n.get_font().get_postScriptName(),this.F_S=n.get_font().get_size(),this.TC=n.get_textColor()._get_data(),this.U=n.get_underline(),this.A=n.get_alignment(),this.Tr=n.get_tracking(),this.Ld=n.get_leading(),this.IRT=n.get_isRichText(),this.VS=n.get_verticalScale(),this.HS=n.get_horizontalScale())},Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseTextVObjectData.applyState=function(n,t){t&&(t.beginUpdate(),t._text=n.Txt.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&"),t._font._postScriptName=n.F_N,t._font._size=n.F_S,t._font._fauxBold=n.F_FB,t._font._fauxItalic=n.F_FI,t._textColor=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Color._from_data(n.TC),t._underline=n.U,t._alignment=n.A,t._tracking=n.Tr,t._leading=n.Ld,t._isRichText=n.IRT,t._verticalScale=n.VS,t._horizontalScale=n.HS,t._currentFileId=n.CFI),Aurigma.GraphicsMill.AjaxControls.VectorObjects.ContentVObjectData.applyState(n,t)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseTextVObjectData.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseTextVObjectData",Aurigma.GraphicsMill.AjaxControls.VectorObjects.ContentVObjectData),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.DashedLineVObject=function(n,t,i,r){Aurigma.GraphicsMill.AjaxControls.VectorObjects.DashedLineVObject.initializeBase(this,[n,t,i,r]),this._dashWidth=3,this._altDashWidth=3,this._altColor=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.RgbColor("rgba(0,0,0,0)")},Aurigma.GraphicsMill.AjaxControls.VectorObjects.DashedLineVObject.prototype={get_dashWidth:function(){return this._dashWidth},set_dashWidth:function(n){this._dashWidth=n,this._setNeedRedrawCanvasFlag()},get_altDashWidth:function(){return this._altDashWidth},set_altDashWidth:function(n){this._altDashWidth=n,this._setNeedRedrawCanvasFlag()},get_altColor:function(){return this._altColor},set_altColor:function(n){var t=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Color.createColor(n);this._altColor.equals(t)||(this._altColor=t,this._setNeedRedrawCanvasFlag())},_get_dataType:function(){return"DashedLineVObjectData"},draw:function(n){var i,r,t;if(!n)return;i=this.get_point0(),r=this.get_point1();if(this.get_width()>0){var u=this.get_width(),e=this.get_dashWidth(),f=this.get_altDashWidth();this.get_fixedWidth()&&(t=this.get_canvas().get_zoom(),u/=t,e/=t,f/=t),Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.drawDashedLine(n,i.X,i.Y,r.X,r.Y,u,this.get_color().Preview,this.get_altColor().Preview,e,f,this.get_opacity())}},_updateColors:function(){Aurigma.GraphicsMill.AjaxControls.VectorObjects.DashedLineVObject.callBaseMethod(this,"_updateColors");var t=this,n=Function.createDelegate(this,function(n){t.set_altColor(n)});this._updateColor(this.get_altColor(),n)}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.DashedLineVObject.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.DashedLineVObject",Aurigma.GraphicsMill.AjaxControls.VectorObjects.LineVObject),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.DashedLineVObjectData=function(n){Aurigma.GraphicsMill.AjaxControls.VectorObjects.DashedLineVObjectData.initializeBase(this,[n]),n&&(this.AC=n.get_altColor()._get_data(),this.DW=n.get_dashWidth(),this.ADW=n.get_altDashWidth())},Aurigma.GraphicsMill.AjaxControls.VectorObjects.DashedLineVObjectData.applyState=function(n,t){t&&(t.beginUpdate(),t.set_altColor(Aurigma.GraphicsMill.AjaxControls.VectorObjects.Color._from_data(n.AC)),t.set_dashWidth(n.DW),t.set_altDashWidth(n.ADW)),Aurigma.GraphicsMill.AjaxControls.VectorObjects.LineVObjectData.applyState(n,t)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.DashedLineVObjectData.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.DashedLineVObjectData",Aurigma.GraphicsMill.AjaxControls.VectorObjects.LineVObjectData),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.GridVObject=function(n,t,i,r,u,f){Aurigma.GraphicsMill.AjaxControls.VectorObjects.GridVObject.initializeBase(this,[n,t,i*u,r*f]),this.set_cols(i),this.set_rows(r),this.set_stepX(u),this.set_stepY(f),this._horizontalLineColor=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.RgbColor("rgba(0,0,0,1)"),this._verticalLineColor=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.RgbColor("rgba(0,0,0,1)"),this.set_lineWidth(1),this.set_fixedLineWidth(!0),this.set_textWrappingMode(Aurigma.GraphicsMill.AjaxControls.VectorObjects.WrappingMode.None)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.GridVObject.prototype={get_locked:function(){return!0},get_cols:function(){return this._cols},set_cols:function(n){this._cols=n,this._setNeedRedrawCanvasFlag()},get_rows:function(){return this._rows},set_rows:function(n){this._rows=n,this._setNeedRedrawCanvasFlag()},get_stepX:function(){return this._stepX},set_stepX:function(n){this._stepX=n,this._setNeedRedrawCanvasFlag()},get_stepY:function(){return this._stepY},set_stepY:function(n){this._stepY=n,this._setNeedRedrawCanvasFlag()},get_horizontalLineColor:function(){return this._horizontalLineColor},set_horizontalLineColor:function(n){var t=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Color.createColor(n);this._horizontalLineColor.equals(t)||(this._horizontalLineColor=t,this._setNeedRedrawCanvasFlag())},get_verticalLineColor:function(){return this._verticalLineColor},set_verticalLineColor:function(n){var t=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Color.createColor(n);this._verticalLineColor.equals(t)||(this._verticalLineColor=t,this._setNeedRedrawCanvasFlag())},get_lineWidth:function(){return this._lineWidth},set_lineWidth:function(n){this._lineWidth=n,this._setNeedRedrawCanvasFlag()},get_fixedLineWidth:function(){return this._fixedLineWidth},set_fixedLineWidth:function(n){this._fixedLineWidth=n,this._setNeedRedrawCanvasFlag()},_get_dataType:function(){return"GridVObjectData"},draw:function(n){var e,f,o;if(!n)return;n.save(),e=this.get_rectangle().get_bounds(),n.translate(e.Left,e.Top);var s=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics,c=this.get_canvas(),l=this.get_verticalLineColor().Preview,h=this.get_horizontalLineColor().Preview,i=this.get_lineWidth();this.get_fixedLineWidth()&&(i/=c.get_zoom());for(var r=i/2,v=this.get_stepX()*this.get_cols()+r,a=this.get_stepY()*this.get_rows()+r,t=0,u=this.get_cols();t<=u;t++)f=t*this.get_stepX()+r,s.drawLine(n,f,0,f,a,i,l,this.get_opacity());for(t=0,u=this.get_rows();t<=u;t++)o=t*this.get_stepY()+r,s.drawLine(n,0,o,v,o,i,h,this.get_opacity());n.restore()},_updateColors:function(){Aurigma.GraphicsMill.AjaxControls.VectorObjects.GridVObject.callBaseMethod(this,"_updateColors");var n=this,i=Function.createDelegate(this,function(t){n.set_verticalLineColor(t)}),t=Function.createDelegate(this,function(t){n.set_horizontalLineColor(t)});this._updateColor(this.get_verticalLineColor(),i),this._updateColor(this.get_horizontalLineColor(),t)}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.GridVObject.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.GridVObject",Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseRectangleVObject),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.GridVObjectData=function(n){Aurigma.GraphicsMill.AjaxControls.VectorObjects.GridVObjectData.initializeBase(this,[n]),n&&(this.C=n.get_cols(),this.R=n.get_rows(),this.SX=n.get_stepX(),this.SY=n.get_stepY(),this.HLC=n.get_horizontalLineColor()._get_data(),this.VLC=n.get_verticalLineColor()._get_data(),this.LW=n.get_lineWidth(),this.FLW=n.get_fixedLineWidth())},Aurigma.GraphicsMill.AjaxControls.VectorObjects.GridVObjectData.applyState=function(n,t){t&&(t.beginUpdate(),t.set_cols(n.C),t.set_rows(n.R),t.set_stepX(n.SX),t.set_stepY(n.SY),t.set_horizontalLineColor(Aurigma.GraphicsMill.AjaxControls.VectorObjects.Color._from_data(n.HLC)),t.set_verticalLineColor(Aurigma.GraphicsMill.AjaxControls.VectorObjects.Color._from_data(n.VLC)),t.set_lineWidth(n.LW),t.set_fixedLineWidth(n.FLW)),Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseRectangleVObjectData.applyState(n,t)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.GridVObjectData.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.GridVObjectData",Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseRectangleVObjectData),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.SvgVObject=function(n){n?Aurigma.GraphicsMill.AjaxControls.VectorObjects.SvgVObject.initializeBase(this,[n.Left,n.Top,n.Width,n.Height]):Aurigma.GraphicsMill.AjaxControls.VectorObjects.SvgVObject.initializeBase(this),Sys.Browser.agent===Sys.Browser.InternetExplorer&&(Sys.Browser.version==9||Sys.Browser.documentMode==9)&&(this._domImage=document.createElement("image"),this._domImage.id="img_"+this._uniqueId,this._domImage.style.display="none",document.body.appendChild(this._domImage)),this._onImageLoadedDelegate=Function.createDelegate(this,function(n){if(!n.target)throw new Error('"e.target" is null.');this._onImageLoaded(n,n.target)}),this._image=this._createImageObject(this._onImageLoadedDelegate),this._isImageLoaded=!1,this._svgWrapper=null,this._svg="",this.set_borderWidth(0),this.set_fillColor("rgba(0,0,0,0)"),this._strokeColor=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.RgbColor("rgba(0,0,0,0)")},Aurigma.GraphicsMill.AjaxControls.VectorObjects.SvgVObject.prototype={get_ready:function(){return this._isImageLoaded},_createImageObject:function(n){var t;return t=Sys.Browser.agent===Sys.Browser.InternetExplorer&&(Sys.Browser.version==9||Sys.Browser.documentMode==9)&&this._domImage?this._domImage:new Image,this._fix0015740(t),typeof n=="function"&&Sys.UI.DomEvent.addHandler(t,"load",n),t},_onImageLoaded:function(){var i=this.get_canvas();i&&(i._pendingRedrawTimeout||(i._pendingRedrawTimeout=setTimeout(function(){i._pendingRedrawTimeout=null,i.redraw(!0)},300))),this._isImageLoaded=!0,this._dispatchReadyEvent()},draw:function(n){var t=this.get_rectangle(),r,i,u;if(!SVG.supported){r=(t.Height/4).toFixed(0),n.font=""+r+"px Arial",n.textAlign="center",n.fillText("NO SVG",t.CenterX,t.CenterY+r/2,t.Width);return}i=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics,i.fillRectangle(n,t,this.get_fillColor().Preview),Sys.Browser.agent==Sys.Browser.Firefox&&(this._isImageLoaded=this._image.complete!=!0?!1:!0),this._isImageLoaded?(i.drawImage(n,this._image,t,0,0,null,null,this.get_opacity()),this._image.src.indexOf("blob")==0&&(u=self.URL||self.webkitURL||self,u.revokeObjectURL(this._image.src))):this.get_canvas()._drawWaitClock(n,{X:t.CenterX,Y:t.CenterY}),this.get_borderWidth()>0&&(t.Width+=this.get_borderWidth(),t.Height+=this.get_borderWidth(),i.drawRectangle(n,t,this.get_borderWidth(),this.get_borderColor().Preview))},_onAddedOnCanvas:function(n){Aurigma.GraphicsMill.AjaxControls.VectorObjects.SvgVObject.callBaseMethod(this,"_onAddedOnCanvas",[n,!0]),this.initialize()},initialize:function(){Aurigma.GraphicsMill.AjaxControls.VectorObjects.SvgVObject.callBaseMethod(this,"initialize");if(!SVG.supported){this.get_permissions().set_allowProportionalResize(!1),this.get_permissions().set_allowArbitraryResize(!1),this.get_permissions().set_allowRotate(!1),this.get_permissions().set_allowMoveHorizontal(!1),this.get_permissions().set_allowMoveVertical(!1);return}this._updateSize(),this._updateImage()},_get_boundsMargin:function(){return this.get_borderWidth()*2},_get_dataType:function(){return"SvgVObjectData"},get_svg:function(){return this._svg.replace(/</g,"&lt;").replace(/>/g,"&gt;")},set_svg:function(n){n=n.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"');if(SVG.supported&&n!=""){if(n!=this._svg){var t=SVG(document.createElement("div"));t.clear(),t.svg(n),this._svgWrapper=t.children()[0],Sys.Browser.agent===Sys.Browser.Firefox&&(this._ffSvgWidth=this._svgWrapper.attr("width"),this._ffSvgHeight=this._svgWrapper.attr("height"),this._ffSvgScaleX=this._svgWrapper.transform().scaleX,this._ffSvgScaleY=this._svgWrapper.transform().scaleY),this._updateImage()}}else this._svg=n},get_strokeColor:function(){return this._strokeColor},set_strokeColor:function(n){var t=Aurigma.GraphicsMill.AjaxControls.VectorObjects.Color.createColor(n);this._strokeColor.equals(t)||(this._strokeColor=t,this._updateStroke())},_updateStroke:function(){if(SVG.supported&&this._svgWrapper){var n=this;this._svgWrapper.each(function(){this.stroke({color:n._strokeColor.Preview})},!0),this._updateImage()}},_updateImage:function(){if(this._svgWrapper){this._svg=this._svgWrapper.svg();if(Sys.Browser.agent===Sys.Browser.Safari&&navigator.userAgent.toLowerCase().indexOf("chrome")==-1||Sys.Browser.agent===Sys.Browser.InternetExplorer&&(Sys.Browser.version==9||Sys.Browser.documentMode==9))typeof btoa=="undefined"&&(_keyStr=Base64._keyStr,btoa=Base64.encode,atob=Base64.decode),this._image.src="data:image/svg+xml;base64,"+btoa(this._svg);else{var t=new Blob([this._svg],{type:"image/svg+xml;charset=utf-8"}),n=self.URL||self.webkitURL||self;this._image.src=n.createObjectURL(t)}}},_updateSize:function(){if(this._svgWrapper){var t=(this.get_rectangle().Width/this._ffSvgWidth).toFixed(2)*this._ffSvgScaleX,n=(this.get_rectangle().Height/this._ffSvgHeight).toFixed(2)*this._ffSvgScaleY;(isNaN(t)||isNaN(n)||!isFinite(t)||!isFinite(n))&&(t=1,n=1),this._svgWrapper.transform({scaleX:t,scaleY:n}),this._svgWrapper.size(this.get_rectangle().Width,this.get_rectangle().Height)}},dispose:function(){this._onImageLoadedDelegate&&(Sys.UI.DomEvent.clearHandlers(this._image),delete this._onImageLoadedDelegate),Sys.Browser.agent===Sys.Browser.InternetExplorer&&(Sys.Browser.version==9||Sys.Browser.documentMode==9)&&this._domImage&&document.body.removeChild(this._domImage),Aurigma.GraphicsMill.AjaxControls.VectorObjects.SvgVObject.callBaseMethod(this,"dispose")},_fix0015740:function(n){this._doc=n.document},_updateColors:function(){Aurigma.GraphicsMill.AjaxControls.VectorObjects.SvgVObject.callBaseMethod(this,"_updateColors");var t=this,n=Function.createDelegate(this,function(n){t.set_strokeColor(n)});this._updateColor(this.get_strokeColor(),n)}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.SvgVObject.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.SvgVObject",Aurigma.GraphicsMill.AjaxControls.VectorObjects.RectangleVObject),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.SvgVObjectData=function(n){Aurigma.GraphicsMill.AjaxControls.VectorObjects.SvgVObjectData.initializeBase(this,[n]),n&&(this.S=n.get_svg(),this.SC=n.get_strokeColor()._get_data())},Aurigma.GraphicsMill.AjaxControls.VectorObjects.SvgVObjectData.applyState=function(n,t){t&&(t.beginUpdate(),t.set_svg(n.S),t.set_strokeColor(Aurigma.GraphicsMill.AjaxControls.VectorObjects.Color._from_data(n.SC))),Aurigma.GraphicsMill.AjaxControls.VectorObjects.ShapeVObjectData.applyState(n,t)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.SvgVObjectData.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.SvgVObjectData",Aurigma.GraphicsMill.AjaxControls.VectorObjects.ShapeVObjectData),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.BoundedTextVObject=function(n,t,i,r){Aurigma.GraphicsMill.AjaxControls.VectorObjects.BoundedTextVObject.initializeBase(this,[n,t,i,r]),this._wrappingRectangles=[],this._wrappingMargin=7,this._paragraphSettings=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.ParagraphSettings,this._verticalAlignment=Aurigma.GraphicsMill.AjaxControls.VectorObjects.TextVerticalAlignment.Top,this._isVertical=!1},Aurigma.GraphicsMill.AjaxControls.VectorObjects.BoundedTextVObject.prototype={get_wrappingRectangles:function(){return this._wrappingRectangles},set_wrappingRectangles:function(n){if(!this._areRectanglesEqual(this._wrappingRectangles,n)){var t=Function.createDelegate(this,function(){this._wrappingRectangles=n});this.update(t)}},get_wrappingMargin:function(){return this._wrappingMargin},set_wrappingMargin:function(n){if(this._wrappingMargin!==n){var t=Function.createDelegate(this,function(){this._wrappingMargin=n});this.update(t)}},get_paragraphSettings:function(){return this._paragraphSettings},set_paragraphSettings:function(n){n instanceof Aurigma.GraphicsMill.AjaxControls.VectorObjects.ParagraphSettings||(n=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.ParagraphSettings(n));if(!this._paragraphSettings.equals(n)){var t=Function.createDelegate(this,function(){this._paragraphSettings=n});this.update(t)}},get_verticalAlignment:function(){return this._verticalAlignment},set_verticalAlignment:function(n){if(this._verticalAlignment!==n){var t=Function.createDelegate(this,function(){this._verticalAlignment=n});this.update(t)}},get_isVertical:function(){return this._isVertical},set_isVertical:function(n){if(this._isVertical!==n){var t=Function.createDelegate(this,function(){this._isVertical=n});this.update(t)}},_get_dataType:function(){return"BoundedTextVObjectData"},_onAddedOnCanvas:function(n){Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseTextVObject.callBaseMethod(this,"_onAddedOnCanvas",[n,!0]),this._updateWrappingRectangles(!0)},_updateWrappingRectangles:function(n){var y=this.get_canvas(),u,w,r,o,f,v,t,h,l,a,c;if(y==null)return;var s=Aurigma.GraphicsMill.AjaxControls.VectorObjects,p=this.get_layer().get_index(),k=this.get_index(),i=this.get_rectangle(),e=[],b=y.get_layers();for(u=p,w=b.get_count();u<w;u++){r=b.get_item(u);if(!r.get_visible())continue;for(o=r.get_vObjects(),f=0,v=o.get_count();f<v;f++)t=o.get_item(f),t.get_visible()&&!t.get_permissions().get_noShow()&&t.get_textWrappingMode()!=s.WrappingMode.None&&(t.get_index()>k||r.get_index()>p)&&(h=t.get_textWrappingMode()==s.WrappingMode.Square?s.Math.RotatedRectangleF.fromRectangleF(t.get_bounds()):t.get_rectangle(),i.intersectsWith(h)&&e.push(h))}l=!this._lastRectangle||!Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.EqualsOfFloatNumbers(i.Width,this._lastRectangle.Width,.01)||!Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.EqualsOfFloatNumbers(i.Height,this._lastRectangle.Height,.01),a=!this._lastRectangle||!i.isEqual(this._lastRectangle),this._lastRectangle=i,c=!this._areRectanglesEqual(e,this._wrappingRectangles),this._wrappingRectangles=e,(n||c||l||a&&e.length>0)&&this.update()},_areRectanglesEqual:function(n,t){var r,f,u,i;if(n.length!=t.length)return!1;for(r=0;r<n.length;r++){for(f=n[r],u=!1,i=0;i<t.length;i++)if(f.isEqual(t[i])){u=!0;break}if(!u)return!1}return!0}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.BoundedTextVObject.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.BoundedTextVObject",Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseTextVObject),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.BoundedTextVObjectData=function(n){Aurigma.GraphicsMill.AjaxControls.VectorObjects.BoundedTextVObjectData.initializeBase(this,[n]),n&&(this.WR=n.get_wrappingRectangles(),this.WM=n.get_wrappingMargin(),this.PS=n.get_paragraphSettings(),this.VA=n.get_verticalAlignment(),this.IV=n.get_isVertical())},Aurigma.GraphicsMill.AjaxControls.VectorObjects.BoundedTextVObjectData.applyState=function(n,t){var u,r,i;if(t){for(t.beginUpdate(),u=[],r=0;r<n.WR.length;r++)i=n.WR[r],u.push(new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RotatedRectangleF(i.CenterX,i.CenterY,i.Width,i.Height,i.Angle));t._wrappingRectangles=u,t._wrappingMargin=n.WM,t._paragraphSettings=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.ParagraphSettings(n.PS),t._verticalAlignment=n.VA,t._isVertical=n.IV}Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseTextVObjectData.applyState(n,t)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.BoundedTextVObjectData.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.BoundedTextVObjectData",Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseTextVObjectData),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlainTextVObject=function(n,t,i,r,u){var f=Aurigma.GraphicsMill.AjaxControls.VectorObjects;f.PlainTextVObject.initializeBase(this,[n,null,r,u]),this._baselineLocation=t instanceof f.Math.PointF?t:new f.Math.PointF(0,0),this._actualAngle=0,this._isVertical=!1,this._needUpdate=typeof n=="string"||typeof r=="string"||typeof u=="number",i!=null&&(this._alignment=i,this._needUpdate=!0)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlainTextVObject.prototype={get_permissions:function(){var n=Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlainTextVObject.callBaseMethod(this,"get_permissions");return n.set_allowArbitraryResize(!1),n},set_permissions:function(n){n.set_allowArbitraryResize(!1),Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlainTextVObject.callBaseMethod(this,"set_permissions",[n])},set_alignment:function(n){if(this._alignment===n)return;if(this.get_isUpdating()){Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlainTextVObject.callBaseMethod(this,"set_alignment",[n]);return}var t=function(){var r=Aurigma.GraphicsMill.AjaxControls.VectorObjects,t,f,u,i,e;this._location=this.get_location(),t=this.get_rectangle(),f=t.Angle,t.Angle=0,u=new r.Math.PointF(t.CenterX,t.CenterY),i=this.get_baselineLocation(),i.rotateAt(-f,u),n===r.TextAlignment.Left?i.X=t.get_location().X:n===r.TextAlignment.Center?i.X=t.CenterX:n===r.TextAlignment.Right&&(i.X=t.get_location().X+t.Width),i.rotateAt(f,u),this.set_baselineLocation(i),this._alignment=n,e=function(){this._location&&(this.set_location(this._location),this.raiseUpdatedForAlignment())}.bind(this),this.update(null,e)}.bind(this);this._needUpdate?this.update(null,t):t()},get_baselineLocation:function(){var i=this._get_controlCenter(),t=this._baselineLocation.clone(),n=this.get_transform().clone();return n.rotate(-this.get_actualAngle()),t.transform(n,i),t},set_baselineLocation:function(n){var t=this.get_baselineLocation();t.isEqual(n)||(this.get_transform().move(n.X-t.X,n.Y-t.Y),this.quickUpdate())},get_originalBaselineLocation:function(){return this._baselineLocation},set_originalBaselineLocation:function(n){this._baselineLocation=n},get_isVertical:function(){return this._isVertical},set_isVertical:function(n){if(this._isVertical!==n){var t=Function.createDelegate(this,function(){this._isVertical=n});this.update(t)}},get_actualAngle:function(){return this._actualAngle},set_actualAngle:function(n){this._actualAngle=n},add_updatedForAlignment:function(n){this.get_events().addHandler("updatedForAlignment",n)},remove_updatedForAlignment:function(n){this.get_events().removeHandler("updatedForAlignment",n)},raiseUpdatedForAlignment:function(){var n=this.get_events().getHandler("updatedForAlignment");n&&n(this,Sys.EventArgs.Empty)},update:function(n,t){this.isVisible()&&(this._needUpdate=!1),Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlainTextVObject.callBaseMethod(this,"update",[n,t])},_afterUpdate:function(n){Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlainTextVObject.callBaseMethod(this,"_afterUpdate",[n]);var t=this.get_canvas();t!=null&&t.updateSelection()},_get_dataType:function(){return"PlainTextVObjectData"},draw:function(n,t){Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlainTextVObject.callBaseMethod(this,"draw",[n,t]);if(window.__$abl$===!0){var i=this.get_baselineLocation(),r=new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.RotatedRectangleF(i.X,i.Y,4,4,0);Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.fillRectangle(n,r,"red")}},_onResized:function(){var n=this.get_rectangle().Height/this._height;this._font._size=parseFloat((this._font._size*n).toFixed(1)),this._leading=parseFloat((this.get_leading()*n).toFixed(1)),Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlainTextVObject.callBaseMethod(this,"_onResized")}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlainTextVObject.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlainTextVObject",Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseTextVObject),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlainTextVObjectData=function(n){Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlainTextVObjectData.initializeBase(this,[n]),n&&(this.BL=n.get_baselineLocation(),this.AA=n.get_angle(),this.T={ScaleX:1,ScaleY:1,TranslateX:0,TranslateY:0,Angle:n.get_angle()},this.IV=n.get_isVertical())},Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlainTextVObjectData.applyState=function(n,t){t&&(t.beginUpdate(),t.set_originalBaselineLocation(new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.PointF(n.BL.X,n.BL.Y)),t.set_actualAngle(n.AA),t._isVertical=n.IV),Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseTextVObjectData.applyState(n,t)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlainTextVObjectData.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.PlainTextVObjectData",Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseTextVObjectData),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.AutoScaledTextVObject=function(n,t,i){Aurigma.GraphicsMill.AjaxControls.VectorObjects.AutoScaledTextVObject.initializeBase(this,[n,t,i]),this._isVertical=!1},Aurigma.GraphicsMill.AjaxControls.VectorObjects.AutoScaledTextVObject.prototype={_get_dataType:function(){return"AutoScaledTextVObjectData"},get_verticalScale:function(){return this._verticalScale},set_verticalScale:function(){},get_horizontalScale:function(){return this._horizontalScale},set_horizontalScale:function(){},get_isVertical:function(){return this._isVertical},set_isVertical:function(n){if(this._isVertical!==n){var t=Function.createDelegate(this,function(){this._isVertical=n});this.update(t)}}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.AutoScaledTextVObject.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.AutoScaledTextVObject",Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseTextVObject),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.AutoScaledTextVObjectData=function(n){Aurigma.GraphicsMill.AjaxControls.VectorObjects.AutoScaledTextVObjectData.initializeBase(this,[n]),n&&(this.IV=n.get_isVertical())},Aurigma.GraphicsMill.AjaxControls.VectorObjects.AutoScaledTextVObjectData.applyState=function(n,t){t&&(t.beginUpdate(),t._isVertical=n.IV),Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseTextVObjectData.applyState(n,t)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.AutoScaledTextVObjectData.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.AutoScaledTextVObjectData",Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseTextVObjectData),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.CurvedTextVObject=function(n,t,i,r){var u=Aurigma.GraphicsMill.AjaxControls.VectorObjects;u.CurvedTextVObject.initializeBase(this,[n,null,i,r]),this._textPath=t!=null?t:new u.Math.Path(""),this._actualAngle=0,this._fitToPath=!1,this._stretch=!1,this._originalFontSize=0,this._fitToPathStep=1,this._pathStart=0,this._pathEnd=1},Aurigma.GraphicsMill.AjaxControls.VectorObjects.CurvedTextVObject.prototype={get_textPath:function(){var i=this._get_controlCenter(),t=this._textPath.clone(),n=this.get_transform().clone();return n.rotate(-this.get_actualAngle()),t.transform(n,i),t},set_textPath:function(n){if(this.get_textPath().isEqual(n))return;var t=function(){this.set_originalTextPath(n),this.set_transform(new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Transform)}.bind(this);this.update(t)},get_pathStart:function(){return this._pathStart},set_pathStart:function(n){if(Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.EqualsOfFloatNumbers(this._pathStart,n))return;var t=function(){this._pathStart=n}.bind(this);this.update(t)},get_pathEnd:function(){return this._pathEnd},set_pathEnd:function(n){if(Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.EqualsOfFloatNumbers(this._pathEnd,n))return;var t=function(){this._pathEnd=n}.bind(this);this.update(t)},get_originalTextPath:function(){return this._textPath},set_originalTextPath:function(n){this._textPath=n},get_actualAngle:function(){return this._actualAngle},set_actualAngle:function(n){this._actualAngle=n},get_fitToPath:function(){return this._fitToPath},set_fitToPath:function(n){if(n===this._fitToPath)return;var t=function(){this._fitToPath=n}.bind(this);this.update(t)},get_stretch:function(){return this._stretch},set_stretch:function(n){if(n===this._stretch)return;var t=function(){this._stretch=n}.bind(this);this.update(t)},get_originalFontSize:function(){return this._originalFontSize},set_originalFontSize:function(n){if(Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.EqualsOfFloatNumbers(this._originalFontSize,n))return;var t=Function.createDelegate(this,function(){this._originalFontSize=n});this.update(t)},get_fitToPathStep:function(){return this._fitToPathStep},set_fitToPathStep:function(n){if(Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.EqualsOfFloatNumbers(this._fitToPathStep,n))return;var t=Function.createDelegate(this,function(){this._fitToPathStep=n});this.update(t)},_get_dataType:function(){return"CurvedTextVObjectData"},_afterUpdate:function(n){Aurigma.GraphicsMill.AjaxControls.VectorObjects.CurvedTextVObject.callBaseMethod(this,"_afterUpdate",[n]);var t=this.get_canvas();t!=null&&t.updateSelection()},_onResized:function(){var n=this.get_rectangle().Height/this._height;this._font._size=parseFloat((this._font._size*n).toFixed(1)),Aurigma.GraphicsMill.AjaxControls.VectorObjects.CurvedTextVObject.callBaseMethod(this,"_onResized")},draw:function(n,t){Aurigma.GraphicsMill.AjaxControls.VectorObjects.CurvedTextVObject.callBaseMethod(this,"draw",[n,t]),window.__$abl$===!0&&Aurigma.GraphicsMill.AjaxControls.VectorObjects.Graphics.drawPath(n,this._textPath,this._get_controlCenter(),this.get_transform(),1,"red")}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.CurvedTextVObject.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.CurvedTextVObject",Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseTextVObject),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.CurvedTextVObjectData=function(n){Aurigma.GraphicsMill.AjaxControls.VectorObjects.CurvedTextVObjectData.initializeBase(this,[n]),n&&(this.TPth=n.get_textPath().toString(),this.AA=n.get_angle(),this.T={ScaleX:1,ScaleY:1,TranslateX:0,TranslateY:0,Angle:n.get_angle()},this.FTP=n.get_fitToPath(),this.Str=n.get_stretch(),this.OFS=n.get_originalFontSize(),this.FTPS=n.get_fitToPathStep(),this.PS=n.get_pathStart(),this.PE=n.get_pathEnd())},Aurigma.GraphicsMill.AjaxControls.VectorObjects.CurvedTextVObjectData.applyState=function(n,t){t&&(t.beginUpdate(),t.set_originalTextPath(new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.Path(n.TPth)),t.set_actualAngle(n.AA),t.set_fitToPath(n.FTP),t.set_stretch(n.Str),t.set_originalFontSize(n.OFS),t.set_fitToPathStep(n.FTPS),t.set_pathStart(n.PS),t.set_pathEnd(n.PE)),Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseTextVObjectData.applyState(n,t)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.CurvedTextVObjectData.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.CurvedTextVObjectData",Aurigma.GraphicsMill.AjaxControls.VectorObjects.BaseTextVObjectData),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.PathBoundedTextVObject=function(n,t,i){Aurigma.GraphicsMill.AjaxControls.VectorObjects.PathBoundedTextVObject.initializeBase(this,[n,null,t,i]),this._boundingPaths=[],this._isVertical=!1},Aurigma.GraphicsMill.AjaxControls.VectorObjects.PathBoundedTextVObject.prototype={_get_dataType:function(){return"PathBoundedTextVObjectData"},get_boundingPaths:function(){return this._boundingPaths},set_boundingPaths:function(n){if(this._boundingPaths!==n){var t=Function.createDelegate(this,function(){this._boundingPaths=n,this.set_transform(new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Transform,!0)});this.update(t)}},set_originalBoundingPaths:function(n){this._boundingPaths=n},get_isVertical:function(){return this._isVertical},set_isVertical:function(n){if(this._isVertical!==n){var t=Function.createDelegate(this,function(){this._isVertical=n});this.update(t)}}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.PathBoundedTextVObject.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.PathBoundedTextVObject",Aurigma.GraphicsMill.AjaxControls.VectorObjects.BoundedTextVObject),Type.registerNamespace("Aurigma.GraphicsMill.AjaxControls.VectorObjects"),Aurigma.GraphicsMill.AjaxControls.VectorObjects.PathBoundedTextVObjectData=function(n){var i,r,t;Aurigma.GraphicsMill.AjaxControls.VectorObjects.PathBoundedTextVObjectData.initializeBase(this,[n]);if(n){i=n.get_boundingPaths();if(i!=null){for(r=[],t=0;t<i.length;t++)r.push(i[t].toString());this.BP=r}else this.BP=null;this.IV=n.get_isVertical()}},Aurigma.GraphicsMill.AjaxControls.VectorObjects.PathBoundedTextVObjectData.applyState=function(n,t){var r,i;if(t){t.beginUpdate();if(n.BP!=null){for(r=[],i=0;i<n.BP.length;i++)r.push(new Aurigma.GraphicsMill.AjaxControls.VectorObjects.Math.Path(n.BP[i]));t._boundingPaths=r}else t._boundingPaths=null;t._isVertical=n.IV}Aurigma.GraphicsMill.AjaxControls.VectorObjects.BoundedTextVObjectData.applyState(n,t)},Aurigma.GraphicsMill.AjaxControls.VectorObjects.PathBoundedTextVObjectData.registerClass("Aurigma.GraphicsMill.AjaxControls.VectorObjects.PathBoundedTextVObjectData",Aurigma.GraphicsMill.AjaxControls.VectorObjects.BoundedTextVObjectData);