Type.registerNamespace("Aurigma.GraphicsMill"),Aurigma.GraphicsMill.ImageLoadMode=function(){throw Error.notImplemented();},Aurigma.GraphicsMill.ImageLoadMode.prototype={entire:0,adaptiveTile:1,regularTile:2},Aurigma.GraphicsMill.ImageLoadMode.registerEnum("Aurigma.GraphicsMill.ImageLoadMode"),Aurigma.GraphicsMill.Bitmap=function(n){this._bv=n},Aurigma.GraphicsMill.Bitmap.prototype={get_bitsPerPixel:function(){return(this.get_pixelFormat()&65280)>>8},get_colorSpace:function(){return this.get_isRgb()?Aurigma.GraphicsMill.ColorSpace.rgb:this.get_isCmyk()?Aurigma.GraphicsMill.ColorSpace.cmyk:this.get_isGrayScale()?Aurigma.GraphicsMill.ColorSpace.grayScale:Aurigma.GraphicsMill.ColorSpace.unknown},get_hasAlpha:function(){return(this.get_pixelFormat()&262144)==262144||(this.get_pixelFormat()&524288)==524288},get_height:function(){return this._bv._bitmap$height},get_horizontalResolution:function(){return this._bv._bitmap$horizontalResolution},get_isCmyk:function(){return(this.get_pixelFormat()&335544320)==335544320},get_isEmpty:function(){return this._bv._bitmap$width<1||this._bv._bitmap$height<1},get_isExtended:function(){return(this.get_pixelFormat()&1048576)==1048576},get_isGrayScale:function(){return(this.get_pixelFormat()&301989888)==301989888},get_isIndexed:function(){return(this.get_pixelFormat()&65536)==65536},get_isRgb:function(){return(this.get_pixelFormat()&16777216)==16777216},get_pixelFormat:function(){return this._bv._bitmap$pixelFormat},get_verticalResolution:function(){return this._bv._bitmap$verticalResolution},get_width:function(){return this._bv._bitmap$width}},Aurigma.GraphicsMill.Bitmap.registerClass("Aurigma.GraphicsMill.Bitmap"),Aurigma.GraphicsMill.BitmapViewer=function(n){Aurigma.GraphicsMill.BitmapViewer.initializeBase(this,[n]),this._backgroundFileName="",this._source$fileName="",this._bitmap$width=-1,this._bitmap$height=-1,this._bitmap$horizontalResolution=0,this._bitmap$verticalResolution=0,this._bitmap$pixelFormat=0,this._imageLoadMode=Aurigma.GraphicsMill.ImageLoadMode.regularTile,this._initTiles=null,this._previewImageEnabled=!0,this._disableRefresh=!1,this._tiles=[],this._countOfNotLoadedTiles=0,this._webImageLoader=null,this._bitmap=new Aurigma.GraphicsMill.Bitmap(this),this._eps=.0001,this._scaleToActualSize=!1},Aurigma.GraphicsMill.BitmapViewer.prototype={_synchronizeState:function(n,t,i,r,u,f,e,o){var s,h,l,c;this._source$fileName=n,this._bitmap$width=t,this._bitmap$height=i,this._bitmap$horizontalResolution=r,this._bitmap$verticalResolution=u,this._bitmap$pixelFormat=f,this._clearTiles(),s=this.get_scrollingPosition(),h=this.get_scrollingSize(),h.x<s.x&&(s.x=h.x),h.y<s.y&&(s.y=h.y),this.set_scrollingPosition(s),t>0&&i>0?(l=this.get_contentWidth(),c=this.get_contentHeight(),this._resizeContentElements(),this._updateViewportAlignment(),this._previewImageEnabled&&(this._background.width=l,this._background.height=c,this._background.src=e,this._background.style.display="block"),this._contentCtx.style.display="block",o&&(this._addTiles(o()),this._webImageLoader.showPrecreatedTiles())):this._contentCtx.style.display="none",this._raiseEvent("workspaceChanged"),this.get_autoPostBack()||this.get_clientSideOptions().get_postBackOnWorkspaceChanged()?this._workspaceChangedPostBack():this._workspaceChanged=!0},_addTiles:function(n){for(var i=0;i<n.tiles.length;i++){var u=n.tiles[i],f=new Aurigma.GraphicsMill.Rectangle(u.x,u.y,u.w,u.h),r=this.controlToContentRectangle(this.workspaceToControlRectangle(f).round()),e=String.format(n.baseName,i),t=document.createElement("img");t.galleryImg="no",t.width=r.width,t.height=r.height,t.style.position="absolute",t.style.left=r.x+"px",t.style.top=r.y+"px",t.display="none",t.ondrag=function(){return!1},this._countOfNotLoadedTiles++,t.onload=Aurigma.GraphicsMill.Utils.createBoundedWrapper(this,function(){this._countOfNotLoadedTiles--}),this._tilesCtx.appendChild(t),this._tiles.push({location:f,zoom:n.zoom,url:e,img:t})}},_clearTiles:function(){while(this._tilesCtx.childNodes.length>0)this._tilesCtx.removeChild(this._tilesCtx.childNodes[0]);this._tiles=[]},_needToClearTiles:function(){for(var r=Math.max(1/this.get_actualSizeHorizontalScale(),1/this.get_actualSizeVerticalScale()),u=this.get_zoomQuality(),i=this.get_zoom(),f=(u==Aurigma.GraphicsMill.ZoomQuality.low||u==Aurigma.GraphicsMill.ZoomQuality.shrinkHighStretchLow)&&i-r>-this._eps,e=f?r:i,t,n=0;n<this._tiles.length;n++){t=this._tiles[n];if(Math.abs(t.zoom-e)>this._eps)return!0}return!1},_onTouch:function(n){this._touchFlags.startZoom=this.get_zoom(),this._touchFlags.firstPinchDetected=!1,this._touchFlags.currentRubberband=this.get_rubberband(),Aurigma.GraphicsMill.BitmapViewer.callBaseMethod(this,"_onTouch",[n])},_onPinch:function(n){var t,i;!this._touchFlags.firstPinchDetected&&Aurigma.GraphicsMill.Utils.Platform.IsIos()&&this.get_pinchZoomEnabled()&&(t=this.get_element(),this._touchFlags.webkitOverflowScrolling=t.style["-webkit-overflow-scrolling"],this._touchFlags.currentRubberband!=null&&this._touchFlags.currentRubberband!=""&&this.set_rubberband(null),t.style["-webkit-overflow-scrolling"]=""),this._touchFlags.firstPinchDetected=!0,i=Aurigma.GraphicsMill.Utils.Platform.IsTouchIE()?!0:!1,Aurigma.GraphicsMill.BitmapViewer.callBaseMethod(this,"_onPinch",[n,i])},_onRelease:function(n){Aurigma.GraphicsMill.Utils.Platform.IsIos()&&(this.get_element().style["-webkit-overflow-scrolling"]=this._touchFlags.webkitOverflowScrolling,this._touchFlags.currentRubberband!=null&&this._touchFlags.currentRubberband!=""&&this.set_rubberband(this._touchFlags.currentRubberband)),Aurigma.GraphicsMill.BitmapViewer.callBaseMethod(this,"_onRelease",[n])},initialize:function(){var n,t;this._webImageLoader=new Aurigma.GraphicsMill.WebImageLoader(this),Aurigma.GraphicsMill.BitmapViewer.callBaseMethod(this,"initialize"),n=this._contentElements,n.push(this._imageCtx=this._jquery(this.get_element()).find("#cvImage")[0]),this._previewImageEnabled&&(t=this._jquery(this.get_element()).find("#Background"),n.push(this._background=t[0])),n.push(this._tilesCtx=this._jquery(this.get_element()).find("#Tiles")[0]),this._makeInactiveAll(),this._initTiles?(this._addTiles(this._initTiles()),this._webImageLoader.showPrecreatedTiles()):this.get_hasContent()&&(this._updateViewport(),this._refresh())},delayedRefresh:function(){if(this._disableRefresh)return;Aurigma.GraphicsMill.BitmapViewer.callBaseMethod(this,"delayedRefresh")},_onScroll:function(){Aurigma.GraphicsMill.BitmapViewer.callBaseMethod(this,"_onScroll"),this._imageLoadMode==Aurigma.GraphicsMill.ImageLoadMode.regularTile&&this._webImageLoader.showPrecreatedTiles(),this._imageLoadMode==Aurigma.GraphicsMill.ImageLoadMode.adaptiveTile&&this.delayedRefresh()},_onResize:function(){Aurigma.GraphicsMill.BitmapViewer.callBaseMethod(this,"_onResize"),this._imageLoadMode==Aurigma.GraphicsMill.ImageLoadMode.regularTile&&this._webImageLoader.showPrecreatedTiles(),this.delayedRefresh()},_updateViewport:function(){var i,t,n;for(Aurigma.GraphicsMill.BitmapViewer.callBaseMethod(this,"_updateViewport"),i=0;i<this._tiles.length;i++)t=this._tiles[i],n=this.workspaceToControlRectangle(t.location).round(),n=this.controlToContentRectangle(n),t.img.width=n.width,t.img.height=n.height,t.img.style.left=n.x+"px",t.img.style.top=n.y+"px";this._imageLoadMode==Aurigma.GraphicsMill.ImageLoadMode.regularTile&&this._webImageLoader.showPrecreatedTiles(),this.delayedRefresh()},_serializeState:function(n){Aurigma.GraphicsMill.BitmapViewer.callBaseMethod(this,"_serializeState",[n]),n.Source_FileName=this._source$fileName,n.ScaleToActualSize=this._scaleToActualSize},_refresh:function(){var n,i,r,t;this._refreshTimer&&window.clearTimeout(this._refreshTimer),this._needToRefresh=!1;if(this.get_width()<=1||this.get_height()<=1)return;n=null;if(this._imageLoadMode==Aurigma.GraphicsMill.ImageLoadMode.adaptiveTile){i=this._webImageLoader.getTileCoverage();if(i)for(n=[],r=0;r<i.length;r++)t=i[r],n.push(Aurigma.GraphicsMill.Utils.round3(t.x)),n.push(Aurigma.GraphicsMill.Utils.round3(t.y)),n.push(Aurigma.GraphicsMill.Utils.round3(t.width)),n.push(Aurigma.GraphicsMill.Utils.round3(t.height));else return}else if(!this._needToClearTiles()&&this._tiles.length>0)return;this.invokeRemoteMethod("__Refresh",n)},_renderContent:function(n){var t=this.get_hasContent(),r="width:"+this.get_contentWidth()+"px;height:"+this.get_contentHeight()+"px;",i="position:absolute;left:0px;top:0px;";n.append('<div id="cvImage" style="'),t&&n.append(r),n.append(i+'">'),this._previewImageEnabled&&(n.append('<img id="Background"'),t&&n.append(' src="'+this._backgroundFileName+'"'),n.append(' alt="" style="'),t&&n.append(r),n.append(i+'" />')),n.append('<div id="Tiles" style="'),t&&n.append(r),n.append(i+'">'),n.append("</div>")},get_countOfNotLoadedTiles:function(){return this._countOfNotLoadedTiles},get_workspaceHeight:function(){return this.get_scaleToActualSize()?this._bitmap.get_height()*72/this._bitmap.get_verticalResolution():this._bitmap.get_height()*72/this.get_screenYDpi()},get_workspaceWidth:function(){return this.get_scaleToActualSize()?this._bitmap.get_width()*72/this._bitmap.get_horizontalResolution():this._bitmap.get_width()*72/this.get_screenXDpi()},get_bitmap:function(){return this._bitmap},get_imageLoadMode:function(){return this._imageLoadMode},get_hasContent:function(){return!this.get_bitmap().get_isEmpty()},get_scaleToActualSize:function(){return this._scaleToActualSize},set_scaleToActualSize:function(n){this._scaleToActualSize=n},get_actualSizeHorizontalScale:function(){if(!this.get_scaleToActualSize())return 1;var n=this.get_bitmap().get_horizontalResolution();return n>this._eps?this.get_screenXDpi()/n:1},get_actualSizeVerticalScale:function(){if(!this.get_scaleToActualSize())return 1;var n=this.get_bitmap().get_verticalResolution();return n>this._eps?this.get_screenYDpi()/n:1},get_contentHeight:function(){return Math.round(this._bitmap.get_height()*this.get_zoom()*this.get_actualSizeVerticalScale())},get_contentWidth:function(){return Math.round(this._bitmap.get_width()*this.get_zoom()*this.get_actualSizeHorizontalScale())}},Aurigma.GraphicsMill.BitmapViewer.registerClass("Aurigma.GraphicsMill.BitmapViewer",Aurigma.GraphicsMill.BaseViewer),Aurigma.GraphicsMill.WebImageLoader=function(n){this._bv=n},Aurigma.GraphicsMill.WebImageLoader.prototype={showPrecreatedTiles:function(){var n=this._bv,r,t,i;if(n.get_imageLoadMode()==Aurigma.GraphicsMill.ImageLoadMode.regularTile){var u=n.get_scrollingPosition(),e=n.controlToWorkspacePoint(n.contentToControlPoint(new Sys.UI.Point(u.x,u.y))),f=n.controlToWorkspacePoint(n.contentToControlPoint(new Sys.UI.Point(u.x+n.get_width(),u.y+n.get_height())));for(t=0;t<n._tiles.length;t++)i=n._tiles[t],i.loaded||(r=i.location,r.x+r.width>=e.x&&r.x<=f.x&&r.y+r.height>=e.y&&r.y<=f.y&&this._showTile(i))}else for(t=0;t<n._tiles.length;t++)i=n._tiles[t],i.loaded||this._showTile(i)},getTileCoverage:function(){function et(n,t){return n>t?1:n<t?-1:0}function ot(n){var t=[],i;t.push(n.shift());while(n.length>0)i=n.shift(),i!=t[t.length-1]&&t.push(i);return t}var c=this._bv,v,a,l,ht,r,u,d,b,y,p,f,n,nt,i,t,w;if(c.get_imageLoadMode()!=Aurigma.GraphicsMill.ImageLoadMode.adaptiveTile)return null;var k=c.get_scrollingPosition(),it=c.get_width(),tt=c.get_height();it=Math.min(it,c.get_contentWidth()-k.x),tt=Math.min(tt,c.get_contentHeight()-k.y),v=new Aurigma.GraphicsMill.Rectangle(k.x,k.y,it,tt);if(c._needToClearTiles())return w=c.contentToControlRectangle(v),[c.controlToWorkspaceRectangle(w)];for(a=[],l=[],a.push(v.x),a.push(v.x+v.width),l.push(v.y),l.push(v.y+v.height),n=0;n<c._tiles.length;n++)ht=c._tiles[n],r=c.workspaceToControlRectangle(ht.location).round(),r=c.controlToContentRectangle(r),r.x>v.x&&r.x<v.x+v.width&&a.push(r.x),r.x+r.width>v.x&&r.x+r.width<v.x+v.width&&a.push(r.x+r.width),r.y>v.y&&r.y<v.y+v.height&&l.push(r.y),r.y+r.height>v.y&&r.y+r.height<v.y+v.height&&l.push(r.y+r.height);for(a=ot(a.sort(et)),l=ot(l.sort(et)),u=[],n=0;n<l.length-1;n++)for(u[n]=[],i=0;i<a.length-1;i++)u[n][i]=0;for(d=0;d<c._tiles.length;d++){var ut=-1,rt=-1,ft=-1,st=-1,r=c.workspaceToControlRectangle(c._tiles[d].location).round();for(r=c.controlToContentRectangle(r),i=0;i<=a.length-2;i++)if(r.x<=a[i]){ut=i;break}for(i=a.length-1;i>=1;i--)if(r.x+r.width>=a[i]){rt=i-1;break}for(i=0;i<=l.length-2;i++)if(r.y<=l[i]){ft=i;break}for(i=l.length-1;i>=1;i--)if(r.y+r.height>=l[i]){st=i-1;break}if(ut!=-1&&rt!=-1&&ft!=-1)for(n=ft;n<=st;n++)for(i=ut;i<=rt;i++)u[n][i]=1}var s=0,h=a.length-2,e=0,o=l.length-2;while(s<=h){for(f=0,n=e;n<=o;n++)f+=u[n][s];if(f==o-e+1)s++;else break}while(s<=h){for(f=0,n=e;n<=o;n++)f+=u[n][h];if(f==o-e+1)h--;else break}while(e<=o){for(f=0,n=s;n<=h;n++)f+=u[e][n];if(f==h-s+1)e++;else break}while(e<=o){for(f=0,n=s;n<=h;n++)f+=u[o][n];if(f==h-s+1)o--;else break}if(s>h||e>o)return null;for(b=0,n=e;n<=o;n++)for(i=s;i<=h;i++)b+=u[n][i];var lt=3,g=[],ct=(h-s+1)*(o-e+1);while(b<ct&&g.length<lt){y=-1,p=-1;if(u[e][s]==0)y=s,p=e;else if(u[o][s]==0)y=s,p=o;else if(u[e][h]==0)y=h,p=e;else if(u[o][h]==0)y=h,p=o;else{for(n=s;n<=h;n++)if(u[e][n]==0){y=n,p=e;break}if(y==-1){for(n=s;n<=h;n++)if(u[o][n]==0){y=n,p=o;break}if(y==-1){for(n=e;n<=o;n++)if(u[n][s]==0){y=s,p=n;break}if(y==-1){for(n=e;n<=o;n++)if(u[n][h]==0){y=h,p=n;break}if(y==-1)for(n=e+1;n<=o-1;n++){for(i=s+1;i<=o-1;i++)if(u[n][i]==0){y=i,p=n;break}if(y!=-1)break}}}}}t={x1:y,y1:p,x2:y,y2:p},u[p][y]=1,b++;while(t.y1>e){for(f=0,n=t.x1;n<=t.x2;n++)f+=u[t.y1-1][n];if(f==0)for(t.y1--,b+=t.x2-t.x1+1,n=t.x1;n<=t.x2;n++)u[t.y1][n]=1;else break}while(t.x1>s){for(f=0,n=t.y1;n<=t.y2;n++)f+=u[n][t.x1-1];if(f==0)for(t.x1--,b+=t.y2-t.y1+1,n=t.y1;n<=t.y2;n++)u[n][t.x1]=1;else break}while(t.y2<o){for(f=0,n=t.x1;n<=t.x2;n++)f+=u[t.y2+1][n];if(f==0)for(t.y2++,b+=t.x2-t.x1+1,n=t.x1;n<=t.x2;n++)u[t.y2][n]=1;else break}while(t.x2<h){for(f=0,n=t.y1;n<=t.y2;n++)f+=u[n][t.x2+1];if(f==0)for(t.x2++,b+=t.y2-t.y1+1,n=t.y1;n<=t.y2;n++)u[n][t.x2]=1;else break}g.push(t)}if(b!=ct)return w=new Aurigma.GraphicsMill.Rectangle(a[s],l[e],a[h+1]-a[s],l[o+1]-l[e]),w=c.contentToControlRectangle(w),[c.controlToWorkspaceRectangle(w)];for(nt=[],i=0;i<g.length;i++)t=g[i],a[t.x2+1]-a[t.x1]>.5&&l[t.y2+1]-l[t.y1]>.5&&(w=new Aurigma.GraphicsMill.Rectangle(a[t.x1],l[t.y1],a[t.x2+1]-a[t.x1],l[t.y2+1]-l[t.y1]),w=c.contentToControlRectangle(w),nt.push(c.controlToWorkspaceRectangle(w)));return nt},_showTile:function(n){var t=n.img;t.style.display="block",t.src=n.url,n.loaded=!0}},Aurigma.GraphicsMill.WebImageLoader.registerClass("Aurigma.GraphicsMill.WebImageLoader"),typeof Sys!="undefined"&&Sys.Application.notifyScriptLoaded();